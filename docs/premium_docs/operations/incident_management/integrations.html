<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Integrations list</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Analytics
group: Platform Insights
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Use webhooks to receive alerts from external sources, map alert fields, trigger test alerts, and integrate with tools like Prometheus and Opsgenie.
title: Integrations</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Free, Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>GitLab can accept alerts from any source via a webhook receiver. <a href="alerts.html">Alert notifications</a>
can <a href="paging.md#paging">trigger paging</a> for on-call rotations or be used to <a href="manage_incidents.md#from-an-alert">create incidents</a>.</p>
<h2>Integrations list</h2>
<p>With at least the Maintainer role, you can view the list of configured
alerting integrations by navigating to <strong>Settings</strong> &gt; <strong>Monitor</strong>
in your project's sidebar menu, and expanding the <strong>Alerts</strong> section. The list displays
the integration name, type, and status (enabled or disabled):</p>
<p><img alt="Table showing configured alerts details" src="img/integrations_list_v13_5.png" /></p>
<h2>Configuration</h2>
<p>GitLab can receive alerts via an HTTP endpoint that you configure.</p>
<h3>Single Alerting Endpoint</h3>
<p>Enabling an alerting endpoint in a GitLab projects activates it to
receive alert payloads in JSON format. You can always
<a href="#customize-the-alert-payload-outside-of-gitlab">customize the payload</a> to your liking.</p>
<ol>
<li>Sign in to GitLab as a user with the Maintainer role
   for a project.</li>
<li>Go to <strong>Settings</strong> &gt; <strong>Monitor</strong> in your project.</li>
<li>Expand the <strong>Alerts</strong> section, and in the <strong>Select integration type</strong> dropdown list,
   select <strong>Prometheus</strong> for alerts from Prometheus, or <strong>HTTP Endpoint</strong> for any other monitoring tool.</li>
<li>Toggle the <strong>Active</strong> alert setting. The URL and Authorization Key for the webhook configuration
   are available in the <strong>View credentials</strong> tab after you save the integration. You must also input
   the URL and Authorization Key in your external service.</li>
</ol>
<h3>Alerting Endpoints</h3>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>In <a href="https://about.gitlab.com/pricing/">GitLab Premium</a>, you can create multiple
unique alerting endpoints to receive alerts from any external source in JSON format,
and you can <a href="#customize-the-alert-payload-outside-of-gitlab">customize the payload</a>.</p>
<ol>
<li>Sign in to GitLab as a user with the Maintainer role
   for a project.</li>
<li>Go to <strong>Settings</strong> &gt; <strong>Monitor</strong> in your project.</li>
<li>Expand the <strong>Alerts</strong> section.</li>
<li>
<p>For each endpoint you want to create:</p>
</li>
<li>
<p>Select <strong>Add new integration</strong>.</p>
</li>
<li>In the <strong>Select integration type</strong> dropdown list, select <strong>Prometheus</strong> for alerts from Prometheus, or <strong>HTTP Endpoint</strong> for any other monitoring tool. See details</li>
<li>Name the integration.</li>
<li>Toggle the <strong>Active</strong> alert setting. The <strong>URL</strong> and <strong>Authorization Key</strong> for the webhook
      configuration are available in the <strong>View credentials</strong> tab after you save the integration.
      You must also input the URL and Authorization Key in your external service.</li>
<li>
<p>Optional. To map fields from your monitoring tool's alert to GitLab fields, enter a sample
      payload and select <strong>Parse payload for custom mapping</strong>. Valid JSON is required. If you update
      a sample payload, you must also remap the fields. For Prometheus integrations, enter a single alert from the payload's <code>alerts</code> key instead of the entire payload.</p>
</li>
<li>
<p>Optional. If you provided a valid sample payload, select each value in
      <strong>Payload alert key</strong> to <a href="#map-fields-in-custom-alerts">map to a <strong>GitLab alert key</strong></a>.</p>
</li>
<li>To save your integration, select <strong>Save Integration</strong>. If desired, you can send a test alert
      from your integration's <strong>Send test alert</strong> tab after the integration is created.</li>
</ol>
<p>The new HTTP Endpoint displays in the <a href="#integrations-list">integrations list</a>.
You can edit the integration by selecting the {{&lt; icon name="settings" &gt;}} settings icon on the right
side of the integrations list.</p>
<h4>Map fields in custom alerts</h4>
<p>You can integrate your monitoring tool's alert format with GitLab alerts. To show the
correct information in the <a href="alerts.md#alert-list">Alert list</a> and the
<a href="alerts.md#alert-details-page">Alert Details page</a>, map your alert's fields to
GitLab fields when you <a href="#alerting-endpoints">create an HTTP endpoint</a>:</p>
<p><img alt="Alert Management List" src="img/custom_alert_mapping_v13_11.png" /></p>
<h3>Add integration credentials to Alertmanager (Prometheus integrations only)</h3>
<p>To send Prometheus alert notifications to GitLab, copy the URL and authorization key from
your <a href="#single-alerting-endpoint">Prometheus integration</a> into the
<a href="https://prometheus.io/docs/alerting/latest/configuration/#webhook_config"><code>webhook_configs</code></a>
section of the Prometheus Alertmanager configuration:</p>
<pre><code class="language-yaml">receivers:
  - name: gitlab
    webhook_configs:
      - http_config:
          authorization:
            type: Bearer
            credentials: 1234567890abdcdefg
        send_resolved: true
        url: http://IP_ADDRESS:PORT/root/manual_prometheus/prometheus/alerts/notify.json
        # Rest of configuration omitted
        # ...
</code></pre>
<h2>Customize the alert payload outside of GitLab</h2>
<h3>Expected HTTP request attributes</h3>
<p>For HTTP Endpoints without <a href="#map-fields-in-custom-alerts">custom mappings</a>, you can customize the payload by sending the following
parameters. All fields are optional. If the incoming alert does not contain a value for the <code>Title</code> field, a default value of <code>New: Alert</code> is applied.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>title</code></td>
<td>String</td>
<td>The title of the alert.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>String</td>
<td>A high-level summary of the problem.</td>
</tr>
<tr>
<td><code>start_time</code></td>
<td>DateTime</td>
<td>The time of the alert. If none is provided, a current time is used.</td>
</tr>
<tr>
<td><code>end_time</code></td>
<td>DateTime</td>
<td>The resolution time of the alert. If provided, the alert is resolved.</td>
</tr>
<tr>
<td><code>service</code></td>
<td>String</td>
<td>The affected service.</td>
</tr>
<tr>
<td><code>monitoring_tool</code></td>
<td>String</td>
<td>The name of the associated monitoring tool.</td>
</tr>
<tr>
<td><code>hosts</code></td>
<td>String or Array</td>
<td>One or more hosts, as to where this incident occurred.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>String</td>
<td>The severity of the alert. Case-insensitive. Can be one of: <code>critical</code>, <code>high</code>, <code>medium</code>, <code>low</code>, <code>info</code>, <code>unknown</code>. Defaults to <code>critical</code> if missing or value is not in this list.</td>
</tr>
<tr>
<td><code>fingerprint</code></td>
<td>String or Array</td>
<td>The unique identifier of the alert. This can be used to group occurrences of the same alert. When the <code>generic_alert_fingerprinting</code> feature is enabled, the fingerprint is generated automatically based on the payload (excluding the <code>start_time</code>, <code>end_time</code>, and <code>hosts</code> parameters).</td>
</tr>
<tr>
<td><code>gitlab_environment_name</code></td>
<td>String</td>
<td>The name of the associated GitLab <a href="../../ci/environments/_index.html">environment</a>. Required to <a href="../../user/operations_dashboard/_index.md#adding-a-project-to-the-dashboard">display alerts on a dashboard</a>.</td>
</tr>
</tbody>
</table>
<p>You can also add custom fields to the alert's payload. The values of extra
parameters aren't limited to primitive types (such as strings or numbers), but
can be a nested JSON object. For example:</p>
<pre><code class="language-json">{ &quot;foo&quot;: { &quot;bar&quot;: { &quot;baz&quot;: 42 } } }
</code></pre>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Ensure your requests are smaller than the
<a href="../../administration/instance_limits.md#generic-alert-json-payloads">payload application limits</a>.</p>
<p>{{&lt; /alert &gt;}}</p>
<h4>Example request body</h4>
<p>Example payload:</p>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;Incident title&quot;,
  &quot;description&quot;: &quot;Short description of the incident&quot;,
  &quot;start_time&quot;: &quot;2019-09-12T06:00:55Z&quot;,
  &quot;service&quot;: &quot;service affected&quot;,
  &quot;monitoring_tool&quot;: &quot;value&quot;,
  &quot;hosts&quot;: &quot;value&quot;,
  &quot;severity&quot;: &quot;high&quot;,
  &quot;fingerprint&quot;: &quot;d19381d4e8ebca87b55cda6e8eee7385&quot;,
  &quot;foo&quot;: {
    &quot;bar&quot;: {
      &quot;baz&quot;: 42
    }
  }
}
</code></pre>
<h3>Expected Prometheus request attributes</h3>
<p>Alerts are expected to be formatted for a Prometheus <a href="https://prometheus.io/docs/alerting/latest/configuration/#webhook_config">webhook receiver</a>.</p>
<p>Top-level required attributes:</p>
<ul>
<li><code>alerts</code></li>
<li><code>commonAnnotations</code></li>
<li><code>commonLabels</code></li>
<li><code>externalURL</code></li>
<li><code>groupKey</code></li>
<li><code>groupLabels</code></li>
<li><code>receiver</code></li>
<li><code>status</code></li>
<li><code>version</code></li>
</ul>
<p>From <code>alerts</code> in the Prometheus payload, a GitLab alert is created for each item in the array.
You can alter the nested parameters listed below to configure the GitLab alert.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>One of <code>annotations/title</code>, <code>annotations/summary</code>, or <code>labels/alertname</code></td>
<td>String</td>
<td>Yes</td>
<td>The title of the alert.</td>
</tr>
<tr>
<td><code>startsAt</code></td>
<td>DateTime</td>
<td>Yes</td>
<td>The start time of the alert.</td>
</tr>
<tr>
<td><code>annotations/description</code></td>
<td>String</td>
<td>No</td>
<td>A high-level summary of the problem.</td>
</tr>
<tr>
<td><code>annotations/gitlab_incident_markdown</code></td>
<td>String</td>
<td>No</td>
<td><a href="../../user/markdown.html">GitLab Flavored Markdown</a> to be appended to any incident created from the alert.</td>
</tr>
<tr>
<td><code>annotations/runbook</code></td>
<td>String</td>
<td>No</td>
<td>Link to documentation or instructions for how to manage this alert.</td>
</tr>
<tr>
<td><code>endsAt</code></td>
<td>DateTime</td>
<td>No</td>
<td>The resolution time of the alert.</td>
</tr>
<tr>
<td><code>g0.expr</code> query parameter in <code>generatorUrl</code></td>
<td>String</td>
<td>No</td>
<td>Query of associated metric.</td>
</tr>
<tr>
<td><code>labels/gitlab_environment_name</code></td>
<td>String</td>
<td>No</td>
<td>The name of the associated GitLab <a href="../../ci/environments/_index.html">environment</a>. Required to <a href="../../user/operations_dashboard/_index.md#adding-a-project-to-the-dashboard">display alerts on a dashboard</a>.</td>
</tr>
<tr>
<td><code>labels/severity</code></td>
<td>String</td>
<td>No</td>
<td>Severity of the alert. Should be one of the <a href="#prometheus-severity-options">Prometheus severity options</a>. Defaults to <code>critical</code> if missing or value is not in this list.</td>
</tr>
<tr>
<td><code>status</code></td>
<td>String</td>
<td>No</td>
<td>Status of the alert in Prometheus. If value is 'resolved', the alert is resolved.</td>
</tr>
<tr>
<td>One of <code>annotations/gitlab_y_label</code>,  <code>annotations/title</code>, <code>annotations/summary</code>, or <code>labels/alertname</code></td>
<td>String</td>
<td>No</td>
<td>The Y-Axis label to be used when embedding the metrics for this alert in <a href="../../user/markdown.html">GitLab Flavored Markdown</a>.</td>
</tr>
</tbody>
</table>
<p>Additional attributes included under <code>annotations</code> are available on
the <a href="alerts.md#alert-details-page">alert details page</a>. Any other attributes are ignored.</p>
<p>Attributes aren't limited to primitive types (such as strings or numbers), but
can be a nested JSON object. For example:</p>
<pre><code class="language-json">{
    &quot;target&quot;: {
        &quot;user&quot;: {
            &quot;id&quot;: 42
        }
    }
}
</code></pre>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Ensure your requests are smaller than the
<a href="../../administration/instance_limits.md#generic-alert-json-payloads">payload application limits</a>.</p>
<p>{{&lt; /alert &gt;}}</p>
<h4>Prometheus severity options</h4>
<p>Alerts from Prometheus can provide any of the case-insensitive follow values for <a href="alerts.md#alert-severity">alert severity</a>:</p>
<ul>
<li><strong>Critical</strong>: <code>critical</code>, <code>s1</code>, <code>p1</code>, <code>emergency</code>, <code>fatal</code></li>
<li><strong>High</strong>: <code>high</code>, <code>s2</code>, <code>p2</code>, <code>major</code>, <code>page</code></li>
<li><strong>Medium</strong>: <code>medium</code>, <code>s3</code>, <code>p3</code>, <code>error</code>, <code>alert</code></li>
<li><strong>Low</strong>: <code>low</code>, <code>s4</code>, <code>p4</code>, <code>warn</code>, <code>warning</code></li>
<li><strong>Info</strong>: <code>info</code>, <code>s5</code>, <code>p5</code>, <code>debug</code>, <code>information</code>, <code>notice</code></li>
</ul>
<p>The severity defaults to <code>critical</code> if the value is missing or not in this list.</p>
<h4>Example Prometheus alert</h4>
<p>Example alerting rule:</p>
<pre><code class="language-yaml">groups:
- name: example
  rules:
  - alert: ServiceDown
    expr: up == 0
    for: 5m
    labels:
      severity: high
    annotations:
      title: &quot;Example title&quot;
      runbook: &quot;http://example.com/my-alert-runbook&quot;
      description: &quot;Service has been down for more than 5 minutes.&quot;
      gitlab_y_label: &quot;y-axis label&quot;
      foo:
        bar:
          baz: 42
</code></pre>
<p>Example request payload:</p>
<pre><code class="language-json">{
  &quot;version&quot; : &quot;4&quot;,
  &quot;groupKey&quot;: null,
  &quot;status&quot;: &quot;firing&quot;,
  &quot;receiver&quot;: &quot;&quot;,
  &quot;groupLabels&quot;: {},
  &quot;commonLabels&quot;: {},
  &quot;commonAnnotations&quot;: {},
  &quot;externalURL&quot;: &quot;&quot;,
  &quot;alerts&quot;: [{
    &quot;startsAt&quot;: &quot;2022-010-30T11:22:40Z&quot;,
    &quot;generatorURL&quot;: &quot;http://host?g0.expr=up&quot;,
    &quot;endsAt&quot;: null,
    &quot;status&quot;: &quot;firing&quot;,
    &quot;labels&quot;: {
      &quot;gitlab_environment_name&quot;: &quot;production&quot;,
      &quot;severity&quot;: &quot;high&quot;
    },
    &quot;annotations&quot;: {
      &quot;title&quot;: &quot;Example title&quot;,
      &quot;runbook&quot;: &quot;http://example.com/my-alert-runbook&quot;,
      &quot;description&quot;: &quot;Service has been down for more than 5 minutes.&quot;,
      &quot;gitlab_y_label&quot;: &quot;y-axis label&quot;,
      &quot;foo&quot;: {
        &quot;bar&quot;: {
          &quot;baz&quot;: 42
        }
      }
    }
  }]
}
</code></pre>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>When <a href="#triggering-test-alerts">triggering a test alert</a>, enter the whole payload as shown in the example.
When <a href="#map-fields-in-custom-alerts">configuring custom mappings</a>, enter only the first item from the <code>alerts</code> array as the sample payload.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>Authorization</h2>
<p>The following authorization methods are accepted:</p>
<ul>
<li>Bearer authorization header</li>
<li>Basic authentication</li>
</ul>
<p>The <code>&lt;authorization_key&gt;</code> and <code>&lt;url&gt;</code> values can be found when configuring an alert integration.</p>
<h3>Bearer authorization header</h3>
<p>The authorization key can be used as the Bearer token:</p>
<pre><code class="language-shell">curl --request POST \
  --data '{&quot;title&quot;: &quot;Incident title&quot;}' \
  --header &quot;Authorization: Bearer &lt;authorization_key&gt;&quot; \
  --header &quot;Content-Type: application/json&quot; \
  &lt;url&gt;
</code></pre>
<h3>Basic authentication</h3>
<p>The authorization key can be used as the <code>password</code>. The <code>username</code> is left blank:</p>
<ul>
<li>username: <code>&lt;blank&gt;</code></li>
<li>password: <code>&lt;authorization_key&gt;</code></li>
</ul>
<pre><code class="language-shell">curl --request POST \
  --data '{&quot;title&quot;: &quot;Incident title&quot;}' \
  --header &quot;Authorization: Basic &lt;base_64_encoded_credentials&gt;&quot; \
  --header &quot;Content-Type: application/json&quot; \
  &lt;url&gt;
</code></pre>
<p>Basic authentication can also be used with credentials directly in the URL:</p>
<pre><code class="language-shell">curl --request POST \
  --data '{&quot;title&quot;: &quot;Incident title&quot;}' \
  --header &quot;Content-Type: application/json&quot; \
  &lt;username:password@url&gt;
</code></pre>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Using your authorization key in the URL is insecure, as it's visible in server logs. We recommend
using one of the header options described previously if your tooling supports it.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>Response body</h2>
<p>The JSON response body contains a list of any alerts created within the request:</p>
<pre><code class="language-json">[
  {
    &quot;iid&quot;: 1,
    &quot;title&quot;: &quot;Incident title&quot;
  },
  {
    &quot;iid&quot;: 2,
    &quot;title&quot;: &quot;Second Incident title&quot;
  }
]
</code></pre>
<p>Successful responses return a <code>200</code> response code.</p>
<h2>Triggering test alerts</h2>
<p>After a <a href="../../user/permissions.html">project maintainer or owner</a>
configures an integration, you can trigger a test
alert to confirm your integration works properly.</p>
<ol>
<li>Sign in as a user with at least the Developer role.</li>
<li>Go to <strong>Settings</strong> &gt; <strong>Monitor</strong> in your project.</li>
<li>Select <strong>Alerts</strong> to expand the section.</li>
<li>Select the {{&lt; icon name="settings" &gt;}} settings icon on the right side of the integration in <a href="#integrations-list">the list</a>.</li>
<li>Select the <strong>Send test alert</strong> tab to open it.</li>
<li>Enter a test payload in the payload field (valid JSON is required).</li>
<li>Select <strong>Send</strong>.</li>
</ol>
<p>GitLab displays an error or success message, depending on the outcome of your test.</p>
<h2>Automatic grouping of identical alerts</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>GitLab groups alerts based on their payload. When an incoming alert contains the same payload as another alert
(excluding the <code>start_time</code> and <code>hosts</code> attributes), GitLab groups these alerts
together and displays a counter on the <a href="incidents.html">Alert Management List</a>
and details pages.</p>
<p>If the existing alert is already <code>resolved</code>, GitLab creates a new alert instead.</p>
<p><img alt="Alert Management List" src="img/alert_list_v13_1.png" /></p>
<h2>Recovery alerts</h2>
<p>The alert in GitLab is automatically resolved when an HTTP Endpoint
receives a payload with the end time of the alert set. For HTTP Endpoints
without <a href="#map-fields-in-custom-alerts">custom mappings</a>, the expected
field is <code>end_time</code>. With custom mappings, you can select the expected field.</p>
<p>GitLab determines which alert to resolve based on the <code>fingerprint</code> value that can be provided as
part of the payload.
For more information on alert properties and mappings, see
<a href="#customize-the-alert-payload-outside-of-gitlab">Customize the alert payload outside of GitLab</a>.</p>
<p>You can also configure the associated <a href="manage_incidents.md#automatically-close-incidents-via-recovery-alerts">incident to be closed automatically</a> when the alert resolves.</p>
<h2>Link to your Opsgenie Alerts</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/3066">Introduced</a> in GitLab 13.2.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>We are building deeper integration with Opsgenie and other alerting tools through
<a href="#single-alerting-endpoint">HTTP endpoint integrations</a> so you can see alerts in
the GitLab interface.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>You can monitor alerts using a GitLab integration with <a href="https://www.atlassian.com/software/opsgenie">Opsgenie</a>.</p>
<p>If you enable the Opsgenie integration, you can't have other GitLab alert
services
active at the same time.</p>
<p>To enable Opsgenie integration:</p>
<ol>
<li>Sign in as a user with at least the Maintainer role.</li>
<li>Go to <strong>Monitor</strong> &gt; <strong>Alerts</strong>.</li>
<li>In the <strong>Integrations</strong> select box, select <strong>Opsgenie</strong>.</li>
<li>Select the <strong>Active</strong> toggle.</li>
<li>In the <strong>API URL</strong> field, enter the base URL for your Opsgenie integration,
   such as <code>https://app.opsgenie.com/alert/list</code>.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>After you enable the integration, go to the <strong>Alerts</strong> page at
<strong>Monitor</strong> &gt; <strong>Alerts</strong>, and then select <strong>View alerts in Opsgenie</strong>.</p></code></pre>
</body>
</html>
