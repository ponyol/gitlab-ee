<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Connect to an external repository</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Verify
group: Pipeline Execution
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: GitLab CI/CD for external repositories
description: GitHub, Bitbucket, external sources, mirroring, and cross-platform.</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>GitLab CI/CD can be used with <a href="github_integration.html">GitHub</a>, <a href="bitbucket_integration.html">Bitbucket Cloud</a>,
or any other Git server. Some <a href="#known-issues">known issues</a> exist.</p>
<p>Instead of moving your entire project to GitLab, you can connect your
external repository to get the benefits of GitLab CI/CD.</p>
<p>Connecting an external repository sets up <a href="../../user/project/repository/mirror/_index.html">repository mirroring</a>
and creates a lightweight project with issues, merge requests, wiki, and
snippets disabled. These features
<a href="../../user/project/settings/_index.md#configure-project-features-and-permissions">can be re-enabled later</a>.</p>
<h2>Connect to an external repository</h2>
<p>To connect to an external repository:</p>
<ol>
<li>In the upper-right corner, select <strong>Create new</strong> ({{&lt; icon name="plus" &gt;}}) and <strong>New project/repository</strong>.</li>
<li>Select <strong>Run CI/CD for external repository</strong>.</li>
<li>Select <strong>GitHub</strong> or <strong>Repository by URL</strong>.</li>
<li>Complete the fields.</li>
</ol>
<p>If the <strong>Run CI/CD for external repository</strong> option is not available:</p>
<ul>
<li>The GitLab instance might not have any import sources configured.
  Ask an administrator to check the <a href="../../administration/settings/import_and_export_settings.md#configure-allowed-import-sources">import sources configuration</a>.</li>
<li><a href="../../user/project/repository/mirror/_index.html">Project mirroring</a> might be disabled.
  If disabled, only administrators can use the <strong>Run CI/CD for external repository</strong> option.
  Ask an administrator to check the <a href="../../administration/settings/visibility_and_access_controls.md#enable-project-mirroring">project mirroring configuration</a>.</li>
</ul>
<h2>Pipelines for external pull requests</h2>
<p>When using GitLab CI/CD with an <a href="github_integration.html">external repository on GitHub</a>,
it's possible to run a pipeline in the context of a Pull Request.</p>
<p>When you push changes to a remote branch in GitHub, GitLab CI/CD can run a pipeline for
the branch. However, when you open or update a Pull Request for that branch you may want to:</p>
<ul>
<li>Run extra jobs.</li>
<li>Not run specific jobs.</li>
</ul>
<p>For example:</p>
<pre><code class="language-yaml">always-run:
  script: echo 'this should always run'

on-pull-requests:
  script: echo 'this should run on pull requests'
  rules:
    - if: $CI_PIPELINE_SOURCE == &quot;external_pull_request_event&quot;

except-pull-requests:
  script: echo 'This should not run for pull requests, but runs in other cases.'
  rules:
    - if: $CI_PIPELINE_SOURCE == &quot;external_pull_request_event&quot;
      when: never
    - when: on_success
</code></pre>
<h3>Pipeline execution for external pull requests</h3>
<p>When a repository is imported from GitHub, GitLab subscribes to webhooks
for <code>push</code> and <code>pull_request</code> events. Once a <code>pull_request</code> event is received,
the Pull Request data is stored and kept as a reference. If the Pull Request
has just been created, GitLab immediately creates a pipeline for the external
pull request.</p>
<p>If changes are pushed to the branch referenced by the Pull Request and the
Pull Request is still open, a pipeline for the external pull request is
created.</p>
<p>GitLab CI/CD creates 2 pipelines in this case. One for the
branch push and one for the external pull request.</p>
<p>After the Pull Request is closed, no pipelines are created for the external pull
request, even if new changes are pushed to the same branch.</p>
<h3>Additional predefined variables</h3>
<p>By using pipelines for external pull requests, GitLab exposes additional
<a href="../variables/predefined_variables.html">predefined variables</a> to the pipeline jobs.</p>
<p>The variable names are prefixed with <code>CI_EXTERNAL_PULL_REQUEST_</code>.</p>
<h3>Known issues</h3>
<p>This feature does not support:</p>
<ul>
<li>The <a href="github_integration.md#connect-manually">manual connection method</a> required for GitHub Enterprise.
  If the integration is connected manually, external pull requests <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/323336#note_884820753">do not trigger pipelines</a>.</li>
<li>Pull requests from fork repositories. <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/5667">Pull Requests from fork repositories are ignored</a>.</li>
</ul>
<p>Given that GitLab creates 2 pipelines, if changes are pushed to a remote branch that
references an open Pull Request, both contribute to the status of the Pull Request
via GitHub integration. If you want to exclusively run pipelines on external pull
requests and not on branches you can add <code>except: [branches]</code> to the job specs.
<a href="https://gitlab.com/gitlab-org/gitlab/-/issues/24089#workaround">Read more</a>.</p>
<h2>Troubleshooting</h2>
<ul>
<li><a href="../../user/project/repository/mirror/troubleshooting.md#pull-mirroring-is-not-triggering-pipelines">Pull mirroring is not triggering pipelines</a>.</li>
<li><a href="../../user/project/repository/mirror/pull.md#fix-hard-failures-when-mirroring">Fix hard failures when mirroring</a>.</li>
</ul></code></pre>
</body>
</html>
