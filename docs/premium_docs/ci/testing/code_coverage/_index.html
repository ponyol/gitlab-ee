<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Configure coverage reporting</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Verify
group: Pipeline Execution
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Code coverage</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Free, Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>Configure code coverage to track and visualize how much of your source code is covered by tests. You can:</p>
<ul>
<li>Track overall coverage metrics and trends using the <code>coverage</code> keyword.</li>
<li>Visualize line-by-line coverage using the <code>artifacts:reports:coverage_report</code> keyword.</li>
</ul>
<h2>Configure coverage reporting</h2>
<p>Use the <a href="../../yaml/_index.md#coverage"><code>coverage</code></a> keyword to monitor your test coverage and enforce coverage requirements in merge requests.</p>
<p>With coverage reporting, you can:</p>
<ul>
<li>Display the overall coverage percentage in merge requests.</li>
<li>Aggregate coverage from multiple test jobs.</li>
<li>Add coverage check approval rules.</li>
<li>Track coverage trends over time.</li>
</ul>
<p>To configure coverage reporting:</p>
<ol>
<li>Add the <code>coverage</code> keyword to your pipeline configuration:</li>
</ol>
<p>```yaml
   test-unit:
     script:
       - coverage run unit/
     coverage: '/TOTAL.+ ([0-9]{1,3}%)/'</p>
<p>test-integration:
     script:
       - coverage run integration/
     coverage: '/TOTAL.+ ([0-9]{1,3}%)/'
   ```</p>
<ol>
<li>Configure the regular expression (regex) to match your test output format.
   See <a href="#coverage-regex-patterns">coverage regex patterns</a> for common patterns.</li>
<li>To aggregate coverage from multiple jobs, add the <code>coverage</code> keyword to each job you want to include.</li>
<li>Optional. <a href="#add-a-coverage-check-approval-rule">Add a coverage check approval rule</a>.</li>
</ol>
<h3>Coverage regex patterns</h3>
<p>The following sample regex patterns were designed to parse coverage output from common test coverage tools.</p>
<p>Test the regex patterns carefully. Tool output formats can change over time, and these patterns might no longer work as expected.</p>
<!-- vale gitlab_base.Spelling = NO -->
<!-- markdownlint-disable MD056 -->
<!--
Verify regex patterns carefully, especially patterns containing the pipe (`|`) character.
To use `|` in the text of a table cell (not as cell delimiters), you must escape it with a backslash (`\|`).
Verify all tables render as expected both in GitLab and on docs.gitlab.com.
See: https://docs.gitlab.com/user/markdown/#tables
-->

<p>{{&lt; tabs &gt;}}</p>
<p>{{&lt; tab title="Python and Ruby" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Language</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>pytest-cov</td>
<td>Python</td>
<td><code>pytest --cov</code></td>
<td><code>/TOTAL.*? (100(?:\.0+)?\%\|[1-9]?\d(?:\.\d+)?\%)$/</code></td>
</tr>
<tr>
<td>Simplecov-html</td>
<td>Ruby</td>
<td><code>rspec spec</code></td>
<td><code>/Line\sCoverage:\s\d+\.\d+%/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="C/C++ and Rust" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Language</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>gcovr</td>
<td>C/C++</td>
<td><code>gcovr</code></td>
<td><code>/^TOTAL.*\s+(\d+\%)$/</code></td>
</tr>
<tr>
<td>tarpaulin</td>
<td>Rust</td>
<td><code>cargo tarpaulin</code></td>
<td><code>/^\d+.\d+% coverage/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="Java and JVM" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Language</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>JaCoCo</td>
<td>Java/Kotlin</td>
<td><code>./gradlew test jacocoTestReport</code></td>
<td><code>/Total.*?([0-9]{1,3})%/</code></td>
</tr>
<tr>
<td>Scoverage</td>
<td>Scala</td>
<td><code>sbt coverage test coverageReport</code></td>
<td><code>/(?i)total.*? (100(?:\.0+)?\%\|[1-9]?\d(?:\.\d+)?\%)$/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="Node.js" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>tap</td>
<td><code>tap --coverage-report=text-summary</code></td>
<td><code>/^Statements\s*:\s*([^%]+)/</code></td>
</tr>
<tr>
<td>nyc</td>
<td><code>nyc npm test</code></td>
<td><code>/All files[^\|]*\\|[^\|]*\s+([\d\.]+)/</code></td>
</tr>
<tr>
<td>jest</td>
<td><code>jest --ci --coverage</code></td>
<td><code>/All files[^\|]*\\|[^\|]*\s+([\d\.]+)/</code></td>
</tr>
<tr>
<td>node:test</td>
<td><code>node --experimental-test-coverage --test</code></td>
<td><code>/all files[^\|]*\\|[^\|]*\s+([\d\.]+)/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="PHP" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>pest</td>
<td><code>pest --coverage --colors=never</code></td>
<td><code>/Statement coverage[A-Za-z\.*]\s*:\s*([^%]+)/</code></td>
</tr>
<tr>
<td>phpunit</td>
<td><code>phpunit --coverage-text --colors=never</code></td>
<td><code>/^\s*Lines:\s*\d+.\d+\%/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="Go" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>go test (single)</td>
<td><code>go test -cover</code></td>
<td><code>/coverage: \d+.\d+% of statements/</code></td>
</tr>
<tr>
<td>go test (project)</td>
<td><code>go test -coverprofile=cover.profile &amp;&amp; go tool cover -func cover.profile</code></td>
<td><code>/total:\s+\(statements\)\s+\d+.\d+%/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title=".NET and PowerShell" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Language</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenCover</td>
<td>.NET</td>
<td>None</td>
<td><code>/(Visited Points).*\((.*)\)/</code></td>
</tr>
<tr>
<td>dotnet test (<a href="https://github.com/coverlet-coverage/coverlet/blob/master/Documentation/MSBuildIntegration.md">MSBuild</a>)</td>
<td>.NET</td>
<td><code>dotnet test</code></td>
<td><code>/Total\s*\\|*\s(\d+(?:\.\d+)?)/</code></td>
</tr>
<tr>
<td>Pester</td>
<td>PowerShell</td>
<td>None</td>
<td><code>/Covered (\d{1,3}(\.\|,)?\d{0,2}%)/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="Elixir" &gt;}}</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Command</th>
<th>Regex pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td>excoveralls</td>
<td>None</td>
<td><code>/\[TOTAL\]\s+(\d+\.\d+)%/</code></td>
</tr>
<tr>
<td>mix</td>
<td><code>mix test --cover</code></td>
<td><code>/\d+.\d+\%\s+\|\s+Total/</code></td>
</tr>
</tbody>
</table>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; /tabs &gt;}}</p>
<!-- vale gitlab_base.Spelling = YES -->
<!-- markdownlint-enable MD056 -->

<h2>Coverage visualization</h2>
<p>Use the <a href="../../yaml/artifacts_reports.md#artifactsreportscoverage_report"><code>artifacts:reports:coverage_report</code></a>
keyword to view which specific lines of code are covered by tests in merge requests.</p>
<p>You can generate coverage reports in these formats:</p>
<ul>
<li>Cobertura: For multiple languages including Java, JavaScript, Python, and Ruby.</li>
<li>JaCoCo: For Java projects only.</li>
</ul>
<p>Coverage visualization uses <a href="../../yaml/_index.md#artifactsreports">artifacts reports</a> to:</p>
<ol>
<li>Collect one or more coverage reports, including from wildcard paths.</li>
<li>Combine the coverage information from all reports.</li>
<li>Display the combined results in merge request diffs.</li>
</ol>
<p>Coverage files are parsed in a background job, so there might be a delay between
pipeline completion and the visualization appearing in the merge request.</p>
<p>By default, coverage visualization data expires one week after creation.</p>
<h3>Configure coverage visualization</h3>
<p>To configure coverage visualization:</p>
<ol>
<li>Configure your test tool to generate a coverage report.</li>
<li>Add the <code>artifacts:reports:coverage_report</code> configuration to your pipeline:</li>
</ol>
<p><code>yaml
   test:
     script:
       - run tests with coverage
     artifacts:
       reports:
         coverage_report:
           coverage_format: cobertura  # or jacoco
           path: coverage/coverage.xml</code></p>
<p>For language-specific configuration details see:</p>
<ul>
<li><a href="cobertura.html">Cobertura coverage report</a></li>
<li><a href="jacoco.html">JaCoCo coverage report</a></li>
</ul>
<h3>Coverage reports for child pipelines</h3>
<p>Coverage reports for child pipelines appear in merge request diff annotations.
However, parent pipelines cannot access these coverage reports for use in their own jobs.</p>
<p>Support for parent pipelines to fetch coverage reports for child pipelines is proposed in
<a href="https://gitlab.com/gitlab-org/gitlab/-/issues/285100">issue 285100</a>.</p>
<h2>Add a coverage check approval rule</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>You can require specific users or a group to approve merge requests that reduce the project's test coverage.</p>
<p>Prerequisites:</p>
<ul>
<li><a href="#configure-coverage-reporting">Configure coverage reporting</a>.</li>
</ul>
<p>To add a <code>Coverage-Check</code> approval rule:</p>
<ol>
<li>Go to your project and select <strong>Settings</strong> &gt; <strong>Merge requests</strong>.</li>
<li>Under <strong>Merge request approvals</strong>, do one of the following:</li>
<li>Next to the <code>Coverage-Check</code> approval rule, select <strong>Enable</strong>.</li>
<li>For manual setup, select <strong>Add approval rule</strong>, then enter <code>Coverage-Check</code> as the <strong>Rule name</strong>.</li>
<li>Select a <strong>Target branch</strong>.</li>
<li>Set the number of <strong>Required number of approvals</strong>.</li>
<li>Select the <strong>Users</strong> or <strong>Groups</strong> to provide approval.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>The <code>Coverage-Check</code> approval rule requires approval when the merge base pipeline contains no coverage data, even if the merge request improves overall coverage.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>View coverage results</h2>
<p>After a pipeline runs successfully, you can view code coverage results in:</p>
<ul>
<li>Merge request widget: See the coverage percentage and changes compared to the target branch.</li>
</ul>
<p><img alt="Merge request widget showing code coverage percentage" src="img/pipelines_test_coverage_mr_widget_v17_3.png" /></p>
<ul>
<li>Merge request diff: Review which lines are covered by tests. Available with Cobertura and JaCoCo reports.</li>
<li>Pipeline jobs: Monitor coverage results for individual jobs.</li>
</ul>
<h2>View coverage history</h2>
<p>You can track the evolution of code coverage for your project or group over time.</p>
<h3>For a project</h3>
<p>To view the code coverage history for a project:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Analyze</strong> &gt; <strong>Repository analytics</strong>.</li>
<li>From the dropdown list, select the job you want to view historical data for.</li>
<li>Optional. To view a CSV file of the data, select <strong>Download raw data (.csv)</strong>.</li>
</ol>
<h3>For a group</h3>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>To view the code coverage history for all projects in a group:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Analyze</strong> &gt; <strong>Repository analytics</strong>.</li>
<li>Optional. To view a CSV file of the data, select <strong>Download historic test coverage data (.csv)</strong>.</li>
</ol>
<h2>Display coverage badges</h2>
<p>Share your project's code coverage status using pipeline badges.</p>
<p>To add a coverage badge to your project, see <a href="../../../user/project/badges.md#test-coverage-report-badges">test coverage report badges</a>.</p>
<h2>Troubleshooting</h2>
<h3>Remove color codes from code coverage</h3>
<p>Some test coverage tools output with ANSI color codes that aren't
parsed correctly by the regular expression. This causes coverage
parsing to fail.</p>
<p>Some coverage tools do not provide an option to disable color
codes in the output. If so, pipe the output of the coverage tool through a one-line script that strips the color codes.</p>
<p>For example:</p>
<pre><code class="language-shell">lein cloverage | perl -pe 's/\e\[?.*?[\@-~]//g'
</code></pre></code></pre>
</body>
</html>
