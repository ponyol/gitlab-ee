<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Metrics processing workflow</title>
    <link rel="stylesheet" href="/../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Verify
group: Pipeline Execution
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Track and compare performance, memory, and custom metrics.
title: Metrics reports</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>Metrics reports display custom metrics in merge requests to track performance,
memory usage, and other measurements between branches.</p>
<p>Use metrics reports to:</p>
<ul>
<li>Monitor memory usage changes.</li>
<li>Track load testing results.</li>
<li>Measure code complexity.</li>
<li>Compare code coverage statistics.</li>
</ul>
<h2>Metrics processing workflow</h2>
<p>When a pipeline runs, GitLab reads metrics from the report artifact and stores them as string values
for comparison. The default filename is <code>metrics.txt</code>.</p>
<p>For a merge request, GitLab compares the metrics from the feature branch to the values from the target
branch and displays them in the merge request widget in this order:</p>
<ul>
<li>Existing metrics with changed values.</li>
<li>Metrics added by the merge request (marked with a <strong>New</strong> badge).</li>
<li>Metrics removed by the merge request (marked with a <strong>Removed</strong> badge).</li>
<li>Existing metrics with unchanged values.</li>
</ul>
<h2>Configure metrics reports</h2>
<p>Add metrics reports to your CI/CD pipeline to track custom metrics in merge requests.</p>
<p>Prerequisites:</p>
<ul>
<li>The metrics file must use the <a href="https://prometheus.io/docs/instrumenting/exposition_formats/#openmetrics-text-format">OpenMetrics</a> text format.</li>
</ul>
<p>To configure metrics reports:</p>
<ol>
<li>In your <code>.gitlab-ci.yml</code> file, add a job that generates a metrics report.</li>
<li>Add a script to the job that generates metrics in OpenMetrics format.</li>
<li>Configure the job to upload the metrics file with <a href="../yaml/artifacts_reports.md#artifactsreportsmetrics"><code>artifacts:reports:metrics</code></a>.</li>
</ol>
<p>For example:</p>
<pre><code class="language-yaml">metrics:
  stage: test
  script:
    - echo 'memory_usage_bytes 2621440' &gt; metrics.txt
    - echo 'response_time_seconds 0.234' &gt;&gt; metrics.txt
    - echo 'test_coverage_percent 87.5' &gt;&gt; metrics.txt
    - echo '# EOF' &gt;&gt; metrics.txt
  artifacts:
    reports:
      metrics: metrics.txt
</code></pre>
<p>After the pipeline runs, the metrics reports display in the merge request widget.</p>
<p><img alt="Metrics report widget in a merge request displaying metric names and values." src="img/metrics_report_v18_3.png" /></p>
<p>For additional format specifications and examples, see
<a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-format-details">Prometheus text format details</a>.</p>
<h2>Troubleshooting</h2>
<p>When working with metrics reports, you might encounter the following issues.</p>
<h3>Metrics reports did not change</h3>
<p>You might see <strong>Metrics report scanning detected no new changes</strong> when viewing metrics reports in merge requests.</p>
<p>This issue occurs when:</p>
<ul>
<li>The target branch doesn't have a baseline metrics report for comparison.</li>
<li>Your GitLab subscription doesn't include metrics reports (Premium or Ultimate required).</li>
</ul>
<p>To resolve this issue:</p>
<ol>
<li>Verify your GitLab subscription tier includes metrics reports.</li>
<li>Ensure the target branch has a pipeline with metrics reports configured.</li>
<li>Verify that your metrics file uses valid OpenMetrics format.</li>
</ol></code></pre>
</body>
</html>
