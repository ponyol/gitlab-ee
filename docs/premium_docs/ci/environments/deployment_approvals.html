<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Configure deployment approvals</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Verify
group: Runner Core
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Require approvals prior to deploying to a Protected Environment
title: Deployment approvals</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>You can require additional approvals for deployments to protected
environments. Deployments are blocked until all required approvals are
given.</p>
<p>Use deployment approvals to accommodate testing,
security, or compliance processes. For example, you might want to
require approvals for deployments to production environments.</p>
<h2>Configure deployment approvals</h2>
<p>You can require approvals for deployments to protected environments in
a project.</p>
<p>Prerequisites:</p>
<ul>
<li>To update an environment, you must have at least the Maintainer role.</li>
</ul>
<p>To configure deployment approvals for a project:</p>
<ol>
<li>Create a deployment job in the <code>.gitlab-ci.yml</code> file of your project:</li>
</ol>
<p>```yaml
   stages:
     - deploy</p>
<p>production:
     stage: deploy
     script:
       - 'echo "Deploying to ${CI_ENVIRONMENT_NAME}"'
     environment:
       name: ${CI_JOB_NAME}
       action: start
   ```</p>
<p>The job does not need to be manual (<code>when: manual</code>).</p>
<ol>
<li>Add the required <a href="#add-multiple-approval-rules">approval rules</a>.</li>
</ol>
<p>The environments in your project require approval before deployment.</p>
<h3>Add multiple approval rules</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/345678">Generally available</a> in GitLab 15.0. <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/345678">Feature flag <code>deployment_approval_rules</code></a> removed.</li>
<li>UI configuration <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/378445">introduced</a> in GitLab 15.11.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Add multiple approval rules to control who can approve and execute deployment jobs.</p>
<p>To configure multiple approval rules, use the <a href="protected_environments.md#protecting-environments">CI/CD settings</a>.
You can <a href="../../api/group_protected_environments.md#protect-a-single-environment">also use the API</a>.</p>
<p>All jobs deploying to the environment are blocked and wait for approvals before running.
Make sure the number of required approvals is less than the number of users allowed to deploy.</p>
<p>A user can give only one approval per deployment,
even if the user is a member of multiple approver groups. <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/457541">Issue 457541</a> proposes to change this behavior so that the same user can give multiple approvals per deployment from different approver groups.</p>
<p>After a deployment job is approved, you must <a href="../jobs/job_control.md#run-a-manual-job">run the job manually</a>.</p>
<h3>Allow self-approval</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/381418">Introduced</a> in GitLab 15.8.</li>
<li>Automatic approval <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/124638">removed</a> in GitLab 16.2 due to <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/391258">usability issues</a>.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>By default, the user who triggers a deployment pipeline can't also approve the deployment job.</p>
<p>A GitLab administrator can approve or reject all deployments.</p>
<p>To allow self-approval of a deployment job:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>CI/CD</strong>.</li>
<li>Expand <strong>Protected environments</strong>.</li>
<li>From the <strong>Approval options</strong>, select the <strong>Allow pipeline triggerer to approve deployment</strong> checkbox.</li>
</ol>
<h2>Approve or reject a deployment</h2>
<p>In an environment with multiple approval rules, you can:</p>
<ul>
<li>Approve a deployment to allow it to proceed.</li>
<li>Reject a deployment to prevent it.</li>
</ul>
<p>Prerequisites:</p>
<ul>
<li>You have permission to deploy to the protected environment.</li>
</ul>
<p>To approve or reject a deployment:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Operate</strong> &gt; <strong>Environments</strong>.</li>
<li>Select the environment's name.</li>
<li>Find the deployment and select its <strong>Status badge</strong>.</li>
<li>Optional. Add a comment which describes your reason for approving or rejecting the deployment.</li>
<li>Select <strong>Approve</strong> or <strong>Reject</strong>.</li>
</ol>
<p>You can also <a href="../../api/deployments.md#approve-or-reject-a-blocked-deployment">use the API</a>.</p>
<p>You can give only one approval per deployment, even if you are a member of multiple
approver groups. <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/457541">Issue 457541</a>
proposes to change this behavior so that the same user can give multiple
approvals per deployment from different approver groups.</p>
<p>Deployment approval doesn't automatically trigger the corresponding deployment job. You must <a href="../jobs/job_control.md#run-a-manual-job">manually run the job</a>.</p>
<h3>View the approval details of a deployment</h3>
<p>Prerequisites:</p>
<ul>
<li>You have permission to deploy to the protected environment.</li>
</ul>
<p>A deployment to a protected environment can proceed only after all required approvals have been
granted.</p>
<p>To view the approval details of a deployment:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Operate</strong> &gt; <strong>Environments</strong>.</li>
<li>Select the environment's name.</li>
<li>Find the deployment and select its <strong>Status badge</strong>.</li>
</ol>
<p>The approval status details are shown:</p>
<ul>
<li>Eligible approvers</li>
<li>Number of approvals granted, and number of approvals required</li>
<li>Users who have granted approval</li>
<li>History of approvals or rejections</li>
</ul>
<h2>View blocked deployments</h2>
<p>Review the status of your deployments, including whether a deployment is blocked.</p>
<p>To view your deployments:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Operate</strong> &gt; <strong>Environments</strong>.</li>
<li>Select the environment being deployed to.</li>
</ol>
<p>A deployment with the <strong>blocked</strong> label is blocked.</p>
<p>To view your deployments, you can also <a href="../../api/deployments.md#get-a-specific-deployment">use the API</a>.
The <code>status</code> field indicates whether a deployment is blocked.</p>
<h2>Related topics</h2>
<ul>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/6832">Deployment approvals feature epic</a></li>
</ul></code></pre>
</body>
</html>
