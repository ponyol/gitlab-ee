<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Prerequisites</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: AI-powered
group: AI Framework
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Describes Model Context Protocol and how to use it
title: GitLab MCP clients</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Add-on: GitLab Duo Core, Pro, or Enterprise</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
<li>Status: Beta</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; collapsible title="Model information" &gt;}}</p>
<ul>
<li>Not available on GitLab Duo with self-hosted models</li>
</ul>
<p>{{&lt; /collapsible &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/519938">Introduced</a> in GitLab 18.1 <a href="../../../administration/feature_flags/_index.html">with a flag</a> named <code>duo_workflow_mcp_support</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/545956">Enabled on GitLab.com, GitLab Self-Managed, and GitLab Dedicated</a> in GitLab 18.2. Feature flag <code>duo_workflow_mcp_support</code> removed.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/545956">Changed</a> from experiment to beta in GitLab 18.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>The Model Context Protocol (MCP) provides a standardized way for GitLab Duo features
to securely connect to different external data sources and tools.</p>
<p>MCP is supported in:</p>
<ul>
<li>Visual Studio Code (VS Code) and VSCodium</li>
<li>JetBrains IDEs</li>
</ul>
<p>The same MCP configuration file works across all supported IDEs.</p>
<p>The following features can act as MCP clients and connect to external tools from MCP servers:</p>
<ul>
<li><a href="../../../user/gitlab_duo_chat/agentic_chat.html">GitLab Duo Chat (Agentic)</a></li>
<li>The <a href="../../../user/duo_agent_platform/flows/software_development.html">software development flow</a></li>
</ul>
<p>These features can then access external context and information to generate more powerful answers.</p>
<p>To use a feature with MCP:</p>
<ol>
<li>Turn on MCP for your group.</li>
<li>Configure the MCP servers you want the feature to connect to.</li>
</ol>
<p>For a click-through demo, see <a href="https://gitlab.navattic.com/mcp">GitLab Duo Agent Platform - MCP integration</a>.</p>
<!-- Demo published on 2025-08-05 -->

<h2>Prerequisites</h2>
<ul>
<li>Meet the <a href="../../duo_agent_platform/_index.md#prerequisites">prerequisites for the GitLab Duo Agent Platform</a>.</li>
</ul>
<p>For Visual Studio Code (VS Code) or VSCodium:</p>
<ul>
<li>Install <a href="https://code.visualstudio.com/download">VS Code</a> or <a href="https://vscodium.com/">VSCodium</a>.</li>
<li>Install and set up the GitLab Workflow extension from the <a href="https://open-vsx.org/extension/GitLab/gitlab-workflow">Open VSX Registry</a>
  or the <a href="https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow">Visual Studio Marketplace</a>.</li>
<li>For MCP support, install version 6.28.2 and later.</li>
<li>For workspace and user configuration, install version 6.35.6 and later.</li>
</ul>
<p>For JetBrains IDEs:</p>
<ul>
<li>Install a JetBrains IDE.</li>
<li>Install and set up the <a href="../../../editor_extensions/jetbrains_ide/setup.html">GitLab Duo plugin for JetBrains IDEs</a>.</li>
</ul>
<h2>Turn on MCP for your group</h2>
<p>To turn MCP on or off for your group:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>GitLab Duo</strong>.</li>
<li>Select <strong>Change configuration</strong>.</li>
<li>Under <strong>Model Context Protocol</strong>, select or clear the
   <strong>Turn on Model Context Protocol (MCP) support</strong> checkbox.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<h2>Configure MCP servers</h2>
<p>To integrate MCP with the Language Server, set up workspace configuration, user configuration, or both.
The GitLab Language Server loads and merges the configuration files.</p>
<h3>Version compatibility</h3>
<table>
<thead>
<tr>
<th>GitLab Workflow extension version</th>
<th>MCP features available</th>
</tr>
</thead>
<tbody>
<tr>
<td>6.28.2 - 6.35.5</td>
<td>Basic MCP support, with no workspace or user configuration</td>
</tr>
<tr>
<td>6.35.6 and later</td>
<td>Full MCP support, including workspace and user configuration</td>
</tr>
</tbody>
</table>
<h3>Create workspace configuration</h3>
<p>Workspace configuration applies to this project only, and overrides any user configuration for the
same server.</p>
<p>To set up workspace configuration:</p>
<ol>
<li>In your project workspace, create the file <code>&lt;workspace&gt;/.gitlab/duo/mcp.json</code>.</li>
<li>Using the <a href="#configuration-format">configuration format</a>, add information about the MCP servers
   your feature connects to.</li>
<li>Save the file.</li>
<li>Restart your IDE.</li>
</ol>
<h3>Create user configuration</h3>
<p>User configuration settings are good for personal tools and commonly-used servers. They apply to all
workspaces, but any workspace settings for the same server override the user configuration.</p>
<p>To set up user configuration:</p>
<ol>
<li>In VSCodium or VS Code, open the Command Palette by pressing
   <kbd>Control</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> or
   <kbd>Command</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>.</li>
<li>Run the command <code>GitLab MCP: Open User Settings (JSON)</code> to create and open the user configuration file.</li>
<li>Using the <a href="#configuration-format">configuration format</a>, add information about the MCP servers
   your feature connects to.</li>
<li>Save the file.</li>
<li>Restart your IDE.</li>
</ol>
<p>For JetBrains IDEs, or to manually create the file in VS Code, use this location:</p>
<ul>
<li>Windows: <code>C:\Users\&lt;username&gt;\AppData\Roaming\GitLab\duo\mcp.json</code></li>
<li>All other operating systems: <code>~/.gitlab/duo/mcp.json</code></li>
</ul>
<h3>Configuration format</h3>
<p>Both configuration files use the same JSON format, with the details in the <code>mcpServers</code> key:</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;server-name&quot;: {
      &quot;type&quot;: &quot;stdio&quot;,
      &quot;command&quot;: &quot;path/to/server&quot;,
      &quot;args&quot;: [&quot;--arg1&quot;, &quot;value1&quot;],
      &quot;env&quot;: {
        &quot;ENV_VAR&quot;: &quot;value&quot;
      },
      &quot;approvedTools&quot;: true
    },
    &quot;http-server&quot;: {
      &quot;type&quot;: &quot;http&quot;,
      &quot;url&quot;: &quot;http://localhost:3000/mcp&quot;,
      &quot;approvedTools&quot;: [&quot;read_file&quot;, &quot;search&quot;]
    },
    &quot;sse-server&quot;: {
      &quot;type&quot;: &quot;sse&quot;,
      &quot;url&quot;: &quot;http://localhost:3000/mcp/sse&quot;
    }
  }
}
</code></pre>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>For other MCP clients, the Atlassian documentation uses <code>mcp.servers</code> in the sample configuration file.
For GitLab, use <code>mcpServers</code> instead.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Configure tool approval</h3>
<p>By default, in each session you must manually approve every MCP tool from your server.</p>
<p>Instead, you can pre-approve MCP tools in your configuration file to skip manual approval prompts.</p>
<p>To do so, add the <code>approvedTools</code> field to any server configuration:</p>
<ul>
<li><code>"approvedTools": true</code> - Automatically approve all current and future tools from this server.</li>
<li><code>"approvedTools": ["tool1", "tool2"]</code> - Approve only the tools you have specified.</li>
</ul>
<p>If you do not include this field, you must manually approve every tool in the session (this is the default behavior).</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Only use <code>"approvedTools": true</code> for servers you completely trust.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>For example:</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;trusted-server&quot;: {
      &quot;type&quot;: &quot;stdio&quot;,
      &quot;command&quot;: &quot;npx&quot;,
      &quot;args&quot;: [&quot;my-trusted-mcp-server&quot;],
      &quot;approvedTools&quot;: true
    },
    &quot;selective-server&quot;: {
      &quot;type&quot;: &quot;http&quot;,
      &quot;url&quot;: &quot;http://localhost:3000/mcp&quot;,
      &quot;approvedTools&quot;: [&quot;read_file&quot;, &quot;search&quot;]
    },
    &quot;untrusted-server&quot;: {
      &quot;type&quot;: &quot;sse&quot;,
      &quot;url&quot;: &quot;http://example.com/mcp/sse&quot;
    }
  }
}
</code></pre>
<h4>How tool approval works</h4>
<p>GitLab uses a two-tier approval system for MCP tools:</p>
<ul>
<li>Configuration-based approval (permanent): Tools approved in <code>mcp.json</code> using the <code>approvedTools</code> field.
  These approvals persist across all sessions.</li>
<li>Session-based approval (temporary): Tools approved during runtime for the current workflow session.
  These approvals are cleared when you close your IDE or end the workflow.</li>
</ul>
<p>A tool is approved if either condition is met.</p>
<h3>Example MCP server configurations</h3>
<p>Use the following code examples to help you create your MCP server configuration file.</p>
<p>For more information and examples, see the <a href="https://modelcontextprotocol.io/examples">MCP example servers documentation</a>.
Other example servers are <a href="https://smithery.ai/">Smithery.ai</a> and <a href="https://mcpservers.org/">Awesome MCP Servers</a>.</p>
<h4>Local server</h4>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;enterprise-data-v2&quot;: {
      &quot;type&quot;: &quot;stdio&quot;,
      &quot;command&quot;: &quot;node&quot;,
      &quot;args&quot;: [&quot;src/server.js&quot;],
      &quot;cwd&quot;: &quot;&lt;/path/to/your-mcp-server&gt;&quot;,
      &quot;approvedTools&quot;: [&quot;query_database&quot;, &quot;fetch_metrics&quot;]
    }
  }
}
</code></pre>
<h4>GitLab Knowledge Graph server</h4>
<p>The <a href="https://gitlab-org.gitlab.io/rust/knowledge-graph">GitLab Knowledge Graph</a> provides code intelligence
through MCP. You can approve all tools or specific ones:</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;knowledge-graph&quot;: {
      &quot;type&quot;: &quot;sse&quot;,
      &quot;url&quot;: &quot;http://localhost:27495/mcp/sse&quot;,
      &quot;approvedTools&quot;: true
    }
  }
}
</code></pre>
<p>Or approve only specific tools:</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;knowledge-graph&quot;: {
      &quot;type&quot;: &quot;sse&quot;,
      &quot;url&quot;: &quot;http://localhost:27495/mcp/sse&quot;,
      &quot;approvedTools&quot;: [&quot;list_projects&quot;, &quot;search_codebase_definitions&quot;, &quot;get_references&quot;, &quot;get_definition&quot;]
    }
  }
}
</code></pre>
<p>For more information about available tools, see the
<a href="https://gitlab-org.gitlab.io/rust/knowledge-graph/mcp/tools/">Knowledge Graph MCP tools documentation</a>.</p>
<h4>HTTP server</h4>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;local-http-server&quot;: {
      &quot;type&quot;: &quot;http&quot;,
      &quot;url&quot;: &quot;http://localhost:3000/mcp&quot;,
      &quot;approvedTools&quot;: [&quot;read_file&quot;, &quot;write_file&quot;]
    }
  }
}
</code></pre>
<h2>View the status of MCP servers</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/work_items/2155">Introduced</a> in the GitLab Workflow extension for VS Code 6.55.0.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>Have the GitLab Workflow extension for VS Code 6.55.0 or later installed.</li>
<li>Have at least one MCP server configured in your user or workspace configuration.</li>
</ul>
<p>To view the status of your configured MCP servers:</p>
<ol>
<li>In VS Code or VSCodium, open the Command Palette:</li>
<li>On macOS, press <kbd>Command</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>.</li>
<li>On Windows or Linux, press <kbd>Control</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>.</li>
<li>Type <code>GitLab: Show MCP Dashboard</code> and press <kbd>Enter</kbd>.</li>
</ol>
<p>The MCP dashboard opens in a new editor tab.
Use the dashboard to:</p>
<ul>
<li>Verify that your MCP servers are properly configured and running.</li>
<li>Identify connection issues before you use GitLab Duo features.</li>
<li>View which tools are available from each server.</li>
<li>Troubleshoot server configuration problems.</li>
</ul>
<h3>Open MCP configuration files</h3>
<p>To open your MCP configuration files:</p>
<ol>
<li>In VS Code or VSCodium, open the Command Palette:</li>
<li>On macOS, press <kbd>Command</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>.</li>
<li>On Windows or Linux, press <kbd>Control</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>.</li>
<li>Open the configuration files:</li>
<li>For user configuration, type <code>GitLab MCP: Open User Settings (JSON)</code> and press <kbd>Enter</kbd>.</li>
<li>For workspace configuration, type <code>GitLab MCP: Open Workspace Settings (JSON)</code> and press <kbd>Enter</kbd>.</li>
</ol>
<h2>Re-authenticate with MCP servers</h2>
<p>After you update authentication details in an MCP configuration file, you must re-authenticate
with the related MCP server.</p>
<p>To trigger re-authentication:</p>
<ul>
<li>Ask GitLab Duo a question that requires data from that MCP server
  (for example, <code>What are the issues in my Jira project?</code> for Atlassian).
  The authentication flow starts automatically.</li>
</ul>
<h2>Use GitLab Duo features with MCP</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Approving external tools for the entire session <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/556045">added</a> in GitLab 18.4.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>When a GitLab Duo feature calls an external tool to answer a question,
you must review that tool unless you've approved it for the entire session:</p>
<ol>
<li>Open VS Code.</li>
<li>On the left sidebar, select <strong>GitLab Duo Agent Platform (Beta)</strong> ({{&lt; icon name="duo-agentic-chat" &gt;}}).</li>
<li>Select the <strong>Chat</strong> or <strong>Flows</strong> tab.</li>
<li>In the text box, enter a question or specify a code task.</li>
<li>Submit the question or code task.</li>
<li>
<p>The <strong>Tool Approval Required</strong> dialog appears in these cases:</p>
</li>
<li>
<p>GitLab Duo is calling that tool for the first time in your session.</p>
</li>
<li>
<p>You have not approved that tool for the entire session.</p>
</li>
<li>
<p>Approve or deny the tool:</p>
</li>
<li>
<p>If you approve the tool, the feature connects to the tool and generates an answer.</p>
<ul>
<li>Optional. To approve the tool for the entire session,
   from the <strong>Approve</strong> dropdown list, select <strong>Approve for Session</strong>.</li>
</ul>
<p>You can approve only MCP server-provided tools for the session. You cannot
   approve terminal or CLI commands.</p>
</li>
<li>
<p>For Chat, if you deny the tool, the <strong>Provide Rejection Reason</strong> dialog appears.
     Enter a rejection reason, then select <strong>Submit Rejection</strong>.</p>
<p>Chat might take action based on the reason you provide, such as
 suggesting a new approach, or creating an issue.</p>
</li>
</ol>
<h2>Related topics</h2>
<ul>
<li><a href="https://modelcontextprotocol.io/introduction">Get started with the Model Context Protocol</a></li>
<li><a href="https://www.youtube.com/watch?v=_cHoTmG8Yj8">Demo - Agentic Chat MCP Tool Call Approval</a></li>
</ul>
<h2>Troubleshooting</h2>
<h3>Delete the MCP authentication cache</h3>
<p>GitLab caches MCP authentication locally under <code>~/.mcp-auth/</code>.
To prevent false positives while troubleshooting, delete the cache directory:</p>
<pre><code class="language-shell">rm -rf ~/.mcp-auth/
</code></pre>
<h3><code>Error starting server filesystem: Error: spawn ... ENOENT</code></h3>
<p>This error occurs when you specify a command using a relative path (like <code>node</code> instead of <code>/usr/bin/node</code>), and that command cannot be found in the <code>PATH</code> environment variable that was passed to the GitLab Language Server.</p>
<p>Improvements to resolving <code>PATH</code> are tracked in <a href="https://gitlab.com/gitlab-org/editor-extensions/gitlab-lsp/-/issues/1345">issue 1345</a>.</p>
<h3>Troubleshooting MCP in VS Code</h3>
<p>For troubleshooting information, see <a href="../../../editor_extensions/visual_studio_code/troubleshooting.html">troubleshooting the GitLab Workflow extension for VS Code</a>.</p></code></pre>
</body>
</html>
