<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Use the flow</title>
    <link rel="stylesheet" href="/../../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: AI-powered
group: Code Creation
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Code Review Flow</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Add-on: GitLab Duo Core or Pro</li>
<li>Offering: GitLab.com, GitLab Self-Managed</li>
<li>Status: Beta</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; collapsible title="Model information" &gt;}}</p>
<ul>
<li>LLM: Anthropic <a href="https://console.cloud.google.com/vertex-ai/publishers/anthropic/model-garden/claude-sonnet-4">Claude 4.0 Sonnet</a></li>
<li>Available on <a href="../../../../administration/gitlab_duo_self_hosted/_index.html">GitLab Duo with self-hosted models</a></li>
</ul>
<p>{{&lt; /collapsible &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Introduced as <a href="../../../../policy/development_stages_support.html">a beta</a> in GitLab <a href="https://gitlab.com/groups/gitlab-org/-/epics/18645">18.6</a> <a href="../../../../administration/feature_flags/_index.html">with a flag</a> named <code>duo_code_review_on_agent_platform</code>. Disabled by default.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>{{&lt; alert type="flag" &gt;}}</p>
<p>The availability of this feature is controlled by a feature flag.
For more information, see the history.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>The Code Review Flow helps you streamline code reviews with agentic AI.</p>
<p>This flow:</p>
<ul>
<li>Analyzes code changes, merge request comments, and linked issues.</li>
<li>Provides enhanced contextual understanding of repository structure and cross-file dependencies.</li>
<li>Delivers detailed review comments with actionable feedback.</li>
<li>Supports custom review instructions tailored to your project.</li>
</ul>
<p>This flow is available in the GitLab UI only.</p>
<p>The Code Review Flow is <a href="#differences-from-classic-gitlab-duo-code-review">different from classic GitLab Duo Code Review</a>.</p>
<h2>Use the flow</h2>
<p>Prerequisites:</p>
<ul>
<li>Ensure you meet <a href="../_index.md#prerequisites">the other prerequisites</a>.</li>
</ul>
<p>To trigger a Code Review Flow on a merge request:</p>
<ol>
<li>On the left sidebar, select <strong>Code</strong> &gt; <strong>Merge requests</strong> and find your merge request.</li>
<li>Use one of these methods to trigger the review:</li>
<li>Assign the review to <code>@GitLabDuo</code></li>
<li>Mention <code>@GitLabDuo</code> in a comment</li>
</ol>
<p>You can interact with GitLab Duo by:</p>
<ul>
<li>Replying to its review comments to ask for clarification or alternative approaches.</li>
<li>Mentioning <code>@GitLabDuo</code> in any discussion thread to ask follow-up questions.</li>
</ul>
<h3>Automatic code reviews</h3>
<p>You can configure automatic code reviews for projects or groups to ensure all merge requests receive
an initial review by GitLab Duo. After you create a merge request, GitLab Duo reviews it unless:</p>
<ul>
<li>It's marked as draft. For GitLab Duo to review the merge request, mark it ready.</li>
<li>It contains no changes. For GitLab Duo to review the merge request, add changes to it.</li>
</ul>
<h4>Enable automatic reviews for a project</h4>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/506537">Changed</a> to a UI setting in GitLab 18.0.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>You must have at least the <a href="../../../permissions.html">Maintainer role</a> in a project.</li>
</ul>
<p>To enable <code>@GitLabDuo</code> to automatically review merge requests:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Merge requests</strong>.</li>
<li>In the <strong>GitLab Duo Code Review</strong> section, select <strong>Enable automatic reviews by GitLab Duo</strong>.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<h4>Enable automatic reviews for a group or application</h4>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/554070">Introduced</a> in GitLab 18.4 as a <a href="../../../../policy/development_stages_support.html">beta</a> <a href="../../../../administration/feature_flags/_index.html">with a flag</a> named <code>cascading_auto_duo_code_review_settings</code>. Disabled by default.</li>
<li>Feature flag <code>cascading_auto_duo_code_review_settings</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/213240">removed</a> in GitLab 18.7.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Use group or application settings to enable automatic reviews for multiple projects.</p>
<p>Prerequisites:</p>
<ul>
<li>To turn on automatic reviews for groups, have the Owner role for the group.</li>
<li>To turn on automatic reviews for all projects, be an administrator.</li>
</ul>
<p>To enable automatic reviews for groups:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>Expand the <strong>Merge requests</strong> section.</li>
<li>In the <strong>GitLab Duo Code Review</strong> section, select <strong>Enable automatic reviews by GitLab Duo</strong>.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>To enable automatic reviews for all projects:</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>In the <strong>GitLab Duo Code Review</strong> section, select <strong>Enable automatic reviews by GitLab Duo</strong>.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>Settings cascade from application to group to project. More specific settings override broader ones.</p>
<h3>Custom instructions</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/545136">Introduced</a> in GitLab 18.2 as a <a href="../../../../policy/development_stages_support.html">beta</a> <a href="../../../../administration/feature_flags/_index.html">with a flag</a> named <code>duo_code_review_custom_instructions</code>. Disabled by default.</li>
<li>Feature flag <code>duo_code_review_custom_instructions</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/199802">enabled by default</a> in GitLab 18.3.</li>
<li>Feature flag <code>duo_code_review_custom_instructions</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/202262">removed</a> in GitLab 18.4.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Customize the behavior of Code Review Flow with repository-specific review instructions. You can
guide the agent to:</p>
<ul>
<li>Focus on specific code quality aspects (such as security, performance, and maintainability).</li>
<li>Enforce coding standards and best practices unique to your project.</li>
<li>Target specific file patterns with tailored review criteria.</li>
<li>Provide more detailed explanations for certain types of changes.</li>
</ul>
<p>To configure custom instructions:</p>
<ol>
<li>In the root of your repository, create a <code>.gitlab/duo</code> directory if it doesn't already exist.</li>
<li>In the <code>.gitlab/duo</code> directory, create a file named <code>mr-review-instructions.yaml</code>.</li>
<li>Add your custom instructions using this format:</li>
</ol>
<p><code>yaml
   instructions:
     - name: &lt;instruction_group_name&gt;
       fileFilters:
         - &lt;glob_pattern_1&gt;
         - &lt;glob_pattern_2&gt;
         - !&lt;exclude_pattern&gt;  # Exclude files matching this pattern
       instructions: |
         &lt;your_custom_review_instructions&gt;</code></p>
<p>For example:</p>
<p>```yaml
   instructions:
     - name: Ruby Style Guide
       fileFilters:
         - "<em>.rb"           # Ruby files in the root directory
         - "lib/</em><em>/</em>.rb"    # Ruby files in lib and its subdirectories
         - "!spec/*<em>/</em>.rb"  # Exclude test files
       instructions: |
         1. Ensure all methods have proper documentation
         2. Follow Ruby style guide conventions
         3. Prefer symbols over strings for hash keys</p>
<pre><code> - name: TypeScript Source Files
   fileFilters:
     - "**/*.ts"        # Typescript files in any directory
     - "!**/*.test.ts"  # Exclude test files
     - "!**/*.spec.ts"  # Exclude spec files
   instructions: |
     1. Ensure proper TypeScript types (avoid 'any')
     2. Follow naming conventions
     3. Document complex functions

 - name: All Files Except Tests
   fileFilters:
     - "!**/*.test.*"   # Exclude all test files
     - "!**/*.spec.*"   # Exclude all spec files
     - "!test/**/*"     # Exclude test directories
     - "!spec/**/*"     # Exclude spec directories
   instructions: |
     1. Follow consistent code style
     2. Add meaningful comments for complex logic
     3. Ensure proper error handling

 - name: Test Coverage
   fileFilters:
     - "spec/**/*_spec.rb" # Ruby test files in spec directory
   instructions: |
     1. Test both happy paths and edge cases
     2. Include error scenarios
     3. Use shared examples to reduce duplication
</code></pre>
<p>```</p>
<ol>
<li>Optional: Add a <a href="../../../project/codeowners/_index.html">Code Owners</a> entry to protect changes to
   the <code>mr-review-instructions.yaml</code> file.</li>
</ol>
<p><code>markdown
   [GitLab Duo]
   .gitlab/duo @default-owner @tech-lead</code></p>
<ol>
<li>
<p><a href="../../../project/merge_requests/creating_merge_requests.html">Create a merge request</a> to review
   and merge the changes:</p>
</li>
<li>
<p>Code Review automatically applies your custom instructions when the file patterns match.</p>
</li>
<li>Multiple instruction groups can apply to a single file.</li>
<li>Optional:</li>
<li>Review the feedback and refine your instructions as needed.</li>
<li>Test the patterns to ensure they match the intended files.</li>
</ol>
<h2>Differences from classic GitLab Duo Code Review</h2>
<p>While the Code Review Flow provides the same core functionality as the classic
<a href="../../../project/merge_requests/duo_in_merge_requests.md#have-gitlab-duo-review-your-code">GitLab Duo Code Review</a>,
the GitLab Duo Agent Platform implementation offers:</p>
<ul>
<li>Improved context awareness: Better understanding of repository structure and cross-file dependencies.</li>
<li>Agentic capabilities: Multi-step reasoning for more thorough analysis.</li>
<li>Modern architecture: Built on the scalable GitLab Duo Agent Platform.</li>
</ul>
<p>All existing features including custom instructions, automatic reviews, and interaction patterns
remain compatible.</p></code></pre>
</body>
</html>
