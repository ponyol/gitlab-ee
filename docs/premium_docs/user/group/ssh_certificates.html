<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># SSH certificates and SSH keys</title>
    <link rel="stylesheet" href="/../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Create
group: Source Code
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Manage Git access to projects by adding CA certificates to your top-level group, instead of individual groups.
title: Manage group SSH certificates</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>You can control and manage Git access to your projects and groups with SSH certificates.</p>
<p>SSH certificates are cryptographically signed documents that authenticate a user's identity and
permissions.
They are issued by a trusted Certificate Authority (CA) and contain information such as
the user's identity, validity period, and permissions.</p>
<p>The benefits of SSH certificate authentication are:</p>
<ul>
<li>Centralized access control: You can manage access through a central CA, instead of individual
  user-managed SSH keys.</li>
<li>Enhanced security: SSH certificates are more secure than traditional SSH keys.</li>
<li>Time-limited access: You can set certificates to expire after a specific period.</li>
<li>Simplified credential management: Organizations can maintain a list of approved
  SSH certificate credentials for repository access.</li>
<li>Independent from user-managed credentials: Access is controlled with group-managed
  certificates, and not users' personal public SSH keys.</li>
</ul>
<h2>SSH certificates and SSH keys</h2>
<p>The following table compares SSH certificates and SSH keys:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SSH certificates</th>
<th>SSH keys</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access control</td>
<td>Centralized through group-managed CA.</td>
<td>Distributed across individual user accounts.</td>
</tr>
<tr>
<td>Expiration</td>
<td>Built-in expiration.</td>
<td>No built-in expiration.</td>
</tr>
<tr>
<td>Credential management</td>
<td>Managed by group Owners.</td>
<td>Managed by individual users.</td>
</tr>
<tr>
<td>Setup complexity</td>
<td>More complex initial setup.</td>
<td>Simpler initial setup.</td>
</tr>
</tbody>
</table>
<h2>Authentication flow</h2>
<p>The following diagram illustrates how SSH certificate authentication works
in GitLab, from requesting a certificate to accessing a repository:</p>
<pre><code class="language-mermaid">%%{init: { &quot;fontFamily&quot;: &quot;GitLab Sans&quot; }}%%
sequenceDiagram
    accTitle: SSH certificate authentication flow
    accDescr: Sequential diagram showing how a user obtains an SSH certificate from a Group Certificate Authority and uses it to access a Git repository through GitLab.

    participant User
    participant GroupCA as Group Certificate Authority
    participant GitLab
    participant GitRepo as Git Repository

    User-&gt;&gt;GroupCA: Request SSH certificate
    GroupCA-&gt;&gt;User: Issue signed SSH certificate
    User-&gt;&gt;GitLab: Attempt to access repository via SSH
    GitLab-&gt;&gt;GitLab: Verify certificate is valid and issued by Group CA
    GitLab-&gt;&gt;GitRepo: Grant access
    GitRepo-&gt;&gt;User: Allow repository operations
</code></pre>
<p>The authentication process verifies that users have valid SSH certificates before
allowing repository access.</p>
<h2>Add a CA certificate to a top-level group</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/421915">Introduced</a> in GitLab 16.4 <a href="../../administration/feature_flags/list.html">with a flag</a> named <code>ssh_certificates_rest_endpoints</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/424501">Enabled on GitLab.com</a> in GitLab 16.9.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/424501">Generally available</a> in GitLab 17.7. Feature flag <code>ssh_certificates_rest_endpoints</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the Owner role for the group.</li>
<li>The group must be a top-level group, not a subgroup.</li>
</ul>
<p>To add a CA certificate to a group:</p>
<ol>
<li>Generate an SSH key pair to be used as a Certified Authority file:</li>
</ol>
<p><code>plaintext
   ssh-keygen -f CA</code></p>
<ol>
<li>Add the public key to the top-level group using <a href="../../api/group_ssh_certificates.md#add-a-group-ssh-certificate">Group SSH certificates API</a>
   to grant access to the projects of the group and its subgroups.</li>
</ol>
<h2>Issue CA certificates for users</h2>
<p>Prerequisites:</p>
<ul>
<li>You must have the Owner role for the group.</li>
<li>The user certificates can only be used to access the projects in the top-level group and its subgroups.</li>
<li>A user's username or primary email (<code>user</code> or <code>user@example.com</code>) must be specified to associate a
  GitLab user with the user certificate.</li>
<li>The user must be an <a href="../enterprise_user/_index.html">Enterprise User</a>.</li>
</ul>
<p>To issue user certificates, use the private key from the pair you <a href="#add-a-ca-certificate-to-a-top-level-group">created earlier</a>:</p>
<pre><code class="language-shell">ssh-keygen -s CA -I user@example.com -V +1d user-key.pub
</code></pre>
<p>The (<code>user-key.pub</code>) key is the public key from an SSH key pair that is used by a user for SSH authentication.
The SSH key pair is either generated by a user or provisioned by the group owner infrastructure along with the SSH certificate.</p>
<p>The expiration date (<code>+1d</code>) identifies how long the SSH certificate can be used to access the group projects.</p>
<p>The user certificates can only be used to access the projects in the top-level group.</p>
<h2>Enforce SSH certificates</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/421915">Introduced</a> in GitLab 16.7 <a href="../../administration/feature_flags/list.html">with a flag</a> named <code>enforce_ssh_certificates_via_settings</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/426235">Enabled on GitLab.com</a> in GitLab 16.9.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/488635">Generally available</a> in GitLab 17.7. Feature flag <code>enforce_ssh_certificates_via_settings</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can enforce the usage of SSH certificates and restrict users from authenticating using SSH
keys and access tokens.</p>
<p>When SSH certificates are enforced:</p>
<ul>
<li>Only individual user accounts are affected.</li>
<li>It does not apply to service accounts, deploy keys, and other types of internal accounts.</li>
<li>Only SSH certificates added to the group by Owners are used to authenticate repository access.</li>
</ul>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Enforcing SSH certificates disables HTTPS access for regular users.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>You must have the Owner role for the group.</li>
</ul>
<p>To enforce using SSH certificates:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>Expand the <strong>Permissions and group features</strong> section.</li>
<li>Select the <strong>Enforce SSH Certificates</strong> checkbox.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol></code></pre>
</body>
</html>
