<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Prerequisites</title>
    <link rel="stylesheet" href="../../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: AI-powered
group: Code Creation
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Code Suggestions helps you write code in GitLab more efficiently by using AI to suggest code as you type.
title: Code Suggestions</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Add-on: GitLab Duo Core, Pro, or Enterprise, GitLab Duo with Amazon Q</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; collapsible title="Model information" &gt;}}</p>
<ul>
<li>LLM for code completion: <a href="https://console.cloud.google.com/vertex-ai/publishers/mistralai/model-garden/codestral-2501">Fireworks Codestral</a> (default), <a href="https://console.cloud.google.com/vertex-ai/publishers/mistralai/model-garden/codestral-2501">Vertex AI-hosted Codestral</a> For code generation: <a href="https://console.cloud.google.com/vertex-ai/publishers/anthropic/model-garden/claude-sonnet-4">Claude Sonnet 4</a></li>
<li>LLM for Amazon Q: Amazon Q Developer</li>
<li>Available on <a href="../../../../administration/gitlab_duo_self_hosted/_index.html">GitLab Duo with self-hosted models</a></li>
</ul>
<p>{{&lt; /collapsible &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/10562">Introduced support for Google Vertex AI Codey APIs</a> in GitLab 16.1.</li>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/10752">Removed support for GitLab native model</a> in GitLab 16.2.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/415583">Introduced support for code generation</a> in GitLab 16.3.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/435271">Generally available</a> in GitLab 16.7.</li>
<li><a href="https://gitlab.com/gitlab-org/fulfillment/meta/-/issues/2031">Changed</a> to require the GitLab Duo Pro add-on on February 15, 2024. Previously, this feature was included with Premium and Ultimate subscriptions.</li>
<li><a href="https://gitlab.com/gitlab-org/fulfillment/meta/-/issues/2031">Changed</a> to require the GitLab Duo Pro or GitLab Duo Enterprise add-on for all supported GitLab versions starting October 17, 2024.</li>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/15850">Introduced support for Fireworks AI-hosted Qwen2.5 code completion model</a> in GitLab 17.6, with a flag named <code>fireworks_qwen_code_completion</code>.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/187397">Removed</a> support for Qwen2.5 code completion model in GitLab 17.11.</li>
<li>Enabled Fireworks hosted <code>Codestral</code> by default via the feature flag <code>use_fireworks_codestral_code_completion</code> in GitLab 17.11.</li>
<li>Changed to include GitLab Duo Core in GitLab 18.0.</li>
<li>Enabled Fireworks hosted <code>Codestral</code> as the default model in GitLab 18.1.</li>
<li>To opt out of Fireworks for a group, the feature flag <code>code_completion_opt_out_fireworks</code> is available.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/545489">Changed</a> the default model for code generation to Claude Sonnet 4 in GitLab 18.2.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/462750">Removed</a> feature flag <code>code_suggestions_context</code> in GitLab 18.6.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Use GitLab Duo Code Suggestions to write code more efficiently by using generative AI to suggest code while you're developing.</p>
<ul>
<li><i class="fa-youtube-play" aria-hidden="true"></i>
  <a href="https://gitlab.navattic.com/code-suggestions">View a click-through demo</a>.
  <!-- Video published on 2023-12-09 --></li>
</ul>
<p>- <i class="fa-youtube-play" aria-hidden="true"></i> <a href="https://youtu.be/ds7SG1wgcVM">Watch an overview</a></p>
<h2>Prerequisites</h2>
<p>To use Code Suggestions:</p>
<ul>
<li>If you have the GitLab Duo Core add-on, <a href="../../../gitlab_duo/turn_on_off.md#turn-gitlab-duo-core-on-or-off">turn on IDE features</a>.</li>
<li><a href="set_up.html">Set up Code Suggestions</a>.</li>
</ul>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>GitLab Duo requires GitLab 17.2 or later. For GitLab Duo Core access, and for the best user experience and results,
<a href="../../../../update/_index.html">upgrade to GitLab 18.0 or later</a>. Earlier versions might continue to work, however the experience might be degraded.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>Use Code Suggestions</h2>
<p>To use Code Suggestions:</p>
<ol>
<li>Open your Git project in a <a href="supported_extensions.md#supported-editor-extensions">supported IDE</a>.</li>
<li>Add the project as a remote of your local repository using
   <a href="../../../../topics/git/commands.md#git-remote-add"><code>git remote add</code></a>.</li>
<li>Add your project directory, including the hidden <code>.git/</code> folder, to your IDE workspace or project.</li>
<li>
<p>Author your code.
   As you type, suggestions are displayed. Code Suggestions provides code snippets
   or completes the current line, depending on the cursor position.</p>
</li>
<li>
<p>Describe the requirements in natural language.
   Code Suggestions generates functions and code snippets based on the context provided.</p>
</li>
<li>
<p>When you receive a suggestion, you can do any of the following:</p>
</li>
<li>To accept a suggestion, press <kbd>Tab</kbd>.</li>
<li>To accept a partial suggestion, press either <kbd>Control</kbd>+<kbd>Right arrow</kbd> or <kbd>Command</kbd>+<kbd>Right arrow</kbd>.</li>
<li>To reject a suggestion, press <kbd>Esc</kbd>. In Neovim, press <kbd>Control</kbd>+<kbd>E</kbd> to exit the menu.</li>
<li>To ignore a suggestion, keep typing as you usually would.</li>
</ol>
<h2>View multiple code suggestions</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab-vscode-extension/-/issues/1325">Introduced</a> in GitLab 17.1.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>For a code completion suggestion in VS Code, multiple suggestion options
might be available. To view all available suggestions:</p>
<ol>
<li>Hover over the code completion suggestion.</li>
<li>Scroll through the alternatives. Either:</li>
<li>Use keyboard shortcuts:<ul>
<li>On a Mac, press <kbd>Option</kbd>+<kbd>[</kbd> to view the previous suggestion,
   and press <kbd>Option</kbd>+<kbd>]</kbd> to view the next suggestion.</li>
<li>On Linux and Windows, press <kbd>Alt</kbd>+<kbd>[</kbd> to view the previous suggestion,
   and press <kbd>Alt</kbd>+<kbd>]</kbd> to view the next suggestion.</li>
</ul>
</li>
<li>On the dialog that's displayed, select the right or left arrow to see next or previous options.</li>
<li>Press <kbd>Tab</kbd> to apply the suggestion you prefer.</li>
</ol>
<h2>Code completion and generation</h2>
<p>Code Suggestions uses code completion and code generation:</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Code completion</th>
<th style="text-align: left;">Code generation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Purpose</td>
<td style="text-align: left;">Provides suggestions for completing the current line of code.</td>
<td style="text-align: left;">Generates new code based on a natural language comment.</td>
</tr>
<tr>
<td style="text-align: left;">Trigger</td>
<td style="text-align: left;">Triggers when typing, usually with a short delay.</td>
<td style="text-align: left;">Triggers when pressing <kbd>Enter</kbd> after writing a comment that includes specific keywords.</td>
</tr>
<tr>
<td style="text-align: left;">Scope</td>
<td style="text-align: left;">Limited to the current line or small block of code.</td>
<td style="text-align: left;">Can generate entire methods, functions, or even classes based on the context.</td>
</tr>
<tr>
<td style="text-align: left;">Accuracy</td>
<td style="text-align: left;">More accurate for small tasks and short blocks of code.</td>
<td style="text-align: left;">Is more accurate for complex tasks and large blocks of code because a bigger large language model (LLM) is used, additional context is sent in the request (for example, the libraries used by the project), and your instructions are passed to the LLM.</td>
</tr>
<tr>
<td style="text-align: left;">How to use</td>
<td style="text-align: left;">Code completion automatically suggests completions to the line you are typing.</td>
<td style="text-align: left;">You write a comment and press <kbd>Enter</kbd>, or you enter an empty function or method.</td>
</tr>
<tr>
<td style="text-align: left;">When to use</td>
<td style="text-align: left;">Use code completion to quickly complete one or a few lines of code.</td>
<td style="text-align: left;">Use code generation for more complex tasks, larger codebases, when you want to write new code from scratch based on a natural language description, or when the file you're editing has fewer than five lines of code.</td>
</tr>
</tbody>
</table>
<p>Code Suggestions always uses both of these features. You cannot use only code
generation or only code completion.</p>
<p><i class="fa-youtube-play" aria-hidden="true"></i>
<a href="https://www.youtube.com/watch?v=9dsyqMt9yg4">View a code completion vs. code generation comparison demo</a>.</p>
<!-- Video published on 2024-09-26 -->

<h3>Best practices for code generation</h3>
<p>To get the best results from code generation:</p>
<ul>
<li>Be as specific as possible while remaining concise.</li>
<li>State the outcome you want to generate (for example, a function)
  and provide details on what you want to achieve.</li>
<li>Add additional information, like the framework or library you want to use.</li>
<li>Add a space or new line after each comment.
  This space tells the code generator that you have completed your instructions.</li>
<li>Review and adjust the <a href="../../../gitlab_duo/context.md#code-suggestions">context available to Code Suggestions</a>.</li>
</ul>
<p>For example, to create a Python web service with some specific requirements,
you might write something like:</p>
<pre><code class="language-plaintext"># Create a web service using Tornado that allows a user to sign in, run a security scan, and review the scan results.
# Each action (sign in, run a scan, and review results) should be its own resource in the web service
...
</code></pre>
<p>AI is non-deterministic, so you may not get the same suggestion every time with the same input.
To generate quality code, write clear, descriptive, specific tasks.</p>
<p>For use cases and best practices, follow the <a href="../../../gitlab_duo/use_cases.html">GitLab Duo examples documentation</a>.</p>
<h2>Truncation of file content</h2>
<p>Because of LLM limits and performance reasons, the content of the currently
opened file is truncated:</p>
<ul>
<li>For code completion: to 32,000 tokens (roughly 128,000 characters).</li>
<li>For code generation: to 200,000 tokens (roughly 800,000 characters).</li>
</ul>
<p>Content above the cursor is prioritized over content below the cursor. The content
above the cursor is truncated from the left side, and content below the cursor
is truncated from the right side. These numbers represent the maximum input context
size for Code Suggestions.</p>
<h2>Output length</h2>
<p>Because of LLM limits and for performance reasons, the output of Code Suggestions
is limited:</p>
<ul>
<li>For code completion: to 64 tokens (roughly 256 characters).</li>
<li>For code generation: to 2048 tokens (roughly 7168 characters).</li>
</ul>
<h2>Accuracy of results</h2>
<p>We are continuing to work on the accuracy of overall generated content.
However, Code Suggestions might generate suggestions that are:</p>
<ul>
<li>Irrelevant.</li>
<li>Incomplete.</li>
<li>Likely to result in failed pipelines.</li>
<li>Potentially insecure.</li>
<li>Offensive or insensitive.</li>
</ul>
<p>When using Code Suggestions, code review best practices still apply.</p>
<h2>Available language models</h2>
<p>Different language models can be the source for Code Suggestions.</p>
<ul>
<li>On GitLab.com: GitLab hosts the models and connects to them through the cloud-based AI gateway.</li>
<li>On GitLab Self-Managed, two options exist:</li>
<li>GitLab can <a href="set_up.html">host the models and connects to them through the cloud-based AI gateway</a>.</li>
<li>Your organization can <a href="../../../../administration/gitlab_duo_self_hosted/_index.html">use GitLab Duo Self-Hosted</a>,
    which means you host the AI gateway and language models. You can use GitLab AI vendor models,
    other supported language models, or to bring your own compatible model.</li>
</ul>
<h2>How the prompt is built</h2>
<p>To learn about the code that builds the prompt, see these files:</p>
<ul>
<li>Code generation:
  <a href="https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/lib/api/code_suggestions.rb#L76"><code>ee/lib/api/code_suggestions.rb</code></a>
  in the <code>gitlab</code> repository.</li>
<li>Code completion:
  <a href="https://gitlab.com/gitlab-org/modelops/applied-ml/code-suggestions/ai-assist/-/blob/fcb3f485a8f047a86a8166aad81f93b6d82106a7/ai_gateway/code_suggestions/processing/completions.py#L273"><code>ai_gateway/code_suggestions/processing/completions.py</code></a>
  in the <code>modelops</code> repository.</li>
</ul>
<h2>Prompt caching</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/535651">Introduced</a> in GitLab 18.0.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prompt caching is enabled by default to improve Code Suggestions latency. When prompt caching is enabled, code completion prompt data is temporarily stored in memory by the model vendor. Prompt caching significantly improves latency by avoiding the re-processing of cached prompt and input data. The cached data is never logged to any persistent storage.</p>
<h3>Turn off prompt caching</h3>
<p>You can turn off prompt caching for top-level groups in the GitLab Duo settings.
This also turns off prompt caching for <a href="../../../gitlab_duo_chat/agentic_chat.md#prompt-caching">GitLab Duo Chat (Agentic)</a>.</p>
<p>On GitLab.com:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your group.</li>
<li>Select <strong>Settings</strong> &gt; <strong>GitLab Duo</strong>.</li>
<li>Select <strong>Change configuration</strong>.</li>
<li>Disable the <strong>Prompt caching</strong> toggle.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>On GitLab Self-Managed:</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>On the left sidebar, select <strong>GitLab Duo</strong>.</li>
<li>Select <strong>Change configuration</strong>.</li>
<li>Under <strong>Prompt cache</strong>, clear the <strong>Turn on prompt caching</strong> checkbox.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<h2>Response time</h2>
<p>Code Suggestions is powered by a generative AI model.</p>
<ul>
<li>For code completion, suggestions are usually low latency and take less than one second.</li>
<li>For code generation, algorithms or large code blocks might take more than five seconds to generate.</li>
</ul>
<p>Your personal access token enables a secure API connection to GitLab.com or to your GitLab instance.
This API connection securely transmits a context window from your IDE/editor to the <a href="https://gitlab.com/gitlab-org/modelops/applied-ml/code-suggestions/ai-assist">GitLab AI gateway</a>, a GitLab hosted service. The gateway calls the large language model APIs, and then the generated suggestion is transmitted back to your IDE/editor.</p>
<h3>Streaming</h3>
<p>Streaming of code generation responses is supported in JetBrains and Visual Studio, leading to
perceived faster response times.
Other supported IDEs will return the generated code in a single block.</p>
<p>Streaming is not enabled for code completion.</p>
<h3>Direct and indirect connections</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/462791">Introduced</a> in GitLab 17.2 <a href="../../../../administration/feature_flags/_index.html">with a flag</a> named <code>code_suggestions_direct_access</code>. Disabled by default.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>By default, code completion requests are sent from the IDE directly to the AI gateway to minimize the latency.
For this direct connection to work, the IDE must be able to connect to <code>https://cloud.gitlab.com:443</code>. If this is not
possible (for example, because of network restrictions), you can disable direct connections for all users. If you do this,
code completion requests are sent indirectly through the GitLab Self-Managed instance, which in turn sends the requests
to the AI gateway. This might result in your requests having higher latency.</p>
<h4>Configure direct or indirect connections</h4>
<p>Prerequisites:</p>
<ul>
<li>You must be an administrator for the GitLab Self-Managed instance.</li>
</ul>
<p>{{&lt; tabs &gt;}}</p>
<p>{{&lt; tab title="In 17.4 and later" &gt;}}</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>Expand <strong>GitLab Duo features</strong>.</li>
<li>Under <strong>Connection method</strong>, choose an option:</li>
<li>To minimize latency for code completion requests, select <strong>Direct connections</strong>.</li>
<li>To disable direct connections for all users, select <strong>Indirect connections through GitLab Self-Managed</strong>.</li>
<li>Select <strong>Save changes</strong>.</li>
</ol>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; tab title="In 17.3 and earlier" &gt;}}</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>Expand <strong>AI-native features</strong>.</li>
<li>Choose an option:</li>
<li>To enable direct connections and minimize latency for code completion requests, clear the <strong>Disable direct connections for code suggestions</strong> checkbox.</li>
<li>To disable direct connections, select the <strong>Disable direct connections for code suggestions</strong> checkbox.</li>
</ol>
<p>{{&lt; /tab &gt;}}</p>
<p>{{&lt; /tabs &gt;}}</p>
<h2>Feedback</h2>
<p>Provide feedback about your Code Suggestions experience in <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/435783">issue 435783</a>.</p>
<!-- Demo published on 2024-02-01 --></code></pre>
</body>
</html>
