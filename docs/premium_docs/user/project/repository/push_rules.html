<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Enable global push rules</title>
    <link rel="stylesheet" href="/../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Create
group: Source Code
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Use push rules to control the content and format of Git commits your repository accepts. Set standards for commit messages, and block secrets or credentials from being added accidentally.
title: Push rules</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Maximum regular expression length for push rules <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/411901">changed</a> from 255 to 511 characters in GitLab 16.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Push rules are <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#:~:text=pre%2Dreceive,with%20the%20push."><code>pre-receive</code> Git hooks</a> you
can enable in a user-friendly interface. Push rules give you more control over what
can and can't be pushed to your repository. While GitLab offers
<a href="branches/protected.html">protected branches</a>, you may need more specific rules, such as:</p>
<ul>
<li>Evaluating the contents of a commit.</li>
<li>Confirming commit messages match expected formats.</li>
<li>Enforcing <a href="branches/_index.md#name-your-branch">branch name rules</a>.</li>
<li>Evaluating the details of files.</li>
<li>Preventing Git tag removal.</li>
<li>Requiring signed commits.</li>
</ul>
<p>GitLab uses <a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a> for regular expressions
in push rules. You can test them at the <a href="https://regex101.com/">regex101 regex tester</a>.
Each regular expression is limited to 511 characters.</p>
<p>For custom push rules use <a href="../../../administration/server_hooks.html">server hooks</a>.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Push rules are bypassed during fork synchronization.
When you <a href="forking_workflow.md#update-your-fork">update your fork</a> from its upstream project, changes
are applied directly without validation against the fork's push rules.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Push rules work as templates, not inherited settings:</p>
<ul>
<li>Global push rules serve as a template for new projects. When you create global push rules,
  they are copied to all projects created after that point.</li>
<li>Project push rules are independent copies. After a project is created, its push rules do not
  automatically update when you change global or group rules.</li>
<li>Deleting project push rules removes all push rule controls from the project.
  The project does not revert to using global or group rules.</li>
</ul>
<p>To apply updated global push rules to existing projects, you must <a href="#override-global-push-rules-per-project">override the global push rules</a>
for each project individually.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>If you delete push rules from a project, the project has no push rules at all.
The project does not automatically inherit rules from the group or instance.
To restore push rules, you must configure them again for the project.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>Enable global push rules</h2>
<p>You can create push rules that serve as a template for all new projects.
You can override these rules in individual projects or <a href="../../group/access_and_permissions.md#group-push-rules">groups</a>.</p>
<p>When you configure global push rules:</p>
<ul>
<li>All projects created after you configure global push rules inherit a copy of this configuration.</li>
<li>Existing projects are not affected. To update these projects manually, see
  <a href="#override-global-push-rules-per-project">override global push rules per project</a>.</li>
<li>Changes to global push rules do not update projects that already have push rules configured.</li>
</ul>
<p>Prerequisites:</p>
<ul>
<li>You must be an administrator.</li>
</ul>
<p>To create global push rules:</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Push rules</strong>.</li>
<li>Expand <strong>Push rules</strong>.</li>
<li>Set the rule you want.</li>
<li>Select <strong>Save push rules</strong>.</li>
</ol>
<h2>Override global push rules per project</h2>
<p>Project push rules are independent of global push rules.
When you set push rules for a project, those rules replace any previously configured rules for that project.</p>
<p>To set push rules for a project:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Push rules</strong>.</li>
<li>Set the rule you want.</li>
<li>Select <strong>Save push rules</strong>.</li>
</ol>
<p>For a project to match new global push rules, you must configure the project's push rules to match
the global settings. Projects do not automatically inherit changes to global push rules.</p>
<h2>Verify users</h2>
<p>Use these rules to validate users who make commits.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>These push rules apply only to commits and not <a href="tags/_index.html">tags</a>.</p>
<p>{{&lt; /alert &gt;}}</p>
<ul>
<li><strong>Reject unverified users</strong>: The committer email must match one of the user's <a href="../../profile/_index.md#add-emails-to-your-user-profile">verified email addresses</a> or <a href="../../profile/_index.md#use-an-automatically-generated-private-commit-email">private commit email address</a>.</li>
<li><strong>Reject inconsistent user name</strong>: The commit author name must match the user's GitLab account name.</li>
<li><strong>Check whether the commit author is a GitLab user</strong>: Both the commit author and committer email addresses must match a GitLab user's <a href="../../profile/_index.md#add-emails-to-your-user-profile">verified email addresses</a>.</li>
<li><strong>Commit author's email</strong>: Both the author and committer email addresses must match the regular expression.
  To allow any email address, leave empty.</li>
</ul>
<p>When using <a href="../../project/settings/project_access_tokens.md#bot-users-for-projects">bot users for projects</a>
or <a href="../../group/settings/group_access_tokens.md#bot-users-for-groups">bot users for groups</a>,
you must add the generated email suffix so that bot tokens can commit and push changes.</p>
<h2>Validate commit messages</h2>
<p>Use these rules for your commit messages:</p>
<ul>
<li>
<p><strong>Require expression in commit messages</strong>: Messages must match the
  expression. To allow any commit message, leave empty.
  Uses multiline mode, which can be disabled by using <code>(?-m)</code>. Some validation examples:</p>
</li>
<li>
<p><code>JIRA\-\d+</code> requires every commit to reference a Jira issue, like <code>Refactored css. Fixes JIRA-123</code>.</p>
</li>
<li><code>[[:^punct:]]\b$</code> rejects a commit if the final character is a punctuation mark.
    The word boundary character (<code>\b</code>) prevents false negatives, because Git adds a
    newline character (<code>\n</code>) to the end of the commit message.</li>
</ul>
<p>Commit messages created in GitLab UI set <code>\r\n</code> as a newline character.
  Use <code>(\r\n?|\n)</code> instead of <code>\n</code> in your regular expression to correctly match
  it.</p>
<p>For example, given the following multi-line commit description:</p>
<p><code>plaintext
  JIRA:
  Description</code></p>
<p>You can validate it with this regular expression: <code>JIRA:(\r\n?|\n)\w+</code>.</p>
<ul>
<li><strong>Reject expression in commit messages</strong>: Commit messages must not match
  the expression. To allow any commit message, leave empty.
  Uses multiline mode, which can be disabled by using <code>(?-m)</code>.</li>
</ul>
<h2>Validate branch names</h2>
<p>To validate your branch names, enter a regular expression for <strong>Branch name</strong>.
To allow any branch name, leave empty. Your <a href="branches/default.html">default branch</a>
is always allowed. Certain formats of branch names are restricted by default for
security purposes. Names with 40 hexadecimal characters, similar to Git commit hashes,
are prohibited.</p>
<p>Some validation examples:</p>
<ul>
<li>Branches must start with <code>JIRA-</code>.</li>
</ul>
<p><code>plaintext
  ^JIRA-</code></p>
<ul>
<li>Branches must end with <code>-JIRA</code>.</li>
</ul>
<p><code>plaintext
  -JIRA$</code></p>
<ul>
<li>Branches must be between <code>4</code> and <code>15</code> characters long,
  accepting only lowercase letters, numbers and dashes.</li>
</ul>
<p><code>plaintext
  ^[a-z0-9\\-]{4,15}$</code></p>
<h2>Prevent unintended consequences</h2>
<p>Use these rules to prevent unintended consequences.</p>
<ul>
<li><strong>Reject unsigned commits</strong>: Commit <a href="signed_commits/_index.html">must be signed</a>. This rule
  can block some legitimate commits <a href="#reject-unsigned-commits-and-the-web-ide">created in the Web IDE</a>,
  and allow <a href="#require-signed-commits">unsigned commits created by GitLab to appear in commit history</a>.</li>
<li><strong>Do not allow users to remove Git tags with <code>git push</code></strong>: Users cannot use <code>git push</code> to remove Git tags.</li>
</ul>
<h2>Validate files</h2>
<p>Use these rules to validate files contained in the commit.</p>
<ul>
<li><strong>Prevent pushing secret files</strong>: Files must not contain <a href="#prevent-pushing-secrets-to-the-repository">secrets</a>.</li>
<li><strong>Prohibited filenames</strong>: Files that do not exist in the repository
  must not match the regular expression. To allow all filenames, leave empty. See <a href="#prohibit-files-by-name">common examples</a>.</li>
<li><strong>Maximum file size</strong>: Added or updated files must not exceed this
  file size (in MB). To allow files of any size, set to <code>0</code>. Files tracked by Git LFS are exempted.</li>
</ul>
<h3>Prevent pushing secrets to the repository</h3>
<p>Never commit secrets, such as credential files and SSH private keys, to a version control
system. In GitLab, you can use a predefined list of files to block those files from a
repository. Merge requests that contain a file that matches the list are blocked.
This push rule does not restrict files already committed to the repository.
You must update the configuration of existing projects to use the rule, using the
process described in <a href="#override-global-push-rules-per-project">Override global push rules per project</a>.</p>
<p>Files blocked by this rule are listed below. For a complete list of criteria, refer to
<a href="https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/lib/gitlab/checks/files_denylist.yml"><code>files_denylist.yml</code></a>.</p>
<ul>
<li>
<p>AWS CLI credential blobs:</p>
</li>
<li>
<p><code>.aws/credentials</code></p>
</li>
<li><code>aws/credentials</code></li>
<li>
<p><code>homefolder/aws/credentials</code></p>
</li>
<li>
<p>Private RSA SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_rsa</code></p>
</li>
<li><code>/.ssh/personal_rsa</code></li>
<li><code>/config/server_rsa</code></li>
<li><code>id_rsa</code></li>
<li>
<p><code>.id_rsa</code></p>
</li>
<li>
<p>Private DSA SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_dsa</code></p>
</li>
<li><code>/.ssh/personal_dsa</code></li>
<li><code>/config/server_dsa</code></li>
<li><code>id_dsa</code></li>
<li>
<p><code>.id_dsa</code></p>
</li>
<li>
<p>Private ED25519 SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_ed25519</code></p>
</li>
<li><code>/.ssh/personal_ed25519</code></li>
<li><code>/config/server_ed25519</code></li>
<li><code>id_ed25519</code></li>
<li>
<p><code>.id_ed25519</code></p>
</li>
<li>
<p>Private ECDSA SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_ecdsa</code></p>
</li>
<li><code>/.ssh/personal_ecdsa</code></li>
<li><code>/config/server_ecdsa</code></li>
<li><code>id_ecdsa</code></li>
<li>
<p><code>.id_ecdsa</code></p>
</li>
<li>
<p>Private ECDSA_SK SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_ecdsa_sk</code></p>
</li>
<li><code>/.ssh/personal_ecdsa_sk</code></li>
<li><code>/config/server_ecdsa_sk</code></li>
<li><code>id_ecdsa_sk</code></li>
<li>
<p><code>.id_ecdsa_sk</code></p>
</li>
<li>
<p>Private ED25519_SK SSH keys:</p>
</li>
<li>
<p><code>/ssh/id_ed25519_sk</code></p>
</li>
<li><code>/.ssh/personal_ed25519_sk</code></li>
<li><code>/config/server_ed25519_sk</code></li>
<li><code>id_ed25519_sk</code></li>
<li>
<p><code>.id_ed25519_sk</code></p>
</li>
<li>
<p>Any files ending with these suffixes:</p>
</li>
<li>
<p><code>*.pem</code></p>
</li>
<li><code>*.key</code></li>
<li><code>*.history</code></li>
<li><code>*_history</code></li>
</ul>
<h3>Prohibit files by name</h3>
<p>In Git, filenames include both the file's name, and all directories preceding the name.
When you <code>git push</code>, each filename in the push is compared to the regular expression
in <strong>Prohibited filenames</strong>.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>This feature uses <a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>,
which does not support positive or negative lookaheads.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>The regular expression can:</p>
<ul>
<li>Match file names in any location in your repository.</li>
<li>Match file names in specific locations.</li>
<li>Match partial file names.</li>
<li>Exclude specific file types by extension.</li>
<li>Combine multiple expressions to exclude several patterns.</li>
</ul>
<h3>Regular expression examples</h3>
<p>These examples use common regex string boundary patterns:</p>
<ul>
<li><code>^</code>: Matches the beginning of a string.</li>
<li><code>$</code>: Matches the end of a string.</li>
<li><code>\.</code>: Matches a literal period character. The backslash escapes the period.</li>
<li><code>\/</code>: Matches a literal forward slash. The backslash escapes the forward slash.</li>
</ul>
<h4>Prevent specific file types</h4>
<ul>
<li>To prevent pushing <code>.exe</code> files to any location in the repository:</li>
</ul>
<p><code>plaintext
  \.exe$</code></p>
<h4>Prevent specific files</h4>
<ul>
<li>
<p>To prevent pushing a specific configuration file:</p>
</li>
<li>
<p>In the repository root:</p>
<p><code>plaintext
^config\.yml$</code></p>
</li>
<li>
<p>In a specific directory:</p>
<p><code>plaintext
^directory-name\/config\.yml$</code></p>
</li>
<li>
<p>In any location - This example prevents pushing any file named <code>install.exe</code>:</p>
</li>
</ul>
<p><code>plaintext
  (^|\/)install\.exe$</code></p>
<h4>Combine patterns</h4>
<p>You can combine multiple patterns into one expression. This example combines all the previous expressions:</p>
<pre><code class="language-plaintext">(\.exe|^config\.yml|^directory-name\/config\.yml|(^|\/)install\.exe)$
</code></pre>
<h2>Require signed commits</h2>
<p><a href="signed_commits/_index.html">Signed commits</a> are digital signatures used to verify the authenticity
and integrity of Git commits. Use the <strong>Reject unsigned commits</strong> push rule to enforce signed commits
for external contributors while allowing GitLab-created commits to remain unsigned.</p>
<p>When you enable the <strong>Reject unsigned commits</strong> push rule:</p>
<ul>
<li>Commits pushed from outside GitLab (with <code>git push</code>) must contain a valid cryptographic signature.
  Unsigned commits are rejected.</li>
<li>Commits created through the GitLab UI or API are allowed even without signatures.
  These commits can come from the Web IDE, merge request actions, and API operations.</li>
</ul>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Because commits created in GitLab are exempt from this rule, unsigned commits can still appear
in your commit history even when the rule is enabled. The rule only validates commits pushed
from external Git clients.</p>
<p>For more information, see <a href="https://gitlab.com/gitlab-org/gitaly/-/issues/5361">issue 5361</a>.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>The signature must be created with a supported signing method:</p>
<ul>
<li>GPG</li>
<li>SSH</li>
<li>X.509</li>
</ul>
<p>Commits with invalid or corrupt signatures are rejected.</p>
<h3>Enable the rule</h3>
<p>To enable the <strong>Reject unsigned commits</strong> push rule:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Push rules</strong>.</li>
<li>Select <strong>Reject unsigned commits</strong>.</li>
<li>Select <strong>Save push rules</strong>.</li>
</ol>
<h3>Reject unsigned commits and the Web IDE</h3>
<p>If a project has the <strong>Reject unsigned commits</strong> push rule, users cannot create commits through
the GitLab Web IDE by default.</p>
<p>To allow committing through the Web IDE in a project with this push rule, a GitLab administrator
must disable the feature flag <code>reject_unsigned_commits_by_gitlab</code>:</p>
<pre><code class="language-ruby">Feature.disable(:reject_unsigned_commits_by_gitlab)
</code></pre>
<p>When this feature flag is disabled, commits created in the Web IDE are allowed without signatures.
For more information, see <a href="../../../administration/feature_flags/_index.md#enable-or-disable-the-feature">enable or disable the feature</a>.</p>
<h2>Reject commits that aren't DCO certified</h2>
<p>Commits signed with the <a href="https://developercertificate.org/">Developer Certificate of Origin</a> (DCO)
certify the contributor wrote, or has the right to submit, the code contributed in that commit.
You can require all commits to your project to comply with the DCO. This push rule requires a
<code>Signed-off-by:</code> trailer in every commit message, and rejects any commits that lack it.</p>
<h2>Related topics</h2>
<ul>
<li><a href="protect.html">Protect your repository</a></li>
<li><a href="../../../administration/server_hooks.html">Git server hooks</a> (previously called server hooks), to create complex custom push rules</li>
<li><a href="signed_commits/_index.html">Signed commits</a></li>
<li><a href="branches/protected.html">Protected branches</a></li>
<li><a href="../../application_security/secret_detection/_index.html">Secret detection</a></li>
</ul>
<h2>Troubleshooting</h2>
<h3>Bulk update push rules for all projects</h3>
<p>To update the push rules to be the same for all projects,
use the <a href="../../../administration/operations/rails_console.md#starting-a-rails-console-session">Rails console</a>,
or write a script to update each project using the <a href="../../../api/project_push_rules.html">push rules API endpoint</a>.</p>
<p>For example, to enable <strong>Check whether the commit author is a GitLab user</strong> and <strong>Do not allow users to remove Git tags with <code>git push</code></strong> checkboxes,
and create a filter for allowing commits from a specific email domain only through rails console:</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Commands that change data can cause damage if not run correctly or under the right conditions. Always run commands in a test environment first and have a backup instance ready to restore.</p>
<p>{{&lt; /alert &gt;}}</p>
<pre><code class="language-ruby">Project.find_each do |p|
  pr = p.push_rule || PushRule.new(project: p)
  # Check whether the commit author is a GitLab user
  pr.member_check = true
  # Do not allow users to remove Git tags with `git push`
  pr.deny_delete_tag = true
  # Commit author's email
  pr.author_email_regex = '@domain\.com$'
  pr.save!
end
</code></pre></code></pre>
</body>
</html>
