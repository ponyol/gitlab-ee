<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Create a repository mirror</title>
    <link rel="stylesheet" href="../../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Create
group: Source Code
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Use repository mirroring to push or pull the contents of a Git repository into another repository.
title: Repository mirroring</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Free, Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>You can mirror a repository to and from external sources. You can select which repository
serves as the source. Branches, tags, and commits are synced automatically.</p>
<p>Several mirroring methods exist:</p>
<ul>
<li><a href="push.html">Push</a>: Mirror a repository from GitLab to another location.</li>
<li><a href="pull.html">Pull</a>: Mirror a repository from another location. Available in the Premium and Ultimate tier.</li>
<li><a href="bidirectional.html">Bidirectional</a> mirroring is also available, but can cause conflicts.</li>
</ul>
<p>Mirror a repository when:</p>
<ul>
<li>The canonical version of your project has migrated to GitLab. To keep providing a
  copy of your project at its previous home, configure your GitLab repository as a
  <a href="push.html">push mirror</a>. Changes you make to your GitLab repository are copied to
  the old location.</li>
<li>Your GitLab instance is private, but you want to open-source some projects.</li>
<li>You migrated to GitLab, but the canonical version of your project is somewhere else.
  Configure your GitLab repository as a <a href="pull.html">pull mirror</a> of the other project.
  Your GitLab repository pulls copies of the commits, tags, and branches of project.
  They become available to use on GitLab.</li>
</ul>
<p>The following is not supported:</p>
<ul>
<li>SCP-style URLs. The work to implement SCP-style URLs is ongoing.
  For more information and to track its progress, see
  <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/18993">issue 18993</a>.</li>
<li>Mirroring repositories over <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols#_dumb_http">dumb HTTP protocol</a>.</li>
</ul>
<h2>Create a repository mirror</h2>
<p>Prerequisites:</p>
<ul>
<li>You must have at least the Maintainer role for the project.</li>
<li>
<p>If your mirror connects with <code>ssh://</code>, the host key must be detectable on the server,
  or you must have a local copy of the key.</p>
</li>
<li>
<p>On the top bar, select <strong>Search or go to</strong> and find your project.</p>
</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Mirroring repositories</strong>.</li>
<li>Select <strong>Add new</strong>.</li>
<li>Enter a <strong>Git repository URL</strong>. The repository must be accessible over <code>http://</code>, <code>https://</code>, <code>ssh://</code>, or <code>git://</code>.</li>
<li>Select a <strong>Mirror direction</strong>. For more information, see <a href="pull.html">Pull mirroring</a> and <a href="push.html">Push mirroring</a>.</li>
<li>If you entered an <code>ssh://</code> URL, select either:</li>
<li><strong>Detect host keys</strong>: GitLab fetches the host keys from the server and displays the fingerprints.</li>
<li><strong>Input host keys manually</strong>, and enter the host key into <strong>SSH host key</strong>.</li>
</ul>
<p>When mirroring the repository, GitLab confirms that at least one of the stored host keys
   matches before connecting. This check protects your mirror from malicious code injections,
   or your password from being stolen.</p>
<ul>
<li>
<p>To create a repository mirror with SSH authentication, see the <a href="#example-create-mirror-with-ssh-authentication">following example</a>.</p>
</li>
<li>
<p>Select an <strong>Authentication method</strong>. For more information, see
   <a href="#authentication-methods-for-mirrors">Authentication methods for mirrors</a>.</p>
</li>
<li>If you authenticate with SSH host keys, <a href="#verify-a-host-key">verify the host key</a>
   to ensure it is correct.</li>
<li>To prevent force-pushing over diverged refs, select <strong>Keep divergent refs</strong>. For more information, see <a href="push.md#keep-divergent-refs">Keep divergent refs</a>.</li>
<li>Optional. To limit the number of branches mirrored, select
   <strong>Mirror only protected branches</strong> or enter a regex in <strong>Mirror specific branches</strong>.</li>
<li>Select <strong>Mirror repository</strong>.</li>
</ul>
<h3>Example: Create mirror with SSH authentication</h3>
<p>If you select <code>SSH public key</code> as your authentication method, GitLab generates a
public key for your GitLab repository. You must provide this key to the non-GitLab server.
For more information, see <a href="#get-your-ssh-public-key">Get your SSH public key</a>.</p>
<p>To mirror a repository with SSH authentication:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Mirroring repositories</strong>.</li>
<li>Select <strong>Add new</strong>.</li>
<li>Enter a <strong>Git repository URL</strong>. Provide a URL in the format <code>ssh://gitlab.com/gitlab-org/gitlab.git</code>.</li>
</ol>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>SSH URLs must use the format <code>ssh://host/path/to/repo.git</code> instead of
   SCP-style URLs (<code>git@host:path/to/repo.git</code>). Replace the colon (<code>:</code>)
   with a slash (<code>/</code>) and add the <code>ssh://</code> prefix.</p>
<p>{{&lt; /alert &gt;}}</p>
<ol>
<li>Select a <strong>Mirror direction</strong>. For more information, see <a href="pull.html">Pull mirroring</a> and <a href="push.html">Push mirroring</a>.</li>
<li>Select either <strong>Detect host keys</strong> or <strong>Input host keys manually</strong>.</li>
<li>In the <strong>Authentication method</strong> field, select <strong>SSH public key</strong></li>
<li>In the <strong>Username</strong> field, add <code>git</code>.</li>
<li>Optional. Configure the <strong>Mirror user</strong> and <strong>Mirror branches</strong> settings.</li>
<li>Select <strong>Mirror repository</strong>.</li>
<li>Copy the SSH public key and provide it to your non-GitLab server.</li>
</ol>
<h3>Mirror only protected branches</h3>
<p>You can choose to mirror only the
<a href="../branches/protected.html">protected branches</a> in the mirroring project,
either from or to your remote repository. For <a href="pull.html">pull mirroring</a>,
non-protected branches in the mirroring project are not mirrored and can diverge.</p>
<p>To use this option, select <strong>Only mirror protected branches</strong> when you create a repository mirror.</p>
<h3>Mirror specific branches</h3>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/381667">Enabled by default</a> in GitLab 16.0.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/410354">Generally available</a> in GitLab 16.2. Feature flag <code>mirror_only_branches_match_regex</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>To mirror only branches with names matching an <a href="https://github.com/google/re2/wiki/Syntax">re2 regular expression</a>,
enter a regular expression into the <strong>Mirror specific branches</strong> field. Branches with names that
do not match the regular expression are not mirrored.</p>
<h2>Update a mirror</h2>
<p>When the mirror repository is updated, all new branches, tags, and commits are visible in the
project's activity feed. A repository mirror at GitLab updates automatically.
You can also manually trigger an update:</p>
<ul>
<li>At most once every five minutes on GitLab.com.</li>
<li>According to <a href="../../../../administration/instance_limits.md#pull-mirroring-interval">the pull mirroring interval limit</a>
  set by the administrator on GitLab Self-Managed instances.</li>
</ul>
<p>{{&lt; alert type="note" &gt;}}</p>
<p><a href="../../../../administration/silent_mode/_index.html">GitLab Silent Mode</a> disables both push and pull updates.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Force an update</h3>
<p>While mirrors are scheduled to update automatically, you can force an immediate update unless:</p>
<ul>
<li>The mirror is already being updated.</li>
<li>The <a href="../../../../administration/instance_limits.md#pull-mirroring-interval">interval, in seconds</a>
  for pull mirroring limits has not elapsed after its last update.</li>
</ul>
<p>Prerequisites:</p>
<ul>
<li>
<p>You must have at least the Maintainer role for the project.</p>
</li>
<li>
<p>On the top bar, select <strong>Search or go to</strong> and find your project.</p>
</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Mirroring repositories</strong>.</li>
<li>Scroll to <strong>Mirrored repositories</strong> and identify the mirror to update.</li>
<li>Select <strong>Update now</strong> ({{&lt; icon name="retry" &gt;}}).</li>
</ul>
<h2>Authentication methods for mirrors</h2>
<p>When you create a mirror, you must configure the authentication method for it.
GitLab supports these authentication methods:</p>
<ul>
<li><a href="#ssh-authentication">SSH authentication</a>.</li>
<li>Username and password.</li>
</ul>
<p>For a <a href="../../settings/project_access_tokens.html">project access token</a> or
<a href="../../../group/settings/group_access_tokens.html">group access token</a>,
use a non-blank value as a username and the token as the password.</p>
<h3>SSH authentication</h3>
<p>SSH authentication is mutual:</p>
<ul>
<li>You must prove to the server that you're allowed to access the repository.</li>
<li>The server must also prove to you that it's who it claims to be.</li>
</ul>
<p>For SSH authentication, you provide your credentials as a password or public key.
The server that the other repository resides on provides its credentials as a host key.
You must <a href="#verify-a-host-key">verify the fingerprint</a> of this host key manually.</p>
<p>If you're mirroring over SSH (using an <code>ssh://</code> URL), you can authenticate using:</p>
<ul>
<li>Password-based authentication, just as over HTTPS.</li>
<li>Public key authentication. This method is often more secure than password authentication,
  especially when the other repository supports <a href="../../deploy_keys/_index.html">deploy keys</a>.</li>
</ul>
<h3>Get your SSH public key</h3>
<p>When you mirror a repository and select the <strong>SSH public key</strong> as your
authentication method, GitLab generates a public key for you. The non-GitLab server
needs this key to establish trust with your GitLab repository. To copy your SSH public key:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Mirroring repositories</strong>.</li>
<li>Scroll to <strong>Mirrored repositories</strong>.</li>
<li>Identify the correct repository, and select <strong>Copy SSH public key</strong> ({{&lt; icon name="copy-to-clipboard" &gt;}}).</li>
<li>Add the public SSH key to the other repository's configuration:</li>
<li>If the other repository is hosted on GitLab, add the public SSH key
     as a <a href="../../deploy_keys/_index.html">deploy key</a>.</li>
<li>If the other repository is hosted elsewhere, add the key to
     your user's <code>authorized_keys</code> file. Paste the entire public SSH key into the
     file on its own line and save it.</li>
</ol>
<p>If you must change the key at any time, you can remove and re-add the mirror
to generate a new key. Update the other repository with the new
key to keep the mirror running.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>The generated keys are stored in the GitLab database, not in the file system. Therefore,
SSH public key authentication for mirrors cannot be used in a pre-receive hook.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Verify a host key</h3>
<p>When using a host key, always verify the fingerprints match what you expect.
GitLab.com and other code hosting sites publish their fingerprints
for you to check:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/codecommit/latest/userguide/regions.html#regions-fingerprints">AWS CodeCommit</a></li>
<li><a href="https://support.atlassian.com/bitbucket-cloud/docs/configure-ssh-and-two-step-verification/">Bitbucket</a></li>
<li><a href="https://docs.codeberg.org/security/ssh-fingerprint/">Codeberg</a></li>
<li><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/githubs-ssh-key-fingerprints">GitHub</a></li>
<li><a href="../../../gitlab_com/_index.md#ssh-host-keys-fingerprints">GitLab.com</a></li>
<li><a href="https://documentation.ubuntu.com/launchpad/user/reference/ssh-fingerprints/">Launchpad</a></li>
<li><a href="https://savannah.gnu.org/maintenance/SshAccess/">Savannah</a></li>
<li><a href="https://sourceforge.net/p/forge/documentation/SSH%20Key%20Fingerprints/">SourceForge</a></li>
</ul>
<p>Other providers vary. You can securely gather key fingerprints with the following
command if you:</p>
<ul>
<li>Run GitLab Self-Managed.</li>
<li>Have access to the server for the other repository.</li>
</ul>
<pre><code class="language-shell">$ cat /etc/ssh/ssh_host*pub | ssh-keygen -E md5 -l -f -
256 MD5:f4:28:9f:23:99:15:21:1b:bf:ed:1f:8e:a0:76:b2:9d root@example.com (ECDSA)
256 MD5:e6:eb:45:8a:3c:59:35:5f:e9:5b:80:12:be:7e:22:73 root@example.com (ED25519)
2048 MD5:3f:72:be:3d:62:03:5c:62:83:e8:6e:14:34:3a:85:1d root@example.com (RSA)
</code></pre>
<p>Older versions of SSH may require you to remove <code>-E md5</code> from the command.</p>
<h2>Related topics</h2>
<ul>
<li><a href="troubleshooting.html">Troubleshooting</a> for repository mirroring.</li>
<li>Configure a <a href="../../../../administration/instance_limits.md#pull-mirroring-interval">Pull Mirroring Interval</a></li>
<li><a href="../../../../administration/settings/visibility_and_access_controls.md#enable-project-mirroring">Disable mirrors for a project</a></li>
<li><a href="../../../../administration/backup_restore/troubleshooting_backup_gitlab.md#when-the-secrets-file-is-lost">Secrets file and mirroring</a></li>
</ul></code></pre>
</body>
</html>
