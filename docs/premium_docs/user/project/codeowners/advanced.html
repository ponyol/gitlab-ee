<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Pattern matching</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Create
group: Source Code
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Use Code Owners to define experts for your codebase, and set review requirements based on file type or location.
title: Advanced <code>CODEOWNERS</code> configuration</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>The <code>CODEOWNERS</code> file helps you define who is responsible for specific files and directories.
You can use pattern matching, sections, and inheritance rules to assign reviewers to merge requests
and require their approval before merging.</p>
<h2>Pattern matching</h2>
<p>GitLab uses <code>File::fnmatch</code> with the <code>File::FNM_DOTMATCH</code> and <code>File::FNM_PATHNAME</code> flags set for pattern matching:</p>
<ul>
<li>The repository structure is treated like an isolated file system.</li>
<li>The patterns follow a subset of shell filename globbing rules, and are not regular expressions.</li>
<li>The <code>File::FNM_DOTMATCH</code> flag allows <code>*</code> to match dotfiles like <code>.gitignore</code>.</li>
<li>The <code>File::FNM_PATHNAME</code> flag prevents <code>*</code> from matching the <code>/</code> path separator.</li>
<li><code>**</code> matches directories recursively. For example, <code>**/*.rb</code> matches <code>config/database.rb</code>
  and <code>app/controllers/users/stars_controller.rb</code>.</li>
</ul>
<h2>Default Code Owners and optional sections</h2>
<p>To combine the syntax for default owners with <a href="reference.md#optional-sections">optional sections</a>
and required approvals, place default owners at the end:</p>
<pre><code class="language-plaintext">[Documentation][2] @docs-team
docs/
README.md

^[Database] @database-team
model/db/
config/db/database-setup.md @docs-team
</code></pre>
<h2>Regular entries and sections</h2>
<p>If you set a default Code Owner for a path outside a section, their approval is always required.
Such entries aren't overridden by sections.
Entries without sections are treated as if they were another, unnamed section:</p>
<pre><code class="language-plaintext"># Required for all files
* @general-approvers

[Documentation] @docs-team
docs/
README.md
*.txt

[Database] @database-team
model/db/
config/db/database-setup.md @docs-team
</code></pre>
<p>In this example:</p>
<ul>
<li><code>@general-approvers</code> owns all items everywhere, without overrides.</li>
<li><code>@docs-team</code> owns all items in the <code>Documentation</code> section.</li>
<li><code>@database-team</code> owns all items in the <code>Database</code> section except
  <code>config/db/database-setup.md</code>, which has an override assigning it to <code>@docs-team</code>.</li>
<li>A merge request that modifies <code>model/db/CHANGELOG.txt</code> would require three approvals: one from each
  of the <code>@general-approvers</code>,<code>@docs-team</code>, and <code>@database-team</code> groups.</li>
</ul>
<p>Compare this behavior to when you use only <a href="reference.md#set-default-code-owner-for-a-section">default owners for sections</a>,
when specific entries in a section override the section default.</p>
<h2>Sections with duplicate names</h2>
<p>If multiple sections have the same name, they are combined.
Also, section headings are not case-sensitive. For example:</p>
<pre><code class="language-plaintext">[Documentation]
ee/docs/    @docs
docs/       @docs

[Database]
README.md  @database
model/db/   @database

[DOCUMENTATION]
README.md  @docs
</code></pre>
<p>This code results in three entries under the <code>Documentation</code> section header, and two
entries under <code>Database</code>. The entries defined under the sections <code>Documentation</code> and
<code>DOCUMENTATION</code> are combined, using the case of the first section.</p>
<h2>Define Code Owners for specific files or directories</h2>
<p>When a file or directory matches multiple entries in the <code>CODEOWNERS</code> file,
the users from last pattern matching the file or directory are used. This enables you
to define more specific owners for more specifically defined files or directories, when
you order the entries in a sensible way.</p>
<p>For example, in the following <code>CODEOWNERS</code> file:</p>
<pre><code class="language-plaintext"># This line would match the file terms.md
*.md @doc-team

# This line would also match the file terms.md
terms.md @legal-team
</code></pre>
<p>The Code Owner for <code>terms.md</code> would be <code>@legal-team</code>.</p>
<h2>Require multiple approvals from Code Owners</h2>
<p>You can require multiple approvals for the Code Owners sections in the Approvals area in merge requests.
Append the section name with a number <code>n</code> in brackets, for example, <code>[2]</code> or <code>[3]</code>.
This requires <code>n</code> approvals from the Code Owners in this section.
Valid entries for <code>n</code> are integers <code>≥ 1</code>. <code>[1]</code> is optional because it is the default. Invalid values for <code>n</code> are treated as <code>1</code>.</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/385881">Issue 384881</a> proposes changes
to the behavior of this setting. Do not intentionally set invalid values. They may
become valid in the future and cause unexpected behavior.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>To require multiple approvals from Code Owners:</p>
<ol>
<li>On the top bar, select <strong>Search or go to</strong> and find your project.</li>
<li>Select <strong>Settings</strong> &gt; <strong>Repository</strong>.</li>
<li>Expand <strong>Branch rules</strong>.</li>
<li>Next to the default branch, select <strong>View details</strong>.</li>
<li>Turn on the toggle under <strong>Code owner approval</strong>.</li>
<li>Edit the <code>CODEOWNERS</code> file to add a rule for multiple approvals.</li>
</ol>
<p>For example, to require two approvals for the <code>[Documentation]</code> section:</p>
<pre><code class="language-plaintext">[Documentation][2]
*.md @tech-writer-team

[Ruby]
*.rb @dev-team
</code></pre>
<p>The <code>Documentation</code> Code Owners section in the Approvals area displays two approvals are required:</p>
<p><img alt="MR widget - Multiple Approval Code Owners sections" src="img/multi_approvals_code_owners_sections_v15_9.png" /></p>
<h2>Group inheritance and eligibility</h2>
<pre><code class="language-mermaid">%%{init: { &quot;fontFamily&quot;: &quot;GitLab Sans&quot; }}%%
graph TD
    accTitle: Diagram of group inheritance
    accDescr: If a subgroup owns a project, the parent group inherits ownership.
    A[Parent group X] --&gt;|owns| B[Project A]
    A --&gt;|contains| C[Subgroup Y]
    C --&gt;|owns| D[Project B]
    A-. inherits ownership .-&gt; D
</code></pre>
<p>In this example:</p>
<ul>
<li>Parent group X (<code>group-x</code>) owns Project A.</li>
<li>Parent group X also contains a subgroup, Subgroup Y. (<code>group-x/subgroup-y</code>)</li>
<li>Subgroup Y owns Project B.</li>
</ul>
<p>The eligible Code Owners are:</p>
<ul>
<li>Project A: the members of Group X only, because Project A doesn't belong to Subgroup Y.</li>
<li>Project B: the members of both Group X and Subgroup Y.</li>
</ul>
<h3>Groups shared with parent groups</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/203298">Introduced</a> in GitLab 18.5 <a href="../../../administration/feature_flags/_index.html">with a flag</a> named <code>check_inherited_groups_for_codeowners</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/566627">Enabled on GitLab.com, GitLab Self-Managed, and GitLab Dedicated</a> in GitLab 18.6.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>{{&lt; alert type="flag" &gt;}}</p>
<p>The availability of this feature is controlled by a feature flag.
For more information, see the history.
When this feature is disabled, only groups directly invited to a project are
eligible as Code Owners. Groups shared with the project's parent groups are not
eligible.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>You can share a group with a parent group of a project. Members of the shared
group become eligible as Code Owners for projects in the parent group.</p>
<p>For example, in this hierarchy:</p>
<pre><code class="language-plaintext">group-x
├── engineering-group
└── product-group
    └── project-a
</code></pre>
<p>If you share <code>engineering-group</code> with <code>product-group</code>, members of
<code>engineering-group</code> become eligible as Code Owners for <code>project-a</code>.
You don't need to directly invite <code>engineering-group</code> to <code>project-a</code>.</p>
<p>The shared group must have at least the Developer role in the parent group.
Only direct members of the shared group are eligible as Code Owners.
Members who inherit membership in the shared group are not eligible as Code Owners.</p>
<h2>Error handling</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li>Error validation <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/216066">introduced</a> in GitLab 16.3.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<h3>Entries with spaces</h3>
<p>Escape whitespace in paths with backslashes:</p>
<pre><code class="language-plaintext">path\ with\ spaces/*.md @owner
</code></pre>
<p>Without escaping, GitLab parses <code>folder with spaces/*.md @group</code> as: <code>path: "folder", owners: " with spaces/*.md @group"</code>.</p>
<h3>Unparsable sections</h3>
<p>If a section heading cannot be parsed, the section is:</p>
<ol>
<li>Parsed as an entry.</li>
<li>Added to the previous section.</li>
<li>If no previous section exists, the section is added to the default section.</li>
</ol>
<h4>After the default section</h4>
<pre><code class="language-plaintext">* @group

[Section name
docs/ @docs_group
</code></pre>
<p>GitLab recognizes the heading <code>[Section name</code> as an entry. The default section includes 3 rules:</p>
<ul>
<li>Default section</li>
<li><code>*</code> owned by <code>@group</code></li>
<li><code>[Section</code> owned by <code>name</code></li>
<li><code>docs/</code> owned by <code>@docs_group</code></li>
</ul>
<h4>After a named section</h4>
<pre><code class="language-plaintext">[Docs]
docs/**/* @group

[Section name
docs/ @docs_group
</code></pre>
<p>GitLab recognizes the heading <code>[Section name</code> as an entry. The <code>[Docs]</code> section includes 3 rules:</p>
<ul>
<li><code>docs/**/*</code> owned by <code>@group</code></li>
<li><code>[Section</code> owned by <code>name</code></li>
<li><code>docs/</code> owned by <code>@docs_group</code></li>
</ul>
<h3>Malformed owners</h3>
<p>Each entry must contain one or more owners. Malformed owners are invalid and ignored:</p>
<pre><code class="language-plaintext">/path/* @group user_without_at_symbol @user_with_at_symbol
</code></pre>
<p>This entry is owned by <code>@group</code> and <code>@user_with_at_symbol</code>.</p>
<h3>Inaccessible or incorrect owners</h3>
<p>GitLab ignores inaccessible or incorrect owners. For example:</p>
<pre><code class="language-plaintext">* @group @grou @username @i_left @i_dont_exist example@gitlab.com invalid@gitlab.com
</code></pre>
<p>If only <code>@group</code>, <code>@username</code>, and <code>example@gitlab.com</code> are accessible, GitLab ignores the others.</p>
<h3>Zero owners</h3>
<p>If an entry includes no owners, or zero <a href="#inaccessible-or-incorrect-owners">accessible owners</a>
exist, the entry is invalid. Because this rule can never be satisfied, GitLab
auto-approves it in merge requests.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>When a protected branch has <code>Require code owner approval</code> enabled, rules with
zero owners are still honored.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Minimum approvals</h3>
<p>When <a href="advanced.md#require-multiple-approvals-from-code-owners">defining the number of approvals</a> for a section,
the minimum number of approvals is <code>1</code>. Setting the number of approvals to
<code>0</code> results in GitLab requiring one approval.</p></code></pre>
</body>
</html>
