<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Configure GitLab</title>
    <link rel="stylesheet" href="/../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Fulfillment
group: Seat Management
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Configure SCIM for GitLab Self-Managed or GitLab Dedicated
description: Manage the user lifecycle with automated account provisioning.</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/8902">Introduced</a> in GitLab 15.8.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>You can use the open standard System for Cross-domain Identity Management (SCIM) to automatically:</p>
<ul>
<li>Create users.</li>
<li>Block users.</li>
<li>Re-add users (reactivate SCIM identity).</li>
</ul>
<p>The <a href="../../development/internal_api/_index.md#instance-scim-api">internal GitLab SCIM API</a> implements part of <a href="https://www.rfc-editor.org/rfc/rfc7644">the RFC7644 protocol</a>.</p>
<p>If you are a GitLab.com user, see <a href="../../user/group/saml_sso/scim_setup.html">configuring SCIM for GitLab.com groups</a>.</p>
<h2>Configure GitLab</h2>
<p>Prerequisites:</p>
<ul>
<li>Configure <a href="../../integration/saml.html">SAML single sign-on</a>.</li>
</ul>
<p>To configure GitLab SCIM:</p>
<ol>
<li>In the upper-right corner, select <strong>Admin</strong>.</li>
<li>Select <strong>Settings</strong> &gt; <strong>General</strong>.</li>
<li>Expand the <strong>SCIM Token</strong> section and select <strong>Generate a SCIM token</strong>.</li>
<li>For configuration of your identity provider, save the:</li>
<li>Token from the <strong>Your SCIM token</strong> field.</li>
<li>URL from the <strong>SCIM API endpoint URL</strong> field.</li>
</ol>
<h2>Configure an identity provider</h2>
<p>You can configure the following as an identity provider:</p>
<ul>
<li><a href="#configure-okta">Okta</a>.</li>
<li><a href="#configure-microsoft-entra-id-formerly-azure-active-directory">Microsoft Entra ID (formerly Azure Active Directory)</a></li>
</ul>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Other identity providers can work with GitLab but they have not been tested and are not supported. You should contact the provider for support. GitLab support can assist by reviewing related log entries.</p>
<p>{{&lt; /alert &gt;}}</p>
<h3>Configure Okta</h3>
<p>The SAML application created during <a href="../../integration/saml.html">single sign-on</a> set up for Okta must be set up for SCIM.</p>
<p>Prerequisites:</p>
<ul>
<li>You must use the <a href="https://www.okta.com/products/lifecycle-management/">Okta Lifecycle Management</a> product. This
  product tier is required to use SCIM on Okta.</li>
<li><a href="#configure-gitlab">GitLab is configured</a> for SCIM.</li>
<li>The SAML application for <a href="https://developer.okta.com/docs/guides/build-sso-integration/saml2/main/">Okta</a> set up as
  described in the <a href="../../integration/saml.md#set-up-okta">Okta setup notes</a>.</li>
<li>Your Okta SAML setup matches the <a href="_index.html">configuration steps</a>, especially the NameID configuration.</li>
</ul>
<p>To configure Okta for SCIM:</p>
<ol>
<li>Sign in to Okta.</li>
<li>In the upper-right corner, select <strong>Admin</strong>. The button is not visible from the <strong>Admin</strong> area.</li>
<li>In the <strong>Application</strong> tab, select <strong>Browse App Catalog</strong>.</li>
<li>Find and select the <strong>GitLab</strong> application.</li>
<li>On the GitLab application overview page, select <strong>Add Integration</strong>.</li>
<li>Under <strong>Application Visibility</strong>, select both checkboxes. The GitLab application does not support SAML
   authentication so the icon should not be shown to users.</li>
<li>Select <strong>Done</strong> to finish adding the application.</li>
<li>In the <strong>Provisioning</strong> tab, select <strong>Configure API integration</strong>.</li>
<li>Select <strong>Enable API integration</strong>.</li>
<li>For <strong>Base URL</strong>, paste the URL you copied from <strong>SCIM API endpoint URL</strong> on the GitLab SCIM configuration page.</li>
<li>For <strong>API Token</strong>, paste the SCIM token you copied from <strong>Your SCIM token</strong> on the GitLab SCIM
     configuration page.</li>
<li>To verify the configuration, select <strong>Test API Credentials</strong>.</li>
<li>Select <strong>Save</strong>.</li>
<li>After saving the API integration details, new settings tabs appear on the left. Select <strong>To App</strong>.</li>
<li>Select <strong>Edit</strong>.</li>
<li>Select the <strong>Enable</strong> checkbox for both <strong>Create Users</strong> and <strong>Deactivate Users</strong>.</li>
<li>Select <strong>Save</strong>.</li>
<li>Assign users in the <strong>Assignments</strong> tab. Assigned users are created and managed in your GitLab group.</li>
</ol>
<h3>Configure Microsoft Entra ID (formerly Azure Active Directory)</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/143146">Changed</a> to Microsoft Entra ID terminology in GitLab 16.10.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li><a href="#configure-gitlab">GitLab is configured</a> for SCIM.</li>
<li>The <a href="../../integration/saml.md#set-up-microsoft-entra-id">SAML application for Microsoft Entra ID is set up</a>.</li>
</ul>
<p>The SAML application created during <a href="../../integration/saml.html">single sign-on</a> set up for
<a href="https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/view-applications-portal">Azure Active Directory</a>
must be set up for SCIM. For an example, see <a href="../../user/group/saml_sso/example_saml_config.md#scim-mapping">example configuration</a>.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You must configure SCIM provisioning exactly as detailed in the following instructions. If misconfigured, you will encounter issues with user provisioning
and sign in, which require a lot of effort to resolve. If you have any trouble or questions with any step, contact GitLab support.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>To configure Microsoft Entra ID, you configure:</p>
<ul>
<li>Microsoft Entra ID for SCIM.</li>
<li>Settings.</li>
<li>Mappings, including attribute mappings.</li>
</ul>
<h4>Configure Microsoft Entra ID for SCIM</h4>
<ol>
<li>In your app, go to the <strong>Provisioning</strong> tab and select <strong>Get started</strong>.</li>
<li>Set the <strong>Provisioning Mode</strong> to <strong>Automatic</strong>.</li>
<li>Complete the <strong>Admin Credentials</strong> using the value of:</li>
<li><strong>SCIM API endpoint URL</strong> in GitLab for the <strong>Tenant URL</strong> field.</li>
<li><strong>Your SCIM token</strong> in GitLab for the <strong>Secret Token</strong> field.</li>
<li>Select <strong>Test Connection</strong>.</li>
</ol>
<p>If the test is successful, save your configuration.</p>
<p>If the test is unsuccessful, see
   <a href="../../user/group/saml_sso/troubleshooting.html">troubleshooting</a> to try to resolve this.
1. Select <strong>Save</strong>.</p>
<p>After saving, the <strong>Mappings</strong> and <strong>Settings</strong> sections appear.</p>
<h4>Configure mappings</h4>
<p>Under the <strong>Mappings</strong> section, first provision the groups:</p>
<ol>
<li>Select <strong>Provision Microsoft Entra ID Groups</strong>.</li>
<li>On the Attribute Mapping page, turn off the <strong>Enabled</strong> toggle.</li>
</ol>
<p>SCIM group provisioning is not supported in GitLab. Leaving group provisioning enabled does not break the SCIM user provisioning, but it causes errors in the
   Entra ID SCIM provisioning log that might be confusing and misleading.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>Even when <strong>Provision Microsoft Entra ID Groups</strong> is disabled, the mappings section might display <strong>Enabled: Yes</strong>. This behavior is a display bug that you can safely ignore.</p>
<p>{{&lt; /alert &gt;}}</p>
<ol>
<li>Select <strong>Save</strong>.</li>
</ol>
<p>Next, provision the users:</p>
<ol>
<li>Select <strong>Provision Microsoft Entra ID Users</strong>.</li>
<li>Ensure that the <strong>Enabled</strong> toggle is set to <strong>Yes</strong>.</li>
<li>Ensure that all <strong>Target Object Actions</strong> are enabled.</li>
<li>Under <strong>Attribute Mappings</strong>, configure mappings to match
   the <a href="#configure-attribute-mappings">configured attribute mappings</a>:</li>
<li>Optional. In the <strong>customappsso Attribute</strong> column, find <code>externalId</code> and delete it.</li>
<li>Edit the first attribute to have a:<ul>
<li><strong>source attribute</strong> of <code>objectId</code>.</li>
<li><strong>target attribute</strong> of <code>externalId</code>.</li>
<li><strong>matching precedence</strong> of <code>1</code>.</li>
</ul>
</li>
<li>Update the existing <strong>customappsso</strong> attributes to match the
      <a href="#configure-attribute-mappings">configured attribute mappings</a>.</li>
<li>Delete any additional attributes that are not present in the <a href="#configure-attribute-mappings">attribute mappings table</a>. They do not cause problems if they are
      not deleted, but GitLab does not consume the attributes.</li>
<li>Under the mapping list, select the <strong>Show advanced options</strong> checkbox.</li>
<li>Select the <strong>Edit attribute list for customappsso</strong> link.</li>
<li>Ensure the <code>id</code> is the primary and required field, and <code>externalId</code> is also required.</li>
<li>Select <strong>Save</strong>, which returns you to the Attribute Mapping configuration page.</li>
<li>To close the <strong>Attribute Mapping</strong> configuration page, select <code>X</code> in the upper-right corner.</li>
</ol>
<h5>Configure attribute mappings</h5>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>While Microsoft transitions from Azure Active Directory to Entra ID naming schemes, you might notice inconsistencies in
your user interface. If you're having trouble, you can view an older version of this document or contact GitLab Support.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>While <a href="#configure-microsoft-entra-id-formerly-azure-active-directory">configuring Entra ID for SCIM</a>, you configure
attribute mappings. For an example, see <a href="../../user/group/saml_sso/example_saml_config.md#scim-mapping">example configuration</a>.</p>
<p>The following table provides attribute mappings that are required for GitLab.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Source attribute</th>
<th style="text-align: left;">Target attribute</th>
<th style="text-align: left;">Matching precedence</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>objectId</code></td>
<td style="text-align: left;"><code>externalId</code></td>
<td style="text-align: left;">1</td>
</tr>
<tr>
<td style="text-align: left;"><code>userPrincipalName</code> OR <code>mail</code> <sup>1</sup></td>
<td style="text-align: left;"><code>emails[type eq "work"].value</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><code>mailNickname</code></td>
<td style="text-align: left;"><code>userName</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><code>displayName</code> OR <code>Join(" ", [givenName], [surname])</code> <sup>2</sup></td>
<td style="text-align: left;"><code>name.formatted</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><code>Switch([IsSoftDeleted], , "False", "True", "True", "False")</code> <sup>3</sup></td>
<td style="text-align: left;"><code>active</code></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p><strong>Footnotes</strong>:</p>
<ol>
<li>Use <code>mail</code> as a source attribute when the <code>userPrincipalName</code> is not an email address or is not deliverable.</li>
<li>Use the <code>Join</code> expression if your <code>displayName</code> does not match the format of <code>Firstname Lastname</code>.</li>
<li>This is an expression mapping type, not a direct mapping. Select <strong>Expression</strong> in the <strong>Mapping type</strong> dropdown list.</li>
</ol>
<p>Each attribute mapping has:</p>
<ul>
<li>A <strong>customappsso Attribute</strong>, which corresponds to <strong>target attribute</strong>.</li>
<li>A <strong>Microsoft Entra ID Attribute</strong>, which corresponds to <strong>source attribute</strong>.</li>
<li>A matching precedence.</li>
</ul>
<p>For each attribute:</p>
<ol>
<li>Edit the existing attribute or add a new attribute.</li>
<li>Select the required source and target attribute mappings from the dropdown lists.</li>
<li>Select <strong>Ok</strong>.</li>
<li>Select <strong>Save</strong>.</li>
</ol>
<p>If your SAML configuration differs from <a href="../../integration/saml.html">the recommended SAML settings</a>, select the mapping
attributes and modify them accordingly. The source attribute that you map to the <code>externalId</code>
target attribute must match the attribute used for the SAML <code>NameID</code>.</p>
<p>If a mapping is not listed in the table, use the Microsoft Entra ID defaults. For a list of required attributes,
refer to the <a href="../../development/internal_api/_index.md#instance-scim-api">internal instance SCIM API</a> documentation.</p>
<h4>Configure settings</h4>
<p>Under the <strong>Settings</strong> section:</p>
<ol>
<li>Optional. If desired, select the <strong>Send an email notification when a failure occurs</strong> checkbox.</li>
<li>Optional. If desired, select the <strong>Prevent accidental deletion</strong> checkbox.</li>
<li>If necessary, select <strong>Save</strong> to ensure all changes have been saved.</li>
</ol>
<p>After you have configured the mappings and the settings, return to the app overview page and select <strong>Start provisioning</strong> to start automatic SCIM provisioning of users in GitLab.</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Once synchronized, changing the field mapped to <code>id</code> and <code>externalId</code> might cause errors. These include
provisioning errors, duplicate users, and might prevent existing users from accessing the GitLab group.</p>
<p>{{&lt; /alert &gt;}}</p>
<h2>Remove access</h2>
<p>Removing or deactivating a user on the identity provider blocks the user on
the GitLab instance, while the SCIM identity remains linked to the GitLab user.</p>
<p>To update the user SCIM identity, use the
<a href="../../development/internal_api/_index.md#update-a-single-scim-provisioned-user-1">internal GitLab SCIM API</a>.</p>
<h3>Reactivate access</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/379149">Introduced</a> in GitLab 16.0 <a href="../feature_flags/_index.html">with a flag</a> named <code>skip_saml_identity_destroy_during_scim_deprovision</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/121226">Generally available</a> in GitLab 16.4. Feature flag <code>skip_saml_identity_destroy_during_scim_deprovision</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>After a user is removed or deactivated through SCIM, you can reactivate that user by
adding them to the SCIM identity provider.</p>
<p>After the identity provider performs a sync based on its configured schedule,
the user's SCIM identity is reactivated and their GitLab instance access is restored.</p>
<h2>Group synchronization with SCIM</h2>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/groups/gitlab-org/-/epics/15990">Introduced</a> in GitLab 18.0 <a href="../../administration/feature_flags/_index.html">with a flag</a> named <code>self_managed_scim_group_sync</code>. Disabled by default.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/553662">Enabled on GitLab Self-Managed</a> by default in GitLab 18.2.</li>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/554271">Generally available</a> in GitLab 18.6. Feature flag <code>self_managed_scim_group_sync</code> removed.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>In addition to user provisioning, you can use SCIM to synchronize group memberships between your identity provider and GitLab.
With this method you can automatically add and remove users from GitLab groups based on their group memberships in your identity provider.</p>
<p>Prerequisites:</p>
<ul>
<li><a href="../../user/group/saml_sso/group_sync.md#configure-saml-group-links">SAML group links</a> must be configured first.</li>
<li>The SAML group names in your identity provider must match the SAML group names configured in GitLab.</li>
</ul>
<p>SCIM group synchronization works with SAML group links to manage group memberships. When your identity provider sends group membership changes through the SCIM API, GitLab updates user memberships in all GitLab groups that have SAML group links associated with that SCIM group.</p>
<p>SCIM is a one-directional protocol: changes flow from your identity provider to GitLab. If you make changes to SAML group links in GitLab (such as adding or removing them), your identity provider has no way to detect these changes through SCIM.</p>
<h3>Known limitation of new group links</h3>
<p>When your identity provider first provisions a SCIM group (through <code>POST /Groups</code>), GitLab associates the SCIM group ID with all existing SAML group links that have a matching group name.
However, if you add new SAML group links with the same group name after the initial provisioning,
the new group links are not automatically associated with the SCIM group ID.
This means SCIM membership updates from your identity provider do not affect users in the newly added group links.</p>
<p>Support for improvements is proposed in <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/582729">issue 582729</a>.</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>To ensure all group links are associated with the SCIM group from the start,
you should configure all SAML group links before setting up SCIM group provisioning in your identity provider.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>If you need to add group links after the initial provisioning, you can re-provision the SCIM group in your identity provider by deleting the SCIM group provisioning (not the IdP group itself), then recreating it.
This action re-associates all current SAML group links with the SCIM group.
For more information, refer to your identity provider's documentation for managing SCIM group provisioning.</p>
<p>If you delete a SAML group link in GitLab, members of that group through that link remain in the group.
However, SCIM no longer manages their membership in that group because the group link has been removed.
If needed, you can manually <a href="../../user/group/_index.md#remove-a-member-from-the-group">remove members from the group</a>.</p>
<h3>Configure group synchronization in your identity provider</h3>
<p>For detailed instructions on configuring group synchronization in your identity provider, refer to the provider's documentation. Examples below:</p>
<ul>
<li><a href="https://developer.okta.com/docs/reference/api/groups/">Okta Groups API</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity/app-provisioning/use-scim-to-provision-users-and-groups">Microsoft Entra ID (Azure AD) SCIM Groups</a><ul>
<li>By default, the <code>displayName</code> source attribute is used to find SAML group links with user-friendly names.</li>
<li>However, if your SAML group links use an object ID for the name,
  you must update the source attribute to <code>objectId</code>.</li>
</ul>
</li>
</ul>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>When multiple SAML group links map to the same GitLab group, users are assigned the highest role across all mapping group links. Users removed from an IdP group stay in a GitLab group if they belong to another SAML group linked to it.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>The standard GitLab SCIM application in the Okta application catalog does not support group synchronization.
Alternatively, you can create a custom SCIM integration for group synchronization with Okta.
For more information, see <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/582729">issue 582729</a>.</p>
<h2>Troubleshooting</h2>
<p>See our <a href="../../user/group/saml_sso/troubleshooting_scim.html">troubleshooting SCIM guide</a>.</p></code></pre>
</body>
</html>
