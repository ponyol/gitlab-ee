<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Pause and resume</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Tenant Scale
group: Geo
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Pausing and resuming replication</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab Self-Managed</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>Pausing and resuming of replication is only supported for Geo installations using a
Linux package-managed database. External databases are not supported.</p>
<p><strong>Do not pause replication</strong> if the primary site has failed catastrophically and cannot be recovered. This can create unreachable recovery targets that prevent successful promotion of the secondary site.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>In some circumstances, like during <a href="upgrading_the_geo_sites.html">upgrades</a> or a
<a href="../disaster_recovery/planned_failover.html">planned failover</a>, it is desirable to pause replication between the primary and secondary.</p>
<p>If you plan to allow user activity on your secondary sites during the upgrade,
do not pause replication for a <a href="../../../update/zero_downtime.html">zero-downtime upgrade</a>. While paused, the secondary site gets more and more out-of-date.
One known effect is that more and more Git fetches get redirected or proxied to the primary site. There may be additional unknown effects.</p>
<p>For example, pausing a secondary site with a separate URL may break sign-in at the secondary site's URL. You land on the primary site's root URL, without a new session on the secondary site's URL.</p>
<h2>Pause and resume</h2>
<p>Pausing and resuming replication is done through a command-line tool from a specific node in the secondary site. Depending on your database architecture,
this targets either the <code>postgresql</code> or <code>patroni</code> service:</p>
<ul>
<li>If you are using a single node for all services on your secondary site, you must run the commands on this single node.</li>
<li>If you have a standalone PostgreSQL node on your secondary site, you must run the commands on this standalone PostgreSQL node.</li>
<li>If your secondary site is using a Patroni cluster, you must run these commands on the secondary Patroni standby leader node.</li>
</ul>
<p>If you aren't using a single node for all services on your secondary site, ensure that the <code>/etc/gitlab/gitlab.rb</code> on your PostgreSQL or Patroni nodes
contains the configuration line <code>gitlab_rails['geo_node_name'] = 'node_name'</code>, where <code>node_name</code> is the same as the <code>geo_node_name</code> on the application node.</p>
<p><strong>To Pause: (from secondary site)</strong></p>
<p>Also, be aware that if PostgreSQL is restarted after pausing replication (either by restarting the VM or restarting the service with <code>gitlab-ctl restart postgresql</code>), PostgreSQL automatically resumes replication, which is something you wouldn't want during an upgrade or in a planned failover scenario.</p>
<pre><code class="language-shell">gitlab-ctl geo-replication-pause
</code></pre>
<p><strong>To Resume: (from secondary site)</strong></p>
<pre><code class="language-shell">gitlab-ctl geo-replication-resume
</code></pre></code></pre>
</body>
</html>
