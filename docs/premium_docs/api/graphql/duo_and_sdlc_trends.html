<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Retrieve AI usage data</title>
    <link rel="stylesheet" href="/../../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Plan
group: Optimize
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Retrieve GitLab Duo and SDLC trend data</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>Use the GraphQL API to retrieve and export GitLab Duo data.</p>
<h2>Retrieve AI usage data</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/474469">Introduced</a> in GitLab 17.5 with a flag named <code>code_suggestions_usage_events_in_pg</code>. Disabled by default.</li>
<li>Feature flag <code>move_ai_tracking_to_instrumentation_layer</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/167415">added</a> in GitLab 17.7. Disabled by default.</li>
<li>Dependency on <code>move_ai_tracking_to_instrumentation_layer</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/merge_requests/179527">removed</a> in GitLab 17.8.</li>
<li>Feature flag <code>code_suggestions_usage_events_in_pg</code> <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/486469">removed</a> in GitLab 17.8.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>The <code>AiUsageData</code> endpoint provides raw event data. It exposes Code Suggestions-specific events through <code>codeSuggestionEvents</code> and all raw event data through <code>all</code>.</p>
<p>You can use this endpoint to import events into a BI tool or write scripts that aggregate the data, acceptance rates, and per-user metrics for all GitLab Duo events.</p>
<p>Data is retained for three months for customers without ClickHouse installed. For customers with ClickHouse configured, there is currently no data retention policy.</p>
<p>The <code>all</code> attribute is filterable by <code>startDate</code>, <code>endDate</code>, <code>events</code>, <code>userIds</code>, and standard pagination values.</p>
<p>To see which events are being tracked, you can examine the events declared in the <a href="https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/lib/gitlab/tracking/ai_tracking.rb"><code>ai_tracking.rb</code></a> file.</p>
<h3>For projects and groups</h3>
<p>For example, to retrieve usage data for all Code Suggestions events for the <code>gitlab-org</code> group:</p>
<pre><code class="language-graphql">query {
  group(fullPath: &quot;gitlab-org&quot;) {
    aiUsageData {
      codeSuggestionEvents(startDate: &quot;2025-09-26&quot;) {
        nodes {
          event
          timestamp
          language
          suggestionSize
          user {
            username
          }
        }
      }
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;group&quot;: {
      &quot;aiUsageData&quot;: {
        &quot;codeSuggestionEvents&quot;: {
          &quot;nodes&quot;: [
            {
              &quot;event&quot;: &quot;CODE_SUGGESTION_SHOWN_IN_IDE&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:17:25Z&quot;,
              &quot;language&quot;: &quot;python&quot;,
              &quot;suggestionSize&quot;: 2,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            },
            {
              &quot;event&quot;: &quot;CODE_SUGGESTION_REJECTED_IN_IDE&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:13:45Z&quot;,
              &quot;language&quot;: &quot;python&quot;,
              &quot;suggestionSize&quot;: 2,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            },
            {
              &quot;event&quot;: &quot;CODE_SUGGESTION_ACCEPTED_IN_IDE&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:13:44Z&quot;,
              &quot;language&quot;: &quot;python&quot;,
              &quot;suggestionSize&quot;: 2,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            }
          ]
        }
      }
    }
  }
}
</code></pre>
<p>Alternatively, to retrieve usage data for all GitLab Duo events for the <code>gitlab-org</code> group:</p>
<pre><code class="language-graphql">query {
  group(fullPath: &quot;gitlab-org&quot;) {
    aiUsageData {
      all(startDate: &quot;2025-09-26&quot;) {
        nodes {
          event
          timestamp
          user {
            username
          }
        }
      }
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;group&quot;: {
      &quot;aiUsageData&quot;: {
        &quot;all&quot;: {
          &quot;nodes&quot;: [
            {
              &quot;event&quot;: &quot;FIND_NO_ISSUES_DUO_CODE_REVIEW_AFTER_REVIEW&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:17:25Z&quot;,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            },
            {
              &quot;event&quot;: &quot;REQUEST_REVIEW_DUO_CODE_REVIEW_ON_MR_BY_AUTHOR&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:13:45Z&quot;,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            },
            {
              &quot;event&quot;: &quot;AGENT_PLATFORM_SESSION_STARTED&quot;,
              &quot;timestamp&quot;: &quot;2025-09-26T18:13:44Z&quot;,
              &quot;user&quot;: {
                &quot;username&quot;: &quot;jasbourne&quot;
              }
            }
          ]
        }
      }
    }
  }
}
</code></pre>
<h3>For instances</h3>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Offering: GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/582153">Introduced</a> in GitLab 18.7. This feature is an <a href="../../policy/development_stages_support.html">experiment</a>.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Prerequisites:</p>
<ul>
<li>You must be an administrator for the instance.</li>
</ul>
<p>For example, to retrieve all GitLab Duo usage events for the entire instance:</p>
<pre><code class="language-graphql">query {
  aiUsageData {
    all(startDate: &quot;2025-09-26&quot;, endDate: &quot;2025-09-30&quot;) {
      nodes {
        event
        timestamp
        user {
          username
        }
        extras
      }
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;aiUsageData&quot;: {
      &quot;all&quot;: {
        &quot;nodes&quot;: [
          {
            &quot;event&quot;: &quot;CODE_SUGGESTION_SHOWN_IN_IDE&quot;,
            &quot;timestamp&quot;: &quot;2025-09-26T18:17:25Z&quot;,
            &quot;user&quot;: {
              &quot;username&quot;: &quot;jasbourne&quot;
            },
            &quot;extras&quot;: {}
          },
          {
            &quot;event&quot;: &quot;AGENT_PLATFORM_SESSION_STARTED&quot;,
            &quot;timestamp&quot;: &quot;2025-09-26T18:13:44Z&quot;,
            &quot;user&quot;: {
              &quot;username&quot;: &quot;johndoe&quot;
            },
            &quot;extras&quot;: {
              &quot;session_id&quot;: &quot;abc123&quot;
            }
          }
        ]
      }
    }
  }
}
</code></pre>
<h2>Retrieve AI user metrics</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Offering: GitLab.com, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/483049">Introduced</a> in GitLab 17.6.</li>
<li>Feature-specific metric types <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/483049">introduced</a> in GitLab 18.7</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>The <code>AiUserMetrics</code> endpoint provides pre-aggregated per-user metrics for all registered GitLab Duo features, including Code Suggestions, GitLab Duo Chat, Code Review, Agent Platform (Agentic Chat), Job Troubleshooting, and Model Context Protocol (MCP) tool calls.</p>
<p>You can use this endpoint to analyze GitLab Duo user engagement and measure usage frequency across different GitLab Duo features.</p>
<p>Prerequisites:</p>
<ul>
<li>You must have ClickHouse configured.</li>
</ul>
<h3>Total event counts</h3>
<p>The <code>AiUserMetrics</code> endpoint provides the following levels of event count aggregation:</p>
<ul>
<li>Top-level <code>totalEventCount</code>: Returns the sum of all event counts across all GitLab Duo features for a user.</li>
<li>Feature-level <code>totalEventCount</code>: Available in each feature metric type, returns the sum of all event counts for that specific feature.</li>
</ul>
<p>You can use these fields to get aggregate counts at different levels of granularity.</p>
<p>For example, to retrieve both top-level and feature-level totals:</p>
<pre><code class="language-graphql">query {
  group(fullPath:&quot;gitlab-org&quot;) {
    aiUserMetrics {
      nodes {
        user {
          username
        }
        totalEventCount
        codeSuggestions {
          totalEventCount
          codeSuggestionAcceptedInIdeEventCount
          codeSuggestionShownInIdeEventCount
        }
        chat {
          totalEventCount
          requestDuoChatResponseEventCount
        }
      }
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;group&quot;: {
      &quot;aiUserMetrics&quot;: {
        &quot;nodes&quot;: [
          {
            &quot;user&quot;: {
              &quot;username&quot;: &quot;USER_1&quot;
            },
            &quot;totalEventCount&quot;: 82,
            &quot;codeSuggestions&quot;: {
              &quot;totalEventCount&quot;: 60,
              &quot;codeSuggestionAcceptedInIdeEventCount&quot;: 10,
              &quot;codeSuggestionShownInIdeEventCount&quot;: 50
            },
            &quot;chat&quot;: {
              &quot;totalEventCount&quot;: 22,
              &quot;requestDuoChatResponseEventCount&quot;: 22
            }
          },
          {
            &quot;user&quot;: {
              &quot;username&quot;: &quot;USER_2&quot;
            },
            &quot;totalEventCount&quot;: 102,
            &quot;codeSuggestions&quot;: {
              &quot;totalEventCount&quot;: 72,
              &quot;codeSuggestionAcceptedInIdeEventCount&quot;: 12,
              &quot;codeSuggestionShownInIdeEventCount&quot;: 60
            },
            &quot;chat&quot;: {
              &quot;totalEventCount&quot;: 30,
              &quot;requestDuoChatResponseEventCount&quot;: 30
            }
          }
        ]
      }
    }
  }
}
</code></pre>
<p>In this example:</p>
<ul>
<li>The top-level <code>totalEventCount</code> (82 for USER_1) is the sum of all events across all features.</li>
<li>Each feature's <code>totalEventCount</code> represents the sum of events within that feature only.</li>
<li>Code Suggestions: 60 events (10 accepted + 50 shown)</li>
<li>Chat: 22 events</li>
</ul>
<h3>Feature-specific metric types</h3>
<p>The <code>AiUserMetrics</code> endpoint provides detailed metrics through feature-specific nested types. Each GitLab Duo feature has its own dedicated metric type that exposes event count fields for all tracked events related to that feature.</p>
<p>Available feature metric types include:</p>
<ul>
<li><code>codeSuggestions</code>: Code Suggestions-specific metrics</li>
<li><code>chat</code>: GitLab Duo Chat-specific metrics</li>
<li><code>codeReview</code>: Code Review-specific metrics</li>
<li><code>agentPlatform</code>: Agent Platform-specific metrics (includes Agentic Chat sessions)</li>
<li><code>troubleshootJob</code>: Job troubleshooting-specific metrics</li>
<li><code>mcp</code>: Model Context Protocol (MCP) tool call metrics</li>
</ul>
<p>Each feature metric type includes:</p>
<ul>
<li>Individual event count fields for all tracked events in that feature</li>
<li>A <code>totalEventCount</code> field that sums all events for that specific feature</li>
</ul>
<p>The available event count fields are dynamically generated based on the events registered in the system. To see which events are tracked for each feature, examine the events declared in the <a href="https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/lib/gitlab/tracking/ai_tracking.rb"><code>ai_tracking.rb</code></a> file.</p>
<p>For example, to retrieve detailed metrics across multiple GitLab Duo features:</p>
<pre><code class="language-graphql">query {
  group(fullPath:&quot;gitlab-org&quot;) {
    aiUserMetrics {
      nodes {
        user {
          username
        }
        codeSuggestions {
          totalEventCount
          codeSuggestionAcceptedInIdeEventCount
          codeSuggestionShownInIdeEventCount
        }
        chat {
          totalEventCount
          requestDuoChatResponseEventCount
        }
        codeReview {
          totalEventCount
          requestReviewDuoCodeReviewOnMrByAuthorEventCount
          findNoIssuesDuoCodeReviewAfterReviewEventCount
        }
        agentPlatform {
          totalEventCount
          agentPlatformSessionStartedEventCount
          agentPlatformSessionFinishedEventCount
        }
      }
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;group&quot;: {
      &quot;aiUserMetrics&quot;: {
        &quot;nodes&quot;: [
          {
            &quot;user&quot;: {
              &quot;username&quot;: &quot;USER_1&quot;
            },
            &quot;codeSuggestions&quot;: {
              &quot;totalEventCount&quot;: 60,
              &quot;codeSuggestionAcceptedInIdeEventCount&quot;: 10,
              &quot;codeSuggestionShownInIdeEventCount&quot;: 50
            },
            &quot;chat&quot;: {
              &quot;totalEventCount&quot;: 22,
              &quot;requestDuoChatResponseEventCount&quot;: 22
            },
            &quot;codeReview&quot;: {
              &quot;totalEventCount&quot;: 8,
              &quot;requestReviewDuoCodeReviewOnMrByAuthorEventCount&quot;: 5,
              &quot;findNoIssuesDuoCodeReviewAfterReviewEventCount&quot;: 3
            },
            &quot;agentPlatform&quot;: {
              &quot;totalEventCount&quot;: 15,
              &quot;agentPlatformSessionStartedEventCount&quot;: 8,
              &quot;agentPlatformSessionFinishedEventCount&quot;: 7
            }
          },
          {
            &quot;user&quot;: {
              &quot;username&quot;: &quot;USER_2&quot;
            },
            &quot;codeSuggestions&quot;: {
              &quot;totalEventCount&quot;: 72,
              &quot;codeSuggestionAcceptedInIdeEventCount&quot;: 12,
              &quot;codeSuggestionShownInIdeEventCount&quot;: 60
            },
            &quot;chat&quot;: {
              &quot;totalEventCount&quot;: 30,
              &quot;requestDuoChatResponseEventCount&quot;: 30
            },
            &quot;codeReview&quot;: {
              &quot;totalEventCount&quot;: 5,
              &quot;requestReviewDuoCodeReviewOnMrByAuthorEventCount&quot;: 3,
              &quot;findNoIssuesDuoCodeReviewAfterReviewEventCount&quot;: 2
            },
            &quot;agentPlatform&quot;: {
              &quot;totalEventCount&quot;: 20,
              &quot;agentPlatformSessionStartedEventCount&quot;: 12,
              &quot;agentPlatformSessionFinishedEventCount&quot;: 8
            }
          }
        ]
      }
    }
  }
}
</code></pre>
<h2>Retrieve GitLab Duo and SDLC trend metrics</h2>
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Offering: GitLab.com, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/443696">Introduced</a> in GitLab 16.11.</li>
<li>Add-on requirement <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/498497">changed</a> from GitLab Duo Enterprise to GitLab Duo Pro in GitLab 17.6.</li>
<li>Add-on requirement <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/580174">removed</a> in GitLab 18.7.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>The <code>AiMetrics</code> endpoint powers the GitLab Duo and SDLC trends dashboard and provides the following pre-aggregated metrics for Code Suggestions and GitLab Duo Chat:</p>
<ul>
<li><code>codeSuggestionsShown</code></li>
<li><code>codeSuggestionsAccepted</code></li>
<li><code>codeSuggestionAcceptanceRate</code></li>
<li><code>codeSuggestionUsers</code></li>
<li><code>duoChatUsers</code></li>
</ul>
<p>Prerequisites:</p>
<ul>
<li>You must have ClickHouse configured.</li>
</ul>
<p>For example, to retrieve Code Suggestions and GitLab Duo Chat usage data for a specified time period for the <code>gitlab-org</code> group:</p>
<pre><code class="language-graphql">query {
  group(fullPath: &quot;gitlab-org&quot;) {
    aiMetrics(startDate: &quot;2024-12-01&quot;, endDate: &quot;2024-12-31&quot;) {
      codeSuggestions{
        shownCount
        acceptedCount
        acceptedLinesOfCode
        shownLinesOfCode
      }
      codeContributorsCount
      duoChatContributorsCount
      duoAssignedUsersCount
      duoUsedCount
    }
  }
}
</code></pre>
<p>The query returns the following output:</p>
<pre><code class="language-graphql">{
  &quot;data&quot;: {
    &quot;group&quot;: {
      &quot;aiMetrics&quot;: {
        &quot;codeSuggestions&quot;: {
          &quot;shownCount&quot;: 88728,
          &quot;acceptedCount&quot;: 7016,
          &quot;acceptedLinesOfCode&quot;: 9334,
          &quot;shownLinesOfCode&quot;: 124118
        },
        &quot;codeContributorsCount&quot;: 719,
        &quot;duoChatContributorsCount&quot;: 681,
        &quot;duoAssignedUsersCount&quot;: 1910,
        &quot;duoUsedCount&quot;: 714
      }
    }
  },
}
</code></pre>
<h2>Export AI metrics data to CSV</h2>
<p>You can export AI metrics data to a CSV file with the
<a href="https://gitlab.com/smathur/custom-duo-metrics">GitLab AI Metrics Exporter tool</a>.</p></code></pre>
</body>
</html>
