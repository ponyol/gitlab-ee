<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Manage virtual registries</title>
    <link rel="stylesheet" href="/../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Package
group: Container Registry
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
title: Container virtual registry API
description: Create and manage virtual registries for the container registry, and configure upstream container registries.</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li>
<li>Status: Experiment</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/548794">Introduced</a> in GitLab 18.5 <a href="../administration/feature_flags/_index.html">with a flag</a> named <code>container_virtual_registries</code>. Disabled by default.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>{{&lt; alert type="flag" &gt;}}</p>
<p>The availability of these endpoints is controlled by a feature flag.
For more information, see the history.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Use this API to:</p>
<ul>
<li>Create and manage virtual registries for the container registry.</li>
<li>Configure upstream container registries.</li>
<li>Manage cached container images and manifests.</li>
</ul>
<p>For information about pulling container images through a virtual registry, see
<a href="../user/packages/virtual_registry/container/_index.html">Container virtual registry</a>.</p>
<h2>Manage virtual registries</h2>
<p>Use the following endpoints to create and manage virtual registries for the container registry.</p>
<h3>List all virtual registries</h3>
<p>Lists all container virtual registries for a group.</p>
<pre><code class="language-plaintext">GET /groups/:id/-/virtual_registries/container/registries
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">string or integer</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">The group ID or full-group path. Must be a top-level group.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/groups/5/-/virtual_registries/container/registries&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;group_id&quot;: 5,
    &quot;name&quot;: &quot;my-container-virtual-registry&quot;,
    &quot;description&quot;: &quot;My container virtual registry&quot;,
    &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;
  }
]
</code></pre>
<h3>Create a virtual registry</h3>
<p>Creates a container virtual registry for a group.</p>
<pre><code class="language-plaintext">POST /groups/:id/-/virtual_registries/container/registries
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>string or integer</td>
<td>Yes</td>
<td>The group ID or full-group path. Must be a top-level group.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Yes</td>
<td>The name of the virtual registry.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>string</td>
<td>No</td>
<td>The description of the virtual registry.</td>
</tr>
</tbody>
</table>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You can create a maximum of 5 virtual registries per group.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --request POST \
     --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --header &quot;Accept: application/json&quot; \
     --data '{&quot;name&quot;: &quot;my-container-virtual-registry&quot;, &quot;description&quot;: &quot;My container virtual registry&quot;}' \
     --url &quot;https://gitlab.example.com/api/v4/groups/5/-/virtual_registries/container/registries&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;group_id&quot;: 5,
  &quot;name&quot;: &quot;my-container-virtual-registry&quot;,
  &quot;description&quot;: &quot;My container virtual registry&quot;,
  &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;
}
</code></pre>
<h3>Get a virtual registry</h3>
<p>Gets a specific container virtual registry.</p>
<pre><code class="language-plaintext">GET /virtual_registries/container/registries/:id
</code></pre>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;group_id&quot;: 5,
  &quot;name&quot;: &quot;my-container-virtual-registry&quot;,
  &quot;description&quot;: &quot;My container virtual registry&quot;,
  &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;registry_upstreams&quot;: [
    {
      &quot;id&quot;: 2,
      &quot;position&quot;: 1,
      &quot;upstream_id&quot;: 2
    }
  ]
}
</code></pre>
<h3>Update a virtual registry</h3>
<p>Updates a specific container virtual registry.</p>
<pre><code class="language-plaintext">PATCH /virtual_registries/container/registries/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>string</td>
<td>No</td>
<td>The description of the virtual registry.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>No</td>
<td>The name of the virtual registry.</td>
</tr>
</tbody>
</table>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You must provide at least one of the optional parameters (<code>name</code> or <code>description</code>) in your request.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --request PATCH \
     --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;name&quot;: &quot;my-container-virtual-registry&quot;, &quot;description&quot;: &quot;My container virtual registry&quot;}' \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>200 OK</code></a> status code.</p>
<h3>Delete a virtual registry</h3>
<p>{{&lt; alert type="warning" &gt;}}</p>
<p>When you delete a virtual registry, you also delete all associated upstream registries that are not shared with other virtual registries, along with their cached container images and manifests.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Deletes a specific container virtual registry.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/registries/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p>
<h3>Delete cache entries for a virtual registry</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/538327">Introduced</a> in GitLab 18.7 <a href="../administration/feature_flags/_index.html">with a flag</a> named <code>container_virtual_registries</code>. Disabled by default.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Schedules all cache entries for deletion in all exclusive upstream registries for a container virtual registry. Cache entries are not scheduled for deletion for upstream registries that are associated with other virtual registries.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/registries/:id/cache
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1/cache&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p>
<h2>Manage upstream registries</h2>
<p>Use the following endpoints to configure and manage upstream container registries.</p>
<h3>List all upstream registries for a top-level group</h3>
<p>Lists all upstream container registries for a top-level group.</p>
<pre><code class="language-plaintext">GET /groups/:id/-/virtual_registries/container/upstreams
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">string or integer</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">The group ID or full-group path. Must be a top-level group.</td>
</tr>
<tr>
<td style="text-align: left;"><code>page</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The page number. Defaults to 1.</td>
</tr>
<tr>
<td style="text-align: left;"><code>per_page</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The number of items per page. Defaults to 20.</td>
</tr>
<tr>
<td style="text-align: left;"><code>upstream_name</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The name of the upstream registry for fuzzy search filtering by name.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/groups/5/-/virtual_registries/container/upstreams&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;group_id&quot;: 5,
    &quot;url&quot;: &quot;https://registry-1.docker.io&quot;,
    &quot;name&quot;: &quot;Docker Hub&quot;,
    &quot;description&quot;: &quot;Docker Hub registry&quot;,
    &quot;cache_validity_hours&quot;: 24,
    &quot;username&quot;: &quot;user&quot;,
    &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;
  }
]
</code></pre>
<h3>List all upstream registries for a virtual registry</h3>
<p>Lists all upstream registries for a container virtual registry.</p>
<pre><code class="language-plaintext">GET /virtual_registries/container/registries/:id/upstreams
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">The ID of the container virtual registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1/upstreams&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;group_id&quot;: 5,
    &quot;url&quot;: &quot;https://registry-1.docker.io&quot;,
    &quot;name&quot;: &quot;Docker Hub&quot;,
    &quot;description&quot;: &quot;Docker Hub registry&quot;,
    &quot;cache_validity_hours&quot;: 24,
    &quot;username&quot;: &quot;user&quot;,
    &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;registry_upstream&quot;: {
      &quot;id&quot;: 1,
      &quot;registry_id&quot;: 1,
      &quot;position&quot;: 1
    }
  }
]
</code></pre>
<h3>Create an upstream registry</h3>
<p>Adds an upstream container registry to a container virtual registry.</p>
<pre><code class="language-plaintext">POST /virtual_registries/container/registries/:id/upstreams
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
<tr>
<td><code>url</code></td>
<td>string</td>
<td>Yes</td>
<td>The URL of the upstream container registry.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Yes</td>
<td>The name of the upstream registry.</td>
</tr>
<tr>
<td><code>cache_validity_hours</code></td>
<td>integer</td>
<td>No</td>
<td>The cache validity period for container images. Defaults to 24 hours.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>string</td>
<td>No</td>
<td>The description of the upstream registry.</td>
</tr>
<tr>
<td><code>password</code></td>
<td>string</td>
<td>No</td>
<td>The password of the upstream registry.</td>
</tr>
<tr>
<td><code>username</code></td>
<td>string</td>
<td>No</td>
<td>The username of the upstream registry.</td>
</tr>
</tbody>
</table>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You must include both the <code>username</code> and <code>password</code> in the request, or not at all. If not set, a public (anonymous) request is used to access the upstream.</p>
<p>You cannot add two upstreams with the same URL and credentials (<code>username</code> and <code>password</code>) to the same top-level group. Instead, you can either:</p>
<ul>
<li>Set different credentials for each upstream with the same URL.</li>
<li>Associate an upstream with multiple virtual registries.</li>
</ul>
<p>{{&lt; /alert &gt;}}</p>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You can add a maximum of 5 upstream registries to each virtual registry.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --request POST --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;url&quot;: &quot;https://registry-1.docker.io&quot;, &quot;name&quot;: &quot;Docker Hub&quot;, &quot;description&quot;: &quot;Docker Hub registry&quot;, &quot;username&quot;: &quot;&lt;your_username&gt;&quot;, &quot;password&quot;: &quot;&lt;your_password&gt;&quot;, &quot;cache_validity_hours&quot;: 48}' \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registries/1/upstreams&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;group_id&quot;: 5,
  &quot;url&quot;: &quot;https://registry-1.docker.io&quot;,
  &quot;name&quot;: &quot;Docker Hub&quot;,
  &quot;description&quot;: &quot;Docker Hub registry&quot;,
  &quot;cache_validity_hours&quot;: 48,
  &quot;username&quot;: &quot;user&quot;,
  &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;registry_upstream&quot;: {
    &quot;id&quot;: 1,
    &quot;registry_id&quot;: 1,
    &quot;position&quot;: 1
  }
}
</code></pre>
<h3>Get an upstream registry</h3>
<p>Gets a specific upstream container registry for a container virtual registry.</p>
<pre><code class="language-plaintext">GET /virtual_registries/container/upstreams/:id
</code></pre>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/upstreams/1&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;group_id&quot;: 5,
  &quot;url&quot;: &quot;https://registry-1.docker.io&quot;,
  &quot;name&quot;: &quot;Docker Hub&quot;,
  &quot;description&quot;: &quot;Docker Hub registry&quot;,
  &quot;cache_validity_hours&quot;: 24,
  &quot;username&quot;: &quot;user&quot;,
  &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
  &quot;registry_upstreams&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;registry_id&quot;: 1,
      &quot;position&quot;: 1
    }
  ]
}
</code></pre>
<h3>Update an upstream registry</h3>
<p>Updates a specific upstream container registry for a container virtual registry.</p>
<pre><code class="language-plaintext">PATCH /virtual_registries/container/upstreams/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry.</td>
</tr>
<tr>
<td><code>cache_validity_hours</code></td>
<td>integer</td>
<td>No</td>
<td>The cache validity period for container images. Defaults to 24 hours.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>string</td>
<td>No</td>
<td>The description of the upstream registry.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>No</td>
<td>The name of the upstream registry.</td>
</tr>
<tr>
<td><code>password</code></td>
<td>string</td>
<td>No</td>
<td>The password of the upstream registry.</td>
</tr>
<tr>
<td><code>url</code></td>
<td>string</td>
<td>No</td>
<td>The URL of the upstream registry.</td>
</tr>
<tr>
<td><code>username</code></td>
<td>string</td>
<td>No</td>
<td>The username of the upstream registry.</td>
</tr>
</tbody>
</table>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You must provide at least one of the optional parameters in your request.</p>
<p>The <code>username</code> and <code>password</code> must be provided together, or not at all. If not set, a public (anonymous) request is used to access the upstream.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --request PATCH --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;cache_validity_hours&quot;: 72}' \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/upstreams/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>200 OK</code></a> status code.</p>
<h3>Update an upstream registry position</h3>
<p>Updates the position of an upstream container registry in an ordered list for a container virtual registry.</p>
<pre><code class="language-plaintext">PATCH /virtual_registries/container/registry_upstreams/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry association.</td>
</tr>
<tr>
<td><code>position</code></td>
<td>integer</td>
<td>Yes</td>
<td>The position of the upstream registry. Between 1 and 20.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request PATCH --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;position&quot;: 5}' \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registry_upstreams/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>200 OK</code></a> status code.</p>
<h3>Delete an upstream registry</h3>
<p>Deletes a specific upstream container registry for a container virtual registry.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/upstreams/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/upstreams/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p>
<h3>Associate an upstream with a registry</h3>
<p>Associates an existing upstream container registry with a container virtual registry.</p>
<pre><code class="language-plaintext">POST /virtual_registries/container/registry_upstreams
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>registry_id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container virtual registry.</td>
</tr>
<tr>
<td><code>upstream_id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the container upstream registry.</td>
</tr>
</tbody>
</table>
<p>{{&lt; alert type="note" &gt;}}</p>
<p>You can associate a maximum of 5 upstream registries with each virtual registry.</p>
<p>{{&lt; /alert &gt;}}</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --request POST \
     --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --header &quot;Accept: application/json&quot; \
     --data '{&quot;registry_id&quot;: 1, &quot;upstream_id&quot;: 2}' \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registry_upstreams&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 5,
  &quot;registry_id&quot;: 1,
  &quot;upstream_id&quot;: 2,
  &quot;position&quot;: 2
}
</code></pre>
<h3>Disassociate an upstream from a registry</h3>
<p>Removes the association between an upstream container registry and a container virtual registry.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/registry_upstreams/:id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry association.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE \
     --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/registry_upstreams/1&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p>
<h3>Delete cache entries for an upstream registry</h3>
<p>{{&lt; history &gt;}}</p>
<ul>
<li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/538327">Introduced</a> in GitLab 18.7 <a href="../administration/feature_flags/_index.html">with a flag</a> named <code>container_virtual_registries</code>. Disabled by default.</li>
</ul>
<p>{{&lt; /history &gt;}}</p>
<p>Schedules all cache entries for deletion for a specific upstream registry in a container virtual registry.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/upstreams/:id/cache
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>integer</td>
<td>Yes</td>
<td>The ID of the upstream registry.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/upstreams/1/cache&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p>
<h2>Manage cache entries</h2>
<p>Use the following endpoints to manage cached container images and manifests for a container virtual registry.</p>
<h3>List upstream registry cache entries</h3>
<p>Lists cached container images and manifests for a container upstream registry.</p>
<pre><code class="language-plaintext">GET /virtual_registries/container/upstreams/:id/cache_entries
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">The ID of the upstream registry.</td>
</tr>
<tr>
<td style="text-align: left;"><code>page</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The page number. Defaults to 1.</td>
</tr>
<tr>
<td style="text-align: left;"><code>per_page</code></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The number of items per page. Defaults to 20.</td>
</tr>
<tr>
<td style="text-align: left;"><code>search</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The search query for the relative path of the container image (for example, <code>library/nginx</code>).</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/upstreams/1/cache_entries?search=library/nginx&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: &quot;MTUgbGlicmFyeS9uZ2lueC9tYW5pZmVzdC9zaGEyNTY6YWJjZGVmZ2hpams=&quot;,
    &quot;group_id&quot;: 5,
    &quot;upstream_id&quot;: 1,
    &quot;upstream_checked_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;file_md5&quot;: &quot;44f21d5190b5a6df8089f54799628d7e&quot;,
    &quot;file_sha1&quot;: &quot;74d101856d26f2db17b39bd22d3204021eb0bf7d&quot;,
    &quot;size&quot;: 2048,
    &quot;relative_path&quot;: &quot;library/nginx/manifests/latest&quot;,
    &quot;content_type&quot;: &quot;application/vnd.docker.distribution.manifest.v2+json&quot;,
    &quot;upstream_etag&quot;: &quot;\&quot;686897696a7c876b7e\&quot;&quot;,
    &quot;created_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;updated_at&quot;: &quot;2024-05-30T12:28:27.855Z&quot;,
    &quot;downloads_count&quot;: 5,
    &quot;downloaded_at&quot;: &quot;2024-06-05T14:58:32.855Z&quot;
  }
]
</code></pre>
<h3>Delete an upstream registry cache entry</h3>
<p>Deletes a specific cached container image or manifest for a container upstream registry.</p>
<pre><code class="language-plaintext">DELETE /virtual_registries/container/cache_entries/*id
</code></pre>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>string</td>
<td>Yes</td>
<td>The cache entry ID which is the base64-encoded upstream ID and relative path of the cache entry (for example, 'bGlicmFyeS9uZ2lueC9tYW5pZmVzdHMvbGF0ZXN0').</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request DELETE --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Accept: application/json&quot; \
     --url &quot;https://gitlab.example.com/api/v4/virtual_registries/container/cache_entries/bGlicmFyeS9uZ2lueC9tYW5pZmVzdHMvbGF0ZXN0&quot;
</code></pre>
<p>If successful, returns a <a href="rest/troubleshooting.md#status-codes"><code>204 No Content</code></a> status code.</p></code></pre>
</body>
</html>
