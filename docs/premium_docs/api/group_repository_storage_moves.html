<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title># Retrieve all group repository storage moves</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <pre><code><hr />
<p>stage: Create
group: Remote Development
info: To determine the technical writer assigned to the Stage/Group associated with this page, see https://handbook.gitlab.com/handbook/product/ux/technical-writing/#assignments
description: Documentation for the REST API for moving the storage for repositories in a GitLab group.
title: Group repository storage moves API</p>
<hr />
<p>{{&lt; details &gt;}}</p>
<ul>
<li>Tier: Premium, Ultimate</li>
<li>Offering: GitLab Self-Managed, GitLab Dedicated</li>
</ul>
<p>{{&lt; /details &gt;}}</p>
<p>Use this API to manage <a href="../administration/operations/moving_repositories.html">group repository storage moves</a>.
This API can help you, for example,
<a href="../administration/gitaly/praefect/_index.md#migrate-to-gitaly-cluster-praefect">migrate to Gitaly Cluster (Praefect)</a>
or migrate a <a href="../user/project/wiki/group.html">group wiki</a>. This API does not manage
project repositories in a group. To schedule project moves, use the
<a href="project_repository_storage_moves.html">project repository storage moves API</a>.</p>
<p>As GitLab processes a group repository storage move, it transitions through different states. Values
of <code>state</code> are:</p>
<ul>
<li><code>initial</code>: The record has been created, but the background job has not yet been scheduled.</li>
<li><code>scheduled</code>: The background job has been scheduled.</li>
<li><code>started</code>: The group repositories are being copied to the destination storage.</li>
<li><code>replicated</code>: The group has been moved.</li>
<li><code>failed</code>: The group repositories failed to copy, or the checksums did not match.</li>
<li><code>finished</code>: The group has been moved, and the repositories on the source storage have been deleted.</li>
<li><code>cleanup failed</code>: The group has been moved, but the repositories on the source storage could not be deleted.</li>
</ul>
<p>To ensure data integrity, GitLab places groups in a temporary read-only state for the
duration of the move. During this time, users receive this message if they try to
push new commits:</p>
<pre><code class="language-plaintext">The repository is temporarily read-only. Please try again later.
</code></pre>
<p>This API requires you to <a href="rest/authentication.html">authenticate yourself</a> as an administrator.</p>
<p>APIs are also available to move other types of repositories:</p>
<ul>
<li><a href="project_repository_storage_moves.html">Project repository storage moves API</a>.</li>
<li><a href="snippet_repository_storage_moves.html">Snippet repository storage moves API</a>.</li>
</ul>
<h2>Retrieve all group repository storage moves</h2>
<pre><code class="language-plaintext">GET /group_repository_storage_moves
</code></pre>
<p>By default, <code>GET</code> requests return 20 results at a time, because the API results
are <a href="rest/_index.md#pagination">paginated</a>.</p>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
  --url &quot;https://gitlab.example.com/api/v4/group_repository_storage_moves&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;created_at&quot;: &quot;2020-05-07T04:27:17.234Z&quot;,
    &quot;state&quot;: &quot;scheduled&quot;,
    &quot;source_storage_name&quot;: &quot;default&quot;,
    &quot;destination_storage_name&quot;: &quot;storage2&quot;,
    &quot;group&quot;: {
      &quot;id&quot;: 283,
      &quot;web_url&quot;: &quot;https://gitlab.example.com/groups/testgroup&quot;,
      &quot;name&quot;: &quot;testgroup&quot;
    }
  }
]
</code></pre>
<h2>Retrieve all repository storage moves for a single group</h2>
<p>To retrieve all the repository storage moves for a single group you can use the following endpoint:</p>
<pre><code class="language-plaintext">GET /groups/:group_id/repository_storage_moves
</code></pre>
<p>By default, <code>GET</code> requests return 20 results at a time, because the API results
are <a href="rest/_index.md#pagination">paginated</a>.</p>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group_id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID of the group.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
  --url &quot;https://gitlab.example.com/api/v4/groups/1/repository_storage_moves&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">[
  {
    &quot;id&quot;: 1,
    &quot;created_at&quot;: &quot;2020-05-07T04:27:17.234Z&quot;,
    &quot;state&quot;: &quot;scheduled&quot;,
    &quot;source_storage_name&quot;: &quot;default&quot;,
    &quot;destination_storage_name&quot;: &quot;storage2&quot;,
    &quot;group&quot;: {
      &quot;id&quot;: 283,
      &quot;web_url&quot;: &quot;https://gitlab.example.com/groups/testgroup&quot;,
      &quot;name&quot;: &quot;testgroup&quot;
    }
  }
]
</code></pre>
<h2>Get a single group repository storage move</h2>
<p>To retrieve a single repository storage move throughout all the existing repository
storage moves, you can use the following endpoint:</p>
<pre><code class="language-plaintext">GET /group_repository_storage_moves/:repository_storage_id
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>repository_storage_id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID of the group repository storage move.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
  --url &quot;https://gitlab.example.com/api/v4/group_repository_storage_moves/1&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;created_at&quot;: &quot;2020-05-07T04:27:17.234Z&quot;,
  &quot;state&quot;: &quot;scheduled&quot;,
  &quot;source_storage_name&quot;: &quot;default&quot;,
  &quot;destination_storage_name&quot;: &quot;storage2&quot;,
  &quot;group&quot;: {
    &quot;id&quot;: 283,
    &quot;web_url&quot;: &quot;https://gitlab.example.com/groups/testgroup&quot;,
    &quot;name&quot;: &quot;testgroup&quot;
  }
}
</code></pre>
<h2>Get a single repository storage move for a group</h2>
<p>Given a group, you can retrieve a specific repository storage move for that group,
through the following endpoint:</p>
<pre><code class="language-plaintext">GET /groups/:group_id/repository_storage_moves/:repository_storage_id
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group_id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID of the group.</td>
</tr>
<tr>
<td><code>repository_storage_id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID of the group repository storage move.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
  --url &quot;https://gitlab.example.com/api/v4/groups/1/repository_storage_moves/1&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;created_at&quot;: &quot;2020-05-07T04:27:17.234Z&quot;,
  &quot;state&quot;: &quot;scheduled&quot;,
  &quot;source_storage_name&quot;: &quot;default&quot;,
  &quot;destination_storage_name&quot;: &quot;storage2&quot;,
  &quot;group&quot;: {
    &quot;id&quot;: 283,
    &quot;web_url&quot;: &quot;https://gitlab.example.com/groups/testgroup&quot;,
    &quot;name&quot;: &quot;testgroup&quot;
  }
}
</code></pre>
<h2>Schedule a repository storage move for a group</h2>
<p>Schedules a repository storage move for a group. This endpoint:</p>
<ul>
<li>Moves only group Wiki repositories.</li>
<li>Doesn't move repositories for projects in a group. To schedule project moves, use the <a href="project_repository_storage_moves.html">Project repository storage moves</a> API.</li>
</ul>
<pre><code class="language-plaintext">POST /groups/:group_id/repository_storage_moves
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group_id</code></td>
<td>integer</td>
<td>yes</td>
<td>ID of the group.</td>
</tr>
<tr>
<td><code>destination_storage_name</code></td>
<td>string</td>
<td>no</td>
<td>Name of the destination storage shard. The storage is selected <a href="../administration/repository_storage_paths.md#configure-where-new-repositories-are-stored">based on storage weights</a> if not provided.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request POST --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;destination_storage_name&quot;:&quot;storage2&quot;}' \
     --url &quot;https://gitlab.example.com/api/v4/groups/1/repository_storage_moves&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;id&quot;: 1,
  &quot;created_at&quot;: &quot;2020-05-07T04:27:17.234Z&quot;,
  &quot;state&quot;: &quot;scheduled&quot;,
  &quot;source_storage_name&quot;: &quot;default&quot;,
  &quot;destination_storage_name&quot;: &quot;storage2&quot;,
  &quot;group&quot;: {
    &quot;id&quot;: 283,
    &quot;web_url&quot;: &quot;https://gitlab.example.com/groups/testgroup&quot;,
    &quot;name&quot;: &quot;testgroup&quot;
  }
}
</code></pre>
<h2>Schedule repository storage moves for all groups on a storage shard</h2>
<p>Schedules repository storage moves for each group repository stored on the source storage shard.
This endpoint migrates all groups at once.</p>
<pre><code class="language-plaintext">POST /group_repository_storage_moves
</code></pre>
<p>Supported attributes:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>source_storage_name</code></td>
<td>string</td>
<td>yes</td>
<td>Name of the source storage shard.</td>
</tr>
<tr>
<td><code>destination_storage_name</code></td>
<td>string</td>
<td>no</td>
<td>Name of the destination storage shard. The storage is selected <a href="../administration/repository_storage_paths.md#configure-where-new-repositories-are-stored">based on storage weights</a> if not provided.</td>
</tr>
</tbody>
</table>
<p>Example request:</p>
<pre><code class="language-shell">curl --request POST --header &quot;PRIVATE-TOKEN: &lt;your_access_token&gt;&quot; \
     --header &quot;Content-Type: application/json&quot; \
     --data '{&quot;source_storage_name&quot;:&quot;default&quot;}' \
     --url &quot;https://gitlab.example.com/api/v4/group_repository_storage_moves&quot;
</code></pre>
<p>Example response:</p>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;202 Accepted&quot;
}
</code></pre>
<h2>Related topics</h2>
<ul>
<li><a href="../administration/operations/moving_repositories.html">Moving repositories managed by GitLab</a></li>
</ul></code></pre>
</body>
</html>
