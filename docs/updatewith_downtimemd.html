<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÑ update/with_downtime.md</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <pre><code><p><strong>1. –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ</strong><br />
–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º—É–ª—å—Ç–∏–Ω–æ–¥–æ–≤–æ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏ GitLab —Å –ø—Ä–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–∞—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ª—É–∂–±—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–±–æ—è.</p>
<p><strong>2. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</strong>
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: Consul, Gitaly, PostgreSQL, Redis, PgBouncer –∏ GitLab –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∫ –≤ Linux package (Omnibus), —Ç–∞–∫ –∏ –≤ Kubernetes —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Helm chart.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Gitaly –∏ Gitaly Cluster (Praefect) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AMI –Ω–∞ AWS –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Elastic Network Interfaces (ENIs).
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Patroni –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ PostgreSQL —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º failover.
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Redis HA (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Sentinel) –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö zero-downtime –ø—Ä–æ—Ü–µ—Å—Å–∞.
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–π –Ω–æ–¥—ã (Prometheus) –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ.</p>
<p><strong>3. –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã</strong>
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è (downtime) ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
- –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Gitaly Cluster (Praefect) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AMI –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ENIs, –∏–Ω–∞—á–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Linux package.
- –î–ª—è PostgreSQL —Å Patroni –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–ø–ª–∏–∫–∏, –∑–∞—Ç–µ–º –ª–∏–¥–µ—Ä.
- –î–ª—è Redis HA —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å zero-downtime –ø—Ä–æ—Ü–µ—Å—Å ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.
- –í —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PgBouncer –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ PostgreSQL.
- –ù–∞ –Ω–æ–¥–µ –¥–µ–ø–ª–æ—è (deploy node) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (<code>gitlab_rails['auto_migrate'] = true</code>), –∏–Ω–∞—á–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è.</p>
<hr /></code></pre>
</body>
</html>
